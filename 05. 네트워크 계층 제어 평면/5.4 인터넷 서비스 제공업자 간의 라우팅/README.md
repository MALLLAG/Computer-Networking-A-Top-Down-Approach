## 5.4 인터넷 서비스 제공자 간 라우팅: BGP (Routing Among the ISPs: BGP)

앞서 OSPF가 **자율 시스템 내부(Intra-AS)** 라우팅 프로토콜의 한 예임을 배웠습니다.  
즉, 동일한 자율 시스템(AS) 내에서 패킷이 전송될 때는 그 경로가 오직 내부 라우팅 프로토콜(OSPF 등)에 의해 결정됩니다.

하지만, 여러 자율 시스템을 거쳐야 하는 경우 — 예를 들어, 아프리카 팀북투의 스마트폰에서 실리콘밸리의 데이터센터 서버로 패킷을 전송하는 경우 —  
이때는 **자율 시스템 간(Inter-AS)** 라우팅 프로토콜이 필요합니다.

이러한 프로토콜은 여러 AS 간의 조정이 필요하기 때문에,  
모든 AS는 동일한 Inter-AS 라우팅 프로토콜을 사용해야 합니다.  
인터넷에서는 모든 AS가 공통적으로 **BGP(Border Gateway Protocol)** 를 사용합니다.  

### BGP의 중요성

BGP는 사실상 인터넷의 가장 중요한 프로토콜 중 하나입니다.  
IP 프로토콜 자체를 제외하면, BGP는 수많은 ISP들을 하나의 거대한 네트워크로 연결하는 “접착제” 역할을 합니다.  
BGP는 **분산적이고 비동기적인(distance-vector 기반의)** 라우팅 프로토콜이며,  
앞서 5.2.2절에서 다룬 거리 벡터 라우팅의 개념과 유사한 구조를 가지고 있습니다.

BGP는 복잡하고 배우기 어려운 프로토콜이지만,  
인터넷의 근본적인 동작 원리를 이해하기 위해서는 반드시 숙지해야 하는 핵심 개념입니다.  
BGP를 이해하기 위한 노력은 충분히 그 가치가 있습니다.

## 5.4.1 BGP의 역할 (The Role of BGP)

BGP의 역할을 이해하기 위해, 하나의 자율 시스템(AS)과 그 내부의 임의의 라우터를 생각해보겠습니다.  
각 라우터는 **포워딩 테이블(forwarding table)** 을 가지고 있으며,  
이 테이블은 도착한 패킷을 어느 링크로 전송할지 결정하는 핵심적인 역할을 합니다.

- AS 내부의 목적지에 대한 포워딩은 **Intra-AS 라우팅 프로토콜**(예: OSPF)에 의해 결정됩니다.
- 그렇다면 **AS 외부**, 즉 다른 네트워크로의 경로는 어떻게 결정될까요?  
  → 바로 이때 **BGP**가 사용됩니다.

### BGP의 기본 개념

BGP에서 목적지는 개별 IP 주소가 아니라 **CIDR 기반의 프리픽스(prefix)** 로 표현됩니다.  
예를 들어, `138.16.68.0/22`는 1,024개의 IP 주소를 포함한 서브넷을 의미합니다.

따라서 라우터의 포워딩 테이블은 다음과 같은 형태를 가집니다.  
`(x, l)` — 여기서 `x`는 프리픽스(예: 138.16.68.0/22), `l`은 라우터의 인터페이스 번호입니다.

### BGP의 두 가지 주요 기능

BGP는 각 라우터에 다음 두 가지 기능을 제공합니다.

1. **이웃 AS로부터 프리픽스 도달 가능성(Prefix Reachability) 정보를 수집합니다.**
    - 각 서브넷은 자신이 존재함을 인터넷에 알리기 위해 “나는 여기에 있다!”는 신호를 보냅니다.
    - BGP는 이 정보를 전달하여 모든 라우터가 이 서브넷에 도달할 수 있도록 합니다.
    - 만약 BGP가 없다면, 각 서브넷은 외부와 단절된 고립된 섬처럼 존재하게 될 것입니다.

2. **프리픽스에 대한 ‘최적의 경로’를 결정합니다.**
    - 하나의 프리픽스(즉, 목적지)에 도달할 수 있는 경로가 여러 개 있을 수 있습니다.
    - 이때 라우터는 BGP의 **경로 선택 절차(Route Selection Procedure)** 를 통해 가장 적절한 경로를 선택합니다.
    - 선택 기준은 단순히 거리뿐만 아니라, 정책(Policy)과 도달 가능성 정보에 따라 달라질 수 있습니다.

## 5.4.2 BGP 경로 정보 광고 (Advertising BGP Route Information)

이제 BGP가 이러한 정보를 어떻게 교환하는지 살펴보겠습니다.

아래 그림(그림 5.8)은 세 개의 자율 시스템(AS1, AS2, AS3)으로 구성된 단순한 네트워크를 보여줍니다.  
AS3은 `x`라는 프리픽스를 포함하고 있습니다.

<img width="672" height="349" alt="Image" src="https://github.com/user-attachments/assets/8b769ca3-bd42-40a2-9d23-fba015584cdb" />

각 AS에는 두 종류의 라우터가 있습니다.

- **게이트웨이 라우터(Gateway Router):**  
  다른 AS의 라우터와 직접 연결된, AS의 경계에 위치한 라우터입니다.
- **내부 라우터(Internal Router):**  
  AS 내부에서만 통신하며, 다른 AS의 라우터와는 직접 연결되지 않은 라우터입니다.

예를 들어, AS1에서 라우터 `1c`는 게이트웨이 라우터이고,  
`1a`, `1b`, `1d`는 내부 라우터입니다.

### 경로 광고의 기본 흐름

1. **AS3 → AS2:**  
   AS3은 “프리픽스 x가 내 안에 존재한다”는 메시지를 AS2에 보냅니다.  
   이를 **“AS3 x”**로 표시합니다.

2. **AS2 → AS1:**  
   AS2는 이 정보를 받아 “AS3 x가 존재하며, 나를 거쳐 갈 수 있다”고 알립니다.  
   즉, **“AS2 AS3 x”**라는 경로 정보를 AS1에 전달합니다.

이러한 방식으로, 각 AS는 단순히 프리픽스 x의 존재만 아는 것이 아니라,  
그 프리픽스까지 도달하기 위한 **AS 경로(AS Path)** 정보도 함께 얻게 됩니다.

### BGP 연결의 형태

BGP는 **TCP 기반(포트 179)** 의 반영구적인 연결을 통해 라우터 간에 메시지를 교환합니다.  
이러한 연결을 **BGP 세션(BGP Connection)** 이라고 부릅니다.

- **eBGP (External BGP):**  
  서로 다른 AS 간의 라우터 간 연결입니다.  
  예: AS1의 게이트웨이 라우터 1c ↔ AS2의 2a

- **iBGP (Internal BGP):**  
  동일한 AS 내부 라우터 간의 연결입니다.  
  예: AS2 내부 라우터들 간의 연결 (2a, 2b, 2c, 2d 등)

BGP 세션은 물리적인 링크와 일치할 필요가 없습니다.  
iBGP는 일반적으로 AS 내부의 모든 라우터 간에 **메시 구조(mesh)** 형태로 설정됩니다.

### 경로 전파의 실제 동작

1. 게이트웨이 라우터 3a가 AS2의 게이트웨이 라우터 2c로 **eBGP 메시지 “AS3 x”**를 전송합니다.
2. 라우터 2c는 이 메시지를 받아 AS2 내부의 모든 라우터들에게 **iBGP**를 통해 전파합니다.
3. 이후 게이트웨이 라우터 2a가 AS1의 게이트웨이 라우터 1c로 **eBGP 메시지 “AS2 AS3 x”**를 전송합니다.
4. 라우터 1c는 이를 받아 AS1 내부의 라우터들에게 **iBGP**를 통해 전달합니다.

이 과정을 통해 AS1과 AS2의 모든 라우터는  
프리픽스 x의 존재와 “AS2 → AS3 → x”라는 경로를 인식하게 됩니다.

### 실제 네트워크의 예

현실에서는 하나의 목적지로 가는 여러 경로가 존재할 수 있습니다.  
예를 들어, 그림 5.10에서 라우터 `1d`와 `3d` 사이에 물리적인 링크가 추가된 경우,  
AS1에서 목적지 x로 가는 경로는 두 가지가 됩니다.

1. **AS2를 경유하는 경로:** `AS2 AS3 x` (via 1c)
2. **직접 연결된 경로:** `AS3 x` (via 1d)

이러한 경우, BGP는 정책과 경로 속성(Attribute)에 따라  
어떤 경로를 선택할지 결정하게 됩니다.

<img width="646" height="362" alt="Image" src="https://github.com/user-attachments/assets/38f49746-ac48-4849-920f-2bbfa9d63881" />












## 5.4.3 최적 경로 결정 (Determining the Best Routes)

앞서 살펴본 것처럼, 하나의 라우터에서 특정 목적지 서브넷으로 향하는 경로는 여러 가지가 존재할 수 있습니다.  
실제로 인터넷에서는 라우터가 수십 개의 가능한 경로에 대한 도달 가능성 정보를 동시에 받는 경우도 많습니다.  
그렇다면 라우터는 이러한 다양한 경로 중에서 어떤 경로를 선택해야 할까요?  
그리고 선택된 경로를 기반으로 어떻게 포워딩 테이블을 구성해야 할까요?

### BGP의 핵심 용어

이 질문을 다루기 전에, BGP의 주요 용어를 간단히 살펴보겠습니다.  
라우터가 BGP 연결을 통해 특정 **프리픽스(prefix)** 를 광고할 때,  
그 프리픽스와 함께 여러 개의 **BGP 속성(BGP Attributes)** 을 포함하여 전송합니다.  
BGP 용어로, 프리픽스와 그 속성의 집합을 **경로(route)** 라고 부릅니다.

가장 중요한 두 가지 속성은 다음과 같습니다.

1. **AS-PATH 속성:**  
   해당 경로를 통해 패킷이 지나온 AS들의 목록을 포함합니다.  
   즉, “이 프리픽스는 어떤 자율 시스템들을 거쳐 도달할 수 있는가”를 명시합니다.

2. **NEXT-HOP 속성:**  
   해당 경로에서 **다음 홉(Next Hop)** 라우터의 IP 주소를 나타냅니다.

### AS-PATH 속성의 역할

라우터가 BGP 광고를 전달할 때마다, 자신의 AS 번호(ASN)를 **AS-PATH** 리스트에 추가합니다.  
예를 들어, 그림 5.10에서 AS1이 서브넷 `x`로 가는 경로 정보를 받을 때, 두 가지 경로가 존재할 수 있습니다.

- 경로 1: `AS2 AS3 x`
- 경로 2: `AS3 x`

즉, AS1은 AS2를 경유하는 경로와 직접 AS3으로 가는 경로 두 가지를 알게 됩니다.

라우터는 또한 AS-PATH 속성을 이용하여 **라우팅 루프(Looping)** 을 방지합니다.  
만약 자신이 이미 경로 목록에 포함되어 있다면, 해당 광고를 무시하여 루프가 발생하지 않도록 합니다.

### NEXT-HOP 속성의 역할

NEXT-HOP 속성은 **AS-PATH가 시작되는 라우터 인터페이스의 IP 주소**를 의미합니다.  
예를 들어, 그림 5.10을 다시 보면,  
경로 “AS2 AS3 x”의 NEXT-HOP은 라우터 2a의 왼쪽 인터페이스 주소이며,  
경로 “AS3 x”의 NEXT-HOP은 라우터 3d의 왼쪽 인터페이스 주소입니다.

따라서, AS1의 라우터들은 두 개의 가능한 경로 정보를 인식하게 됩니다.

- **경로 1:** NEXT-HOP = 라우터 2a의 왼쪽 인터페이스 / AS-PATH = AS2 AS3 / 프리픽스 = x
- **경로 2:** NEXT-HOP = 라우터 3d의 왼쪽 인터페이스 / AS-PATH = AS3 / 프리픽스 = x

## Hot Potato Routing (핫 포테이토 라우팅)

이제 BGP 라우팅 알고리즘을 구체적으로 살펴볼 수 있습니다.  
가장 단순하면서도 직관적인 알고리즘이 바로 **핫 포테이토 라우팅(Hot Potato Routing)** 입니다.

그림 5.10의 네트워크에서 라우터 `1b`를 예로 들어 보겠습니다.  
라우터 1b는 프리픽스 `x`로 향하는 두 개의 BGP 경로를 알고 있습니다.

핫 포테이토 라우팅에서는 **NEXT-HOP까지의 비용이 가장 작은 경로**를 선택합니다.  
즉, “내가 속한 AS 내부에서 가장 가까운 게이트웨이까지의 경로”를 기준으로 결정합니다.

예를 들어 다음과 같은 상황을 가정합니다.

- 라우터 1b → 라우터 2a까지의 비용: 2
- 라우터 1b → 라우터 2d까지의 비용: 3  
  → 따라서 라우터 1b는 라우터 2a를 선택하게 됩니다.

그 후, 라우터 1b는 자신의 내부 라우팅 알고리즘(OSPF 등)을 사용하여  
NEXT-HOP(즉, 라우터 2a)까지의 최단 경로를 찾고,  
그 인터페이스를 자신의 포워딩 테이블에 `(x, l)` 형태로 추가합니다.

### Hot Potato Routing의 절차

핫 포테이토 라우팅 과정은 다음과 같이 요약할 수 있습니다.  

<img width="715" height="256" alt="Image" src="https://github.com/user-attachments/assets/dbbbc855-df8a-4eb6-8489-c96e6baba07f" />

1. **BGP로부터 외부 프리픽스(x)가 도달 가능함을 학습합니다.**
2. **내부 라우팅 프로토콜(OSPF 등)을 사용해 각 게이트웨이까지의 비용을 계산합니다.**
3. **비용이 가장 작은 게이트웨이를 선택합니다.**
4. **그 게이트웨이로 향하는 인터페이스를 포워딩 테이블에 추가합니다.**

핫 포테이토라는 이름은 “손에 쥔 뜨거운 감자”처럼,  
자신의 AS 내부에서 최대한 빨리(즉, 최소 비용으로) 패킷을 외부로 넘기려는 동작에서 유래했습니다.

이 방식은 “이기적인(selfish)” 라우팅이라 할 수 있습니다.  
자신의 AS 내부 비용만 최소화하고, 전체 경로의 효율성은 고려하지 않기 때문입니다.  
예를 들어, 같은 AS에 있는 두 라우터라도 각기 다른 게이트웨이를 선택할 수 있습니다.

## BGP의 실제 경로 선택 알고리즘 (Route-Selection Algorithm)

현실의 BGP는 단순한 핫 포테이토 라우팅보다 훨씬 복잡한 규칙을 사용합니다.  
하지만 기본 개념은 여전히 포함되어 있습니다.

하나의 목적지 프리픽스에 대해, BGP는 해당 프리픽스에 도달할 수 있는  
모든 경로들을 학습한 뒤, 다음과 같은 **우선순위 규칙**을 순차적으로 적용합니다.

### BGP의 경로 선택 규칙

1. **로컬 우선순위(Local Preference)**
    - 각 경로는 로컬 우선순위 값을 가질 수 있습니다.
    - 이 값은 네트워크 관리자가 정책에 따라 설정하며,  
      가장 높은 로컬 우선순위를 가진 경로가 우선 선택됩니다.

2. **AS-PATH 길이(Shortest AS-PATH)**
    - 동일한 로컬 우선순위를 가진 경로들 중에서는  
      AS-PATH 길이가 가장 짧은 경로를 선택합니다.
    - 즉, AS 홉 수가 적은 경로가 우선입니다.

3. **핫 포테이토 라우팅(Hot Potato Routing)**
    - 동일한 AS-PATH 길이를 가진 경로들 중에서는  
      NEXT-HOP까지의 내부 비용이 가장 작은 경로를 선택합니다.

4. **그 외의 경우**
    - 위의 조건으로도 여러 경로가 남을 경우,  
      라우터는 **BGP 식별자(BGP Identifier)** 를 기준으로 결정합니다.  

### 예시

그림 5.10의 라우터 1b를 다시 생각해보겠습니다.  
1b는 프리픽스 `x`로 향하는 두 경로를 알고 있습니다.

- 경로 1: AS2 AS3 x
- 경로 2: AS3 x

만약 단순히 핫 포테이토 라우팅만 사용한다면,  
라우터는 AS2를 경유하는 경로를 선택할 것입니다.  
하지만 실제 BGP 알고리즘에서는 **AS-PATH 길이**가 더 짧은 경로가 우선하므로,  
라우터는 AS3으로 직접 가는 경로(경로 2)를 선택하게 됩니다.

따라서 실제 BGP는 단순히 “이기적인” 알고리즘이 아니라,  
짧은 AS 경로를 우선함으로써 전체 네트워크의 효율성도 고려하게 됩니다.










## 5.4.4 IP-Anycast

BGP는 인터넷의 **자율 시스템 간 라우팅 프로토콜(Inter-AS Routing Protocol)** 일 뿐만 아니라,  
**IP-anycast 서비스**를 구현하는 데에도 자주 사용됩니다.  
이 서비스는 [RFC 1546, RFC 7094]에 정의되어 있으며,  
**DNS(Domain Name System)** 에서 널리 활용됩니다.

### IP-anycast의 개념

IP-anycast의 기본 아이디어를 이해하기 위해 두 가지 상황을 고려해 보겠습니다.

1. 동일한 콘텐츠를 여러 지리적으로 떨어진 서버에 복제하는 경우
2. 사용자가 **가장 가까운 서버**에서 콘텐츠를 내려받을 수 있도록 하는 경우

예를 들어, **CDN(Content Delivery Network)** 은 전 세계 여러 서버에 동영상을 복제하고,  
각 사용자가 지리적으로 가장 가까운 서버에서 해당 영상을 스트리밍하도록 합니다.  
DNS 시스템 역시 동일한 개념으로, 여러 DNS 서버에 레코드를 복제해둡니다.

이처럼 복제된 콘텐츠에 접근하려는 사용자는  
가장 가까운 서버로 라우팅되는 것이 이상적이며,  
이를 자연스럽게 가능하게 하는 메커니즘이 바로 **BGP의 경로 선택 알고리즘(Route-Selection Algorithm)** 입니다.

### CDN에서의 IP-anycast 동작 방식

그림 5.12를 보면, CDN이 IP-anycast를 설정하는 과정을 구체적으로 설명할 수 있습니다.  
CDN 사업자는 여러 서버(예: Server A, Server B)에 **동일한 IP 주소**를 부여하고,  
각 서버로부터 이 IP 주소를 BGP를 통해 광고(advertise)합니다.

BGP 라우터는 이러한 광고들을 **하나의 동일한 IP 주소에 대한 여러 경로**로 인식합니다.  
즉, 같은 IP 주소를 가진 여러 경로가 존재하지만, 실제로는 서로 다른 물리적 위치에 있는 서버로 향하는 것입니다.  
이때 라우터는 BGP의 경로 선택 알고리즘을 이용하여  
“가장 좋은(best)” 경로 — 즉, **가장 가까운(AS 홉 수가 가장 적은)** 경로를 선택합니다.

예를 들어,  
어떤 BGP 경로(즉, 서버)가 라우터로부터 한 AS만 떨어져 있고,  
다른 경로들은 두 개 이상의 AS를 거쳐야 한다면,  
BGP는 한 홉 거리의 서버로 패킷을 전달합니다.

이 과정을 통해 CDN은 전 세계적으로 분산된 서버 중  
클라이언트에게 가장 가까운 서버로 트래픽을 유도할 수 있습니다.  
이후 클라이언트가 해당 IP 주소로 요청을 보내면,  
BGP는 그 요청을 **“가장 가까운” 서버로 자동으로 전달**합니다.

### 실제 활용과 DNS에서의 IP-anycast

CDN의 예는 IP-anycast의 개념을 잘 보여주지만,  
실제 CDN은 종종 BGP 기반 IP-anycast를 사용하지 않습니다.  
그 이유는 **BGP 경로 변경이 TCP 연결을 분리시킬 수 있기 때문**입니다.  
즉, 같은 TCP 연결의 패킷이 서로 다른 서버로 도착할 위험이 있습니다.

하지만 IP-anycast는 **DNS 시스템**에서는 널리 사용됩니다.  
DNS 루트 서버의 경우 전 세계에 13개의 루트 서버 IP 주소가 존재하지만,  
각 IP 주소는 100개가 넘는 실제 DNS 서버 인스턴스로 복제되어 있습니다.  
DNS 쿼리가 특정 루트 서버 IP로 전송되면,  
IP-anycast는 쿼리를 **가장 가까운 DNS 루트 서버**로 자동으로 라우팅합니다.  
이 방식은 DNS 질의의 응답 지연(latency)을 크게 줄이는 효과를 냅니다.

## 5.4.5 라우팅 정책 (Routing Policy)

라우터가 목적지 경로를 선택할 때,  
**AS(자율 시스템)의 라우팅 정책**은  
경로 길이(AS-PATH)나 핫 포테이토 라우팅보다도 우선될 수 있습니다.

즉, 실제 BGP의 경로 선택 알고리즘에서는  
먼저 정책에 따른 “로컬 우선순위(local-preference)”가 적용되고,  
그 다음에 거리나 비용 등의 요소가 고려됩니다.

### BGP 라우팅 정책의 기본 개념

그림 5.13을 보시면, 여섯 개의 자율 시스템(AS A, B, C, W, X, Y)이 서로 연결되어 있습니다.  
여기서 A, B, C는 **백본(Backbone) 네트워크**,  
W, X, Y는 **엑세스 ISP(Access ISP)** 라고 가정하겠습니다.

- **Access ISP**: 최종 사용자에게 서비스를 제공하는 네트워크
- **Backbone Provider**: 다른 ISP를 연결하는 상위 네트워크

또한, X는 두 개의 서로 다른 백본 네트워크(A와 C)에 연결되어 있으므로,  
**멀티홈드(Multi-homed) ISP** 입니다.

### 트래픽 흐름의 제약과 정책적 제어

Access ISP(W, X, Y)는 반드시 자신의 네트워크를 출입하는 트래픽만 허용해야 합니다.  
즉, 외부 AS 간의 트래픽을 중계해서는 안 됩니다.  
예를 들어, X가 A ↔ C 사이의 트래픽을 전달하는 것은 허용되지 않습니다.

이를 위해 X는 자신의 이웃(BGP 피어)에게 다음과 같은 정책을 적용합니다.

> “나(X)는 B와 C를 통해 도달할 수 있는 다른 네트워크에 대한 경로 정보를 광고하지 않는다.”

이 정책 덕분에,  
예를 들어 B는 X가 Y로 가는 경로를 알고 있더라도  
그 경로가 광고되지 않았기 때문에 B를 통해 Y로 트래픽을 전달할 수 없습니다.  
즉, **선택적인 경로 광고 정책(Selective Route Advertisement)** 으로  
고객/공급자 관계에 따른 트래픽 제어가 가능합니다.

### 공급자(Provider) 네트워크의 정책 예시

이제 공급자 네트워크 B의 입장을 생각해보겠습니다.  
B는 A로부터 “A → W” 경로를 학습했다고 가정합시다.  
따라서 B는 이 경로를 자신의 라우팅 테이블에 추가할 수 있습니다.

그런데 B가 이 정보를 자신의 고객 X에게도 광고해야 할까요?  
만약 그렇게 하면, X는 B를 통해 W로 가는 경로를 알게 되지만,  
동시에 C가 B를 통해 W로 트래픽을 보낼 수도 있습니다.

이 경우 B는 A와 C 사이의 트래픽 중계 비용을 부담하게 됩니다.  
따라서 대부분의 상용 ISP들은 다음의 비공식 원칙을 따릅니다.

> “자신의 네트워크를 통과하는 모든 트래픽은  
> 반드시 그 네트워크의 **고객**이 출발지이거나 목적지여야 한다.”

즉, 다른 ISP 간 트래픽을 무상으로 중계하지 않습니다.  
이러한 관계는 **피어링(peering) 계약**을 통해 개별적으로 협상되며,  
구체적인 조건은 일반적으로 **비공개(confidential)** 입니다.

## 원칙에 기반한 이해 (Principles in Practice)

### 왜 Inter-AS와 Intra-AS 라우팅 프로토콜이 다른가?

이제 우리는 Inter-AS(BGP)와 Intra-AS(OSPF 등)의 구조와 세부 동작을 모두 살펴보았습니다.  
그렇다면 근본적인 질문을 던질 수 있습니다.

> “왜 인터넷에서는 서로 다른 라우팅 프로토콜을 사용하는가?”

이 질문은 AS 내부와 AS 간의 **라우팅 목표 차이**를 명확히 보여줍니다.

### 차이점 1. 정책 (Policy)

AS 간 라우팅에서는 **정책적 요인**이 절대적입니다.  
특정 AS는 트래픽이 어떤 AS를 거쳐야 하는지,  
또는 어떤 트래픽을 자신을 통해 통과시킬지 통제하고자 합니다.  
BGP는 이러한 정책 기반의 제어를 지원하기 위해 설계되었습니다.

반면 AS 내부에서는 모든 라우터가 동일한 관리 기관의 통제 아래 있으므로,  
정책보다는 성능 위주의 경로 결정이 이루어집니다.

### 차이점 2. 확장성 (Scale)

Inter-AS 라우팅은 인터넷 전체 규모(수천 개 이상의 AS)를 다루어야 합니다.  
따라서 효율적이고 확장 가능한 알고리즘이 필수적입니다.  
반면 Intra-AS 라우팅은 상대적으로 작은 규모에서 수행되므로,  
확장성보다는 세밀한 최적화가 더 중요합니다.

### 차이점 3. 성능 (Performance)

Inter-AS 라우팅에서는 정책이 우선이기 때문에,  
항상 “가장 짧은” 경로나 “가장 빠른” 경로가 선택되지는 않습니다.  
때로는 비용이나 사업적 계약 관계 때문에  
더 긴 경로가 선택될 수도 있습니다.

반면 Intra-AS 라우팅에서는 이러한 제약이 적기 때문에,  
주로 **성능 중심(performance-oriented)** 의 경로 선택이 이루어집니다.








## 5.4.6 모든 것을 연결하기: 인터넷 존재감 확보하기

*(Putting the Pieces Together: Obtaining Internet Presence)*

이 절은 BGP 그 자체에 대한 설명이라기보다는,  
지금까지 다룬 여러 개념들—**IP 주소 지정, DNS, 그리고 BGP**—을 하나로 묶어  
인터넷 상에서 “존재감을 확보(Internet Presence)”하는 과정을 보여줍니다.

### 인터넷 연결 준비

여러분이 이제 막 회사를 창립했다고 가정해 보겠습니다.  
회사는 다음과 같은 서버들을 운영한다고 합시다.

- 회사의 제품과 서비스를 소개하는 **공용 웹 서버(Web Server)**
- 직원들이 이메일을 주고받는 **메일 서버(Mail Server)**
- 외부 사용자가 회사 도메인을 찾을 수 있도록 하는 **DNS 서버**

이제 여러분은 전 세계 사람들이 회사의 웹사이트를 방문하여  
제품과 서비스를 확인할 수 있도록 만들고 싶어 합니다.  
또한 직원들이 잠재 고객과 이메일을 주고받을 수 있기를 원합니다.

이 목표를 달성하기 위해서는 가장 먼저 **인터넷 연결(Internet Connectivity)** 이 필요합니다.  
이를 위해 여러분의 회사는 지역 인터넷 서비스 제공자(**Local ISP**)와 계약을 맺어야 합니다.

### IP 주소 할당 및 네트워크 구성

회사는 자체 **게이트웨이 라우터(Gateway Router)** 를 보유하고,  
이를 ISP의 라우터와 연결합니다.  
이 연결은 다음 중 하나의 방식으로 이루어질 수 있습니다.

- 기존 전화선을 활용한 **DSL 연결**
- 전용 회선을 통한 **임대 회선(Leased Line)**
- 기타 액세스 기술 (1장에서 설명한 방식들)

ISP는 회사에 **IP 주소 범위(IP Address Range)** 를 할당합니다.  
예를 들어 `/24` 범위(총 256개의 주소)가 주어질 수 있습니다.

이제 회사는 할당받은 주소 범위 내에서 IP를 분배합니다.  
예를 들어:

- 웹 서버: 203.0.113.1
- 메일 서버: 203.0.113.2
- DNS 서버: 203.0.113.3
- 게이트웨이 라우터: 203.0.113.4
- 사내 네트워크 장비들: 나머지 주소들

이렇게 하면 회사 내부 장비와 외부 네트워크 간 통신이 가능해집니다.

### 도메인 이름 등록 및 DNS 설정

인터넷에서 쉽게 접근하려면,  
ISP 계약 외에도 **도메인 등록 기관(Internet Registrar)** 과 계약해야 합니다.  
예를 들어 회사 이름이 *Xanadu Inc.* 라면,  
`xanadu.com`이라는 도메인을 등록할 수 있습니다.

등록을 마치면 회사는 DNS 시스템 내에 자신의 존재를 등록해야 합니다.  
즉, 외부 사용자가 여러분의 DNS 서버에 접근할 수 있어야 합니다.

이 과정은 다음과 같이 이루어집니다.

1. **DNS 서버의 IP 주소를 등록 기관에 제공**합니다.
2. 등록 기관은 상위 도메인 서버(예: `.com`)에  
   DNS 서버의 이름과 IP 주소를 등록합니다.
3. 이제 사용자는 `xanadu.com` 도메인 이름을 입력하면,  
   DNS 시스템을 통해 회사의 DNS 서버 IP를 자동으로 찾을 수 있습니다.

### 웹 서버와 메일 서버 등록

DNS 서버 안에는 회사의 **서비스별 레코드(Record)** 를 추가해야 합니다.  
예를 들어:

- `www.xanadu.com` → 웹 서버 IP 주소
- `mail.xanadu.com` → 메일 서버 IP 주소

이렇게 하면 사용자가 브라우저에 `www.xanadu.com`을 입력했을 때,  
DNS 시스템이 해당 IP 주소를 찾아 브라우저(예: Alice의 컴퓨터)에 전달하게 됩니다.  
그 결과, 사용자는 **TCP 연결(TCP Connection)** 을 통해  
직접 여러분의 웹 서버와 통신할 수 있게 됩니다.

### BGP의 역할: 전 세계 접근 가능성 확보

이제 DNS와 IP 주소가 설정되었지만,  
여전히 중요한 마지막 단계가 남아 있습니다.  
바로 **전 세계의 라우터들이 여러분 회사의 네트워크를 인식하도록 하는 일**입니다.

예를 들어,  
어떤 사용자인 Alice가 여러분의 웹 서버 IP 주소(203.0.113.1)를 알고 있다고 합시다.  
Alice의 브라우저가 TCP SYN 패킷을 전송하면,  
이 패킷은 인터넷 상의 여러 AS(자율 시스템)를 거쳐 웹 서버까지 도달해야 합니다.

그런데 이를 위해서는,  
경유하는 **모든 라우터가 여러분 회사의 IP 주소 범위(`/24 prefix`)를 알고 있어야** 합니다.  
그렇지 않으면, 라우터는 “이 IP로 가는 길을 모른다”고 판단하고 패킷을 버리게 됩니다.

그렇다면 전 세계 라우터들은 어떻게 이 프리픽스의 존재를 알게 될까요?  
→ **정답은 BGP입니다.**

### BGP를 통한 프리픽스 광고 과정

1. 여러분의 회사가 로컬 ISP와 계약을 맺으면,  
   ISP는 여러분의 주소 범위를 할당합니다.
2. ISP는 BGP를 사용해 여러분의 **프리픽스(prefix)** 를  
   자신과 연결된 다른 ISP들에게 광고(advertise)합니다.
3. 이 광고는 연쇄적으로 다른 AS들로 전파됩니다.
4. 결국 전 세계의 인터넷 라우터들이  
   여러분의 프리픽스(또는 이를 포함한 상위 네트워크 범위)를 인식하게 됩니다.

이 과정을 통해 인터넷 어디서나  
여러분의 웹 서버와 메일 서버로 향하는 패킷이  
정확히 전달될 수 있게 되는 것입니다.

