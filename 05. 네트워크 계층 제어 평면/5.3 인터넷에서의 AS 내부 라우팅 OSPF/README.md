## 5.3 인터넷 내 자율 시스템 내부 라우팅: OSPF (Intra-AS Routing in the Internet: OSPF)

지금까지 살펴본 라우팅 알고리즘들은 네트워크를 단순히 서로 연결된 라우터들의 집합으로 보았습니다.  
즉, 모든 라우터가 동일한 라우팅 알고리즘을 실행하여 전체 네트워크의 경로를 계산한다고 가정했습니다.  
하지만 실제로 이러한 단순한 모델은 현실을 충분히 반영하지 못합니다.  
그 이유는 다음의 두 가지 주요 요인 때문입니다.

### 규모(Scale)

라우터의 수가 많아질수록 라우팅 정보를 저장하고 교환하는 데 드는 통신, 계산, 그리고 메모리의 부담이 커집니다.  
오늘날 인터넷은 수억 개의 라우터로 구성되어 있기 때문에, 모든 라우터가 전체 네트워크의 연결 상태를 저장하고 업데이트하는 것은 불가능에 가깝습니다.  
예를 들어 거리 벡터(DV) 알고리즘이 이처럼 거대한 규모의 라우터 간에 정보를 반복적으로 교환해야 한다면 결코 수렴하지 못할 것입니다.  
따라서 이렇게 거대한 네트워크에서는 라우팅 계산의 복잡도를 줄일 수 있는 구조적 접근이 필요합니다.

### 관리적 자율성(Administrative Autonomy)

인터넷은 **ISP(Internet Service Provider)** 들의 네트워크로 구성되어 있습니다.  
각 ISP는 자신만의 라우터 네트워크를 보유하며, 이를 독립적으로 운영합니다.  
즉, 각 ISP는 자율적으로 내부 라우팅 알고리즘을 선택하거나, 내부 구조를 외부에 공개하지 않을 권한이 있습니다.  
이처럼 한 조직이 자신의 네트워크를 자유롭게 운영하면서도 외부 네트워크와 연결될 수 있도록 하는 것이 이상적입니다.

이 두 문제를 해결하기 위해, 라우터들은 **자율 시스템(Autonomous System, AS)** 으로 구분됩니다.  
각 AS는 단일 관리 기관의 통제 아래 있는 라우터 집합이며, 전 세계적으로 고유한 **ASN(Autonomous System Number)** 으로 식별됩니다.  
AS 번호는 ICANN 산하의 지역 인터넷 등록 기관(RIR)에 의해 관리됩니다.

한 AS 내부의 라우터들은 동일한 라우팅 알고리즘을 사용하며, 서로의 상태 정보를 공유합니다.  
이때 사용하는 프로토콜을 **자율 시스템 내부 라우팅 프로토콜(Intra-Autonomous System Routing Protocol)** 이라고 합니다.

## OSPF (Open Shortest Path First)

**OSPF**는 가장 널리 사용되는 **Intra-AS 라우팅 프로토콜** 중 하나이며,  
그와 유사한 **IS-IS** 프로토콜 역시 같은 목적을 위해 사용됩니다.

“Open”이라는 이름은 OSPF의 명세가 공개되어 있음을 의미합니다.  
(예를 들어 Cisco의 EIGRP는 독점 프로토콜이므로 공개되어 있지 않습니다.)  
현재 가장 많이 사용되는 버전은 **OSPFv2 (RFC 2328)** 이며, 이는 공개 문서로 정의되어 있습니다.

### OSPF의 기본 원리

OSPF는 **링크 상태(Link-State)** 기반의 라우팅 프로토콜입니다.  
링크 상태 정보를 네트워크 내 모든 라우터에게 **플러딩(Flooding)** 방식으로 전파하고,  
각 라우터는 수집된 정보를 바탕으로 **다익스트라(Dijkstra)** 알고리즘을 실행하여  
자신을 루트로 하는 **최단 경로 트리(Shortest-Path Tree)** 를 계산합니다.

각 라우터는 이 트리를 사용하여 자신이 속한 모든 **서브넷(subnet)** 까지의 최단 경로를 찾습니다.

## OSPF 링크 가중치 설정 (Setting OSPF Link Weights)

OSPF 라우팅은 링크마다 가중치(link weight)가 설정되어 있다고 가정합니다.  
이 가중치는 해당 링크를 사용하는 비용을 의미하며,  
다익스트라 알고리즘은 이 비용의 합이 최소가 되는 경로를 선택합니다.

- **가중치의 의미:**  
  링크의 가중치는 대역폭, 트래픽 부하, 신뢰성 등 다양한 요소에 따라 다르게 설정될 수 있습니다.  
  예를 들어 대역폭이 큰 링크는 작은 가중치를 가져, 라우팅 시 더 선호되게 할 수 있습니다.

- **운영자의 역할:**  
  네트워크 관리자는 트래픽 흐름을 제어하기 위해 링크 가중치를 조정할 수 있습니다.  
  예를 들어 네트워크의 특정 경로가 과도하게 사용되지 않도록 가중치를 높게 설정할 수 있습니다.

- **목표:**  
  전체 네트워크의 부하를 균등하게 분산시키고, 링크의 최대 활용률을 최소화하는 것입니다.  
  즉, 네트워크 운영자는 트래픽이 흘러가는 “이상적인 경로”를 먼저 정의한 뒤,  
  OSPF가 이 경로를 선택하도록 링크 가중치를 역으로 설계해야 합니다.

## OSPF의 라우팅 정보 교환 방식

OSPF는 자신이 속한 자율 시스템 내의 모든 라우터에게 정보를 브로드캐스트합니다.  
링크 상태에 변화가 발생하면 즉시 업데이트를 전송하며,  
링크 상태가 변하지 않더라도 **30분 주기**로 다시 전송하여 네트워크의 안정성을 유지합니다.  
이러한 주기적인 갱신은 링크 상태 알고리즘의 신뢰성을 높입니다.

또한, OSPF는 인접 라우터와 **HELLO 메시지**를 주고받으며 연결이 정상인지 확인합니다.  
OSPF 패킷은 **IP 프로토콜 상에서 직접 전송**되며,  
상위 계층 프로토콜 번호는 **89번**을 사용합니다.  
이때 OSPF 자체적으로 신뢰성 있는 전송 및 순서 제어 기능을 제공합니다.

## OSPF의 주요 기능

### 보안(Security)

OSPF 라우터 간의 링크 상태 업데이트는 **인증(Authentication)** 을 통해 보호될 수 있습니다.  
인증이 없을 경우, 악의적인 라우터가 잘못된 정보를 주입할 위험이 있습니다.

- **단순 인증(Simple Authentication):**  
  비밀번호를 평문으로 포함하여 보안 수준이 낮습니다.

- **MD5 인증:**  
  사전에 공유된 비밀 키를 사용하여 OSPF 패킷의 MD5 해시값을 계산하고 검증합니다.  
  이를 통해 데이터의 무결성을 보장하고 재전송 공격(replay attack)을 방지할 수 있습니다.

### 동일 비용 경로(Multiple Same-Cost Paths)

OSPF는 동일한 비용을 가지는 경로가 여러 개 존재할 경우,  
하나의 경로만 사용하는 대신 여러 경로를 동시에 활용할 수 있습니다.  
즉, 트래픽을 여러 경로에 분산시켜 부하를 줄일 수 있습니다.

### 유니캐스트 및 멀티캐스트 통합 지원 (Integrated Support for Unicast and Multicast)

**MOSPF (Multicast OSPF)** 는 OSPF의 확장 버전으로, 멀티캐스트 라우팅을 지원합니다.  
MOSPF는 기존의 링크 상태 데이터베이스를 재활용하여 멀티캐스트 전송 경로를 계산합니다.

### 단일 AS 내의 계층 구조(Support for Hierarchy within a Single AS)

OSPF는 자율 시스템 내에서 **영역(Area)** 단위로 계층적으로 구성할 수 있습니다.

- 각 영역 내에서는 자체적인 링크 상태 알고리즘을 실행합니다.
- 영역 간의 통신은 **Area Border Router (ABR)** 가 담당합니다.
- 모든 영역은 반드시 하나의 **Backbone Area**를 통해 연결됩니다.
- 백본 영역은 전체 AS의 트래픽을 연결하는 중심 역할을 하며,  
  다른 영역 간의 라우팅은 반드시 백본을 거쳐야 합니다.

즉, 패킷은 다음과 같은 과정을 거쳐 전송됩니다.

1. 출발지 영역의 내부 라우터에서 **영역 경계 라우터(ABR)** 로 전달
2. **백본 영역(Backbone Area)** 을 통해 목적지 영역의 ABR로 이동
3. 마지막으로 목적지 영역 내부의 라우터로 전달

