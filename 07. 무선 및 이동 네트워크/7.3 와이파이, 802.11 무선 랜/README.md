# 7.3 WiFi: 802.11 무선 LAN

## 개요

직장, 가정, 교육 기관, 카페, 공항, 거리 등 거의 모든 곳에서 무선 LAN은 오늘날 인터넷에서 가장 중요한 접속 네트워크 기술 중 하나가 되었다. 많은 기술과 표준이 경쟁했지만, 1990년대에 개발된 **IEEE 802.11 무선 LAN**(WiFi라고도 함)이 명확한 승자로 부상했다. 이 절에서는 802.11 무선 LAN의 프레임 구조, 매체 접속 프로토콜, 유선 이더넷 LAN과의 상호연결을 자세히 살펴본다.

### IEEE 802.11 표준의 발전

802.11 표준에는 여러 버전이 있으며, 각각 다른 전송률과 주파수 대역을 사용한다.

| 표준 | 연도 | 최대 데이터율 | 범위 | 주파수 |
|------|------|-------------|------|--------|
| 802.11b | 1999 | 11 Mbps | 30m | 2.4 GHz |
| 802.11g | 2003 | 54 Mbps | 30m | 2.4 GHz |
| 802.11n (WiFi 4) | 2009 | 600 Mbps | 70m | 2.4, 5 GHz |
| 802.11ac (WiFi 5) | 2013 | 3.47 Gbps | 70m | 5 GHz |
| 802.11ax (WiFi 6) | 2020 (예상) | 14 Gbps | 70m | 2.4, 5 GHz |
| 802.11af | 2014 | 35-560 Mbps | 1 Km | 미사용 TV 대역 (54-790 MHz) |
| 802.11ah | 2017 | 347 Mbps | 1 Km | 900 MHz |

802.11b, g, n, ac, ax 표준은 모두 동일한 공통적인 특성을 공유한다. 동일한 매체 접속 프로토콜인 CSMA/CA를 사용하고, 동일한 프레임 구조를 가지며, 동일한 기지국과의 연결 프로토콜을 사용하고, 전송률이 높을수록 범위가 짧아진다.

물리 계층에서 표준들은 주요한 차이점을 보인다. 802.11 장치는 두 가지 주파수 범위에서 동작한다: 2.4 GHz 대역(802.11b/g/n)과 5 GHz 대역(802.11a/n/ac). 2.4 GHz 대역은 무선 전화기, 전자레인지 등 다른 장치와 주파수를 공유하기 때문에 간섭 문제가 있어, 최근 802.11 표준들은 5GHz 대역에서 동작하도록 설계되었다.

802.11n, 802.11ac, 802.11ax는 수신기 방향으로 전송을 적응적으로 빔포밍하는 "스마트" 안테나를 사용하여 여러 스테이션에 동시에 전송할 수 있다. 이는 간섭을 줄이고 주어진 데이터율에서 도달 거리를 증가시킨다. 또한 MIMO(다중 입력 다중 출력) 안테나를 사용하여 송신 측과 수신 측 모두에서 두 개 이상의 안테나를 사용한다.

---

## 7.3.1 802.11 무선 LAN 아키텍처

802.11 무선 LAN 아키텍처의 기본 구성 요소는 **기본 서비스 세트(BSS, Basic Service Set)**이다. BSS는 하나 이상의 무선 스테이션과 중앙 **기지국(base station)**을 포함하며, 이 기지국을 802.11 용어로 **액세스 포인트(AP, Access Point)**라고 한다.

일반적인 가정 네트워크에서는 하나의 AP와 하나의 라우터(보통 하나의 장치로 통합됨)가 BSS를 인터넷에 연결한다. 이더넷 장치와 마찬가지로 각 802.11 무선 스테이션은 스테이션 어댑터(802.11 네트워크 인터페이스 카드)의 펌웨어에 저장된 6바이트 MAC 주소를 가진다. 각 AP도 무선 인터페이스에 대한 MAC 주소를 가지며, 이더넷과 마찬가지로 이러한 MAC 주소는 IEEE에서 관리하며 (이론적으로) 전 세계적으로 고유하다.

AP를 배포하는 무선 LAN을 **인프라 무선 LAN**이라고 하며, "인프라"란 AP와 AP를 상호연결하는 유선 이더넷 인프라를 의미한다. IEEE 802.11 스테이션은 또한 스스로를 그룹화하여 **애드혹 네트워크**를 형성할 수 있다. 이는 중앙 통제가 없고 "외부 세계"와 연결이 없는 네트워크로, 서로 가까이에 있고 통신이 필요하며 기존 네트워크 인프라가 없는 모바일 장치에 의해 "즉석에서" 형성된다. 이 절에서는 인프라 무선 LAN에 초점을 맞춘다.

### 채널과 연결

802.11에서 각 무선 스테이션은 네트워크 계층 데이터를 송수신하기 전에 AP와 **연결(associate)**해야 한다. 네트워크 관리자가 AP를 설치할 때 관리자는 AP에 한두 단어의 **서비스 세트 식별자(SSID, Service Set Identifier)**를 할당한다. iPhone에서 Wi-Fi 설정을 선택하면 범위 내 각 AP의 SSID가 표시되는 목록이 나타난다. 관리자는 또한 AP에 채널 번호를 할당해야 한다.

802.11이 2.4 GHz~2.4835 GHz 주파수 범위에서 동작한다는 것을 이해하기 위해, 802.11은 이 85 MHz 대역 내에서 11개의 부분적으로 겹치는 채널을 정의한다. 4개 이상의 채널로 분리된 경우에만 두 채널이 겹치지 않는다. 특히 채널 1, 6, 11의 세트가 세 개의 겹치지 않는 채널의 유일한 세트이다. 이는 관리자가 같은 물리적 위치에 세 개의 802.11b AP를 설치하고 채널 1, 6, 11을 각 AP에 할당하고 AP들을 스위치로 상호연결함으로써 표 7.1에 표시된 최대 전송률의 3배의 총 최대 전송률로 무선 LAN을 만들 수 있다는 것을 의미한다.

### WiFi 정글에 들어가기

이제 사무실, 대학 캠퍼스, 카페 등 WiFi 정글(여러 AP의 신호가 도달할 수 있는 물리적 위치)에 스마트폰, 태블릿, 노트북을 들고 들어간다고 가정해 보자. WiFi 정글에 들어가면 무선 장치는 인터넷 접속을 얻기 위해 각 AP 중 정확히 하나와 연결해야 한다. 연결이란 무선 장치가 AP와 가상 연결을 만들고 자신과 외부 세계 사이의 모든 데이터를 이 AP를 통해서만 송수신하겠다는 것을 의미한다. 하지만 장치가 어떤 AP와 연결할 것인지 어떻게 알며, 실제로 연결되지 않은 경우 어떻게 찾을 수 있을까?

802.11 표준은 AP를 선택하기 위해 연결할 사용 가능한 AP 중 어떤 것을 선택할지에 대한 알고리즘을 명시하지 않으며, 이 알고리즘은 802.11 펌웨어 및 소프트웨어 설계자에게 맡겨져 있다. 일반적으로 장치는 신호 강도가 가장 높은 비콘 프레임을 수신한 AP를 선택한다. 높은 신호 강도가 좋지만(그림 7.3 참조), 신호 강도는 장치가 경험하는 성능을 결정하는 유일한 AP 특성이 아니다.

### 수동 스캐닝과 능동 스캐닝

채널을 스캔하고 비콘 프레임을 청취하는 과정을 **수동 스캐닝(passive scanning)**이라고 한다. 무선 장치는 프로브 프레임을 브로드캐스트하여 **능동 스캐닝(active scanning)**을 수행할 수도 있다. 이 프로브 프레임은 무선 장치 범위 내의 모든 AP가 수신하며, AP들은 프로브 응답 프레임으로 응답한다.

연결할 AP를 선택한 후 무선 장치는 AP에 연결 요청 프레임을 보내고, AP는 연결 응답 프레임으로 응답한다. 능동 스캐닝의 경우 초기 프로브 요청 프레임에 응답하는 AP가 (가능한 많은) AP 중 장치가 연결을 선택할 AP를 모르기 때문에 이 두 번째 요청/응답 핸드셰이크가 필요하다. AP와 연결되면 장치는 AP가 속한 서브넷(IP 주소 지정 의미에서 4.3.3절)에 가입하고자 할 것이다. 따라서 장치는 일반적으로 AP를 통해 서브넷에 DHCP 발견 메시지(그림 4.21 참조)를 보내 서브넷의 IP 주소를 얻는다.

### 인증

특정 AP와 연결을 생성하기 위해 무선 장치는 AP에 자신을 인증해야 할 수 있다. 802.11 무선 LAN은 인증 및 접속을 위한 여러 대안을 제공한다. 한 가지 접근 방식은 장치의 MAC 주소를 기반으로 무선 네트워크에 대한 접속을 허용하는 것이다. 많은 인터넷 카페에서 사용하는 두 번째 접근 방식은 사용자 이름과 비밀번호를 사용한다. 두 경우 모두 AP는 일반적으로 RADIUS [RFC 2865] 또는 DIAMETER [RFC 6733]과 같은 프로토콜을 사용하여 무선 장치와 인증 서버 사이의 정보를 중계하는 인증 서버와 통신한다.

---

## 7.3.2 802.11 MAC 프로토콜

무선 장치가 AP와 연결되면 AP와 데이터 프레임을 주고받기 시작할 수 있다. 하지만 여러 무선 장치 또는 AP 자체가 동시에 같은 채널로 데이터 프레임을 전송하려고 할 수 있으므로 전송을 조정하기 위한 다중 접속 프로토콜이 필요하다.

6장과 7.2.1절에서 논의한 바와 같이 크게 세 가지 다중 접속 프로토콜 클래스가 있다: 채널 분할(CDMA 포함), 랜덤 접속, 순번 방식. 이더넷과 그 랜덤 접속 프로토콜의 큰 성공에서 영감을 받아 802.11 설계자들은 802.11 무선 LAN을 위해 랜덤 접속 프로토콜을 선택했다. 이 랜덤 접속 프로토콜을 **충돌 회피를 사용하는 CSMA**, 더 간략하게 **CSMA/CA**라고 한다.

이더넷의 CSMA/CD와 마찬가지로 CSMA/CA의 "CSMA"는 "반송파 감지 다중 접속(carrier sense multiple access)"을 의미하며, 각 스테이션이 전송 전에 채널을 감지하고 채널이 사용 중으로 감지되면 전송을 자제한다는 것을 뜻한다. 이더넷과 802.11 모두 반송파 감지 랜덤 접속을 사용하지만, 두 MAC 프로토콜에는 중요한 차이점이 있다.

### 왜 충돌 검출이 아닌 충돌 회피인가?

802.3 이더넷 프로토콜과 달리 802.11 MAC 프로토콜은 충돌 검출을 구현하지 **않는다**. 여기에는 두 가지 중요한 이유가 있다:

첫째, 충돌을 검출하려면 자신의 신호를 보내면서 동시에 수신(다른 스테이션도 전송 중인지 확인)하는 능력이 필요하다. 수신 신호의 강도가 802.11 어댑터에서 전송 신호의 강도에 비해 일반적으로 매우 작기 때문에 충돌을 검출할 수 있는 하드웨어를 만드는 것이 비용이 많이 든다.

둘째, 더 중요한 것은 어댑터가 전송하면서 동시에 청취할 수 있다 하더라도(그리고 채널이 사용 중임을 감지하면 전송을 중단한다고 가정하면), 7.2절에서 논의한 숨겨진 터미널 문제와 페이딩으로 인해 어댑터는 여전히 모든 충돌을 검출할 수 없다.

802.11 무선 LAN은 충돌 검출을 사용하지 않기 때문에, 스테이션이 프레임을 전송하기 시작하면 **프레임 전체를 전송한다**. 예상할 수 있듯이 충돌이 빈번할 때 전체 프레임(특히 긴 프레임)을 전송하면 다중 접속 프로토콜의 성능이 크게 저하될 수 있다. 충돌 가능성을 줄이기 위해 802.11은 여러 충돌 회피 기술을 사용한다.

### 링크 계층 확인응답

<img width="497" height="487" alt="Image" src="https://github.com/user-attachments/assets/bfe75b0c-bcec-4f22-9111-bd1a638d021d" />

충돌 회피를 고려하기 전에 먼저 802.11의 **링크 계층 확인응답** 방식을 살펴봐야 한다. 7.2절에서 무선 LAN의 스테이션이 프레임을 보낼 때 다양한 이유로 프레임이 목적지 스테이션에 온전히 도착하지 않을 수 있다는 것을 상기하자. 이러한 무시할 수 없는 실패 가능성에 대처하기 위해 802.11 MAC 프로토콜은 링크 계층 확인응답을 사용한다.

그림 7.10에 표시된 것처럼 목적지 스테이션이 CRC를 통과하는 프레임을 수신하면 **짧은 프레임간 간격(SIFS, Short Inter-frame Spacing)**이라는 짧은 시간 동안 기다린 후 확인응답 프레임을 보낸다. 전송 스테이션이 주어진 시간 내에 확인응답을 수신하지 못하면 오류가 발생했다고 가정하고 CSMA/CA 프로토콜을 사용하여 채널에 접속한 후 프레임을 재전송한다. 일정 횟수의 재전송 후에도 확인응답을 수신하지 못하면 전송 스테이션은 포기하고 프레임을 폐기한다.

### CSMA/CA 프로토콜

링크 계층 확인응답을 사용하는 방법을 논의했으므로 이제 802.11 CSMA/CA 프로토콜을 설명할 준비가 되었다. 스테이션(무선 장치 또는 AP)이 전송할 프레임이 있다고 가정하자.

1. 스테이션이 처음에 채널이 유휴 상태임을 감지하면 **분산 프레임간 간격(DIFS, Distributed Inter-frame Space)**이라는 짧은 시간 후에 프레임을 전송한다.

2. 그렇지 않으면 스테이션은 이진 지수 백오프를 사용하여 랜덤 백오프 값을 선택하고 채널이 유휴 상태로 감지되면 DIFS 후에 이 값을 카운트다운한다. 채널이 사용 중으로 감지되는 동안 카운터 값은 동결된다.

3. 카운터가 0에 도달하면(채널이 유휴 상태일 때만 발생할 수 있음) 스테이션은 전체 프레임을 전송하고 확인응답을 기다린다.

4. 확인응답을 수신하면 전송 스테이션은 프레임이 목적지 스테이션에서 올바르게 수신되었음을 안다. 스테이션에 보낼 다른 프레임이 있으면 2단계에서 CSMA/CA 프로토콜을 시작한다. 확인응답을 수신하지 못하면 전송 스테이션은 더 큰 간격에서 선택된 랜덤 값으로 2단계에서 백오프 단계를 다시 시작한다.

이더넷의 CSMA/CD에서는 스테이션이 채널이 유휴 상태로 감지되자마자 전송을 시작한다. 그러나 CSMA/CA에서는 카운트다운하는 동안에도 채널이 유휴 상태라고 감지될 때도 스테이션은 전송을 자제한다. 왜 CSMA/CD와 CDMA/CA는 다른 접근 방식을 취할까?

802.11에서는 두 스테이션이 각각 전송할 데이터 프레임이 있지만 세 번째 스테이션이 이미 전송 중이기 때문에 어느 스테이션도 전송하지 않는 시나리오를 고려해 보자. 이더넷의 CSMA/CD에서는 두 스테이션이 세 번째 스테이션이 전송을 완료했음을 감지하자마자 각각 전송한다. 이는 충돌을 일으킬 것이지만, 두 스테이션 모두 전송을 중단하고 프레임의 나머지 쓸모없는 전송을 피할 것이므로 CSMA/CD에서는 심각한 문제가 아니다.

그러나 802.11에서는 상황이 상당히 다르다. 802.11은 충돌을 검출하고 전송을 중단하지 않기 때문에 충돌을 겪는 프레임은 전체가 전송된다. 따라서 802.11의 목표는 가능한 한 충돌을 피하는 것이다. 802.11에서 두 스테이션이 채널이 사용 중임을 감지하면 둘 다 즉시 랜덤 백오프에 들어가 서로 다른 백오프 값을 선택하기를 바란다. 이 값들이 실제로 다르면 채널이 유휴 상태가 되자마자 두 스테이션 중 하나가 다른 것보다 먼저 전송을 시작할 것이고, (두 스테이션이 서로 숨겨져 있지 않다면) "패배" 스테이션은 "승리" 스테이션의 신호를 듣고 카운터를 동결하고 승리 스테이션이 전송을 완료할 때까지 전송을 자제할 것이다.

### 숨겨진 터미널 대처: RTS와 CTS

<img width="560" height="344" alt="Image" src="https://github.com/user-attachments/assets/5a1a7bf8-fd09-4a01-8fbe-a38c7e07b9b1" />

802.11 MAC 프로토콜은 숨겨진 터미널이 있는 경우에도 충돌을 피하는 데 도움이 되는 멋진(그러나 선택적인) 예약 방식도 포함한다. 그림 7.11의 맥락에서 이 방식을 살펴보자. 두 개의 무선 스테이션과 하나의 액세스 포인트가 있다. 두 무선 스테이션 모두 AP의 범위(음영 원으로 표시) 내에 있고 둘 다 AP와 연결되어 있다. 그러나 페이딩으로 인해 무선 스테이션의 신호 범위는 음영 원의 내부로 제한된다. 따라서 각 무선 스테이션은 서로 숨겨져 있지만 둘 다 AP에서는 숨겨져 있지 않다.

이제 숨겨진 터미널이 왜 문제가 될 수 있는지 생각해 보자. 스테이션 H1이 프레임을 전송하고 있고 H1의 전송 중간에 스테이션 H2가 AP에 프레임을 보내려고 한다고 가정하자. H1의 전송을 듣지 못하는 H2는 먼저 DIFS 간격을 기다린 후 프레임을 전송하여 충돌을 일으킨다. 따라서 채널은 H1의 전송 기간 전체와 H2의 전송 동안 낭비된다.

이 문제를 피하기 위해 IEEE 802.11 프로토콜은 스테이션이 짧은 **전송 요청(RTS, Request to Send)** 제어 프레임과 짧은 **전송 허가(CTS, Clear to Send)** 제어 프레임을 사용하여 채널에 대한 접속을 예약할 수 있게 한다. 송신자가 DATA 프레임을 보내려고 할 때, 먼저 AP에 RTS 프레임을 보내 DATA 프레임과 확인응답(ACK) 프레임을 전송하는 데 필요한 총 시간을 표시한다. AP가 RTS 프레임을 수신하면 CTS 프레임을 브로드캐스트로 응답한다. 이 CTS 프레임은 두 가지 목적을 가진다: 송신자에게 명시적으로 전송 허가를 주고, 다른 스테이션에게 예약된 기간 동안 전송하지 말라고 지시한다.

RTS와 CTS 프레임의 사용은 두 가지 중요한 방식으로 성능을 향상시킬 수 있다. 첫째, 긴 DATA 프레임은 채널이 예약된 후에만 전송되므로 숨겨진 스테이션 문제가 완화된다. 둘째, RTS와 CTS 프레임이 짧기 때문에 RTS 또는 CTS 프레임이 포함된 충돌은 짧은 RTS 또는 CTS 프레임의 기간 동안만 지속된다. RTS와 CTS 프레임이 올바르게 전송되면 이후의 DATA와 ACK 프레임은 충돌 없이 전송되어야 한다.

RTS/CTS 교환이 충돌을 줄이는 데 도움이 될 수 있지만, 지연을 도입하고 채널 리소스를 소비한다. 이러한 이유로 RTS/CTS 교환은 긴 DATA 프레임의 전송을 위해 채널을 예약하는 데만 사용된다(사용되는 경우). 실제로 각 무선 스테이션은 프레임이 임계값보다 길 때만 RTS/CTS 시퀀스를 사용하도록 RTS 임계값을 설정할 수 있다. 많은 무선 스테이션에서 기본 RTS 임계값은 최대 프레임 길이보다 크므로 모든 DATA 프레임에 대해 RTS/CTS 시퀀스가 생략된다.

---

## 7.3.3 IEEE 802.11 프레임

802.11 프레임은 이더넷 프레임과 많은 유사점을 공유하지만, 무선 링크에서의 사용에 특정한 여러 필드도 포함한다.

### 페이로드와 CRC 필드

프레임의 핵심은 페이로드로, 일반적으로 IP 데이터그램 또는 ARP 패킷으로 구성된다. 필드는 최대 2,312바이트까지 허용되지만 일반적으로 1,500바이트 미만이다. 이더넷 프레임과 마찬가지로 802.11 프레임은 수신기가 수신된 프레임의 비트 오류를 감지할 수 있도록 32비트 순환 중복 검사(CRC)를 포함한다. 무선 LAN에서는 유선 LAN보다 비트 오류가 훨씬 더 흔하므로 CRC가 여기서 더욱 유용하다.

### 주소 필드

802.11 프레임에서 가장 눈에 띄는 차이점은 **네 개의 주소 필드**를 가지고 있다는 것이다. 각 필드는 6바이트 MAC 주소를 담을 수 있다. 왜 네 개의 주소 필드가 필요할까? 이더넷에서처럼 출발지 MAC 필드와 목적지 MAC 필드만으로 충분하지 않은가? 세 개의 주소 필드가 인터네트워킹 목적, 특히 무선 스테이션에서 AP를 통해 라우터 인터페이스로 네트워크 계층 데이터그램을 이동시키는 데 필요하다는 것이 밝혀졌다.

802.11 표준은 이 필드들을 다음과 같이 정의한다:

- **주소 2**는 프레임을 전송하는 스테이션의 MAC 주소이다. 따라서 무선 스테이션이 프레임을 전송하면 해당 스테이션의 MAC 주소가 주소 2 필드에 삽입된다. 마찬가지로 AP가 프레임을 전송하면 AP의 MAC 주소가 주소 2 필드에 삽입된다.

- **주소 1**은 프레임을 수신할 무선 스테이션의 MAC 주소이다. 따라서 모바일 무선 스테이션이 프레임을 전송하면 주소 1은 목적지 AP의 MAC 주소를 포함한다. 마찬가지로 AP가 프레임을 전송하면 주소 1은 목적지 무선 스테이션의 MAC 주소를 포함한다.

- **주소 3**의 목적을 이해하기 위해, BSS(AP와 무선 스테이션으로 구성)는 서브넷의 일부이고 이 서브넷이 일부 라우터 인터페이스를 통해 다른 서브넷에 연결된다는 것을 상기하자. 주소 3은 이 라우터 인터페이스의 MAC 주소를 포함한다.

### 시퀀스 번호, 지속 시간 및 프레임 제어 필드

802.11에서 스테이션이 다른 스테이션에서 프레임을 올바르게 수신하면 확인응답을 보낸다는 것을 상기하자. 확인응답이 손실될 수 있으므로 송신 스테이션은 주어진 프레임의 여러 복사본을 보낼 수 있다. rdt2.1 프로토콜(3.4.1절)에서의 논의에서처럼 시퀀스 번호를 사용하면 수신자가 새로 전송된 프레임과 이전 프레임의 재전송을 구별할 수 있다. 따라서 802.11 프레임의 시퀀스 번호 필드는 3장의 전송 계층에서와 정확히 같은 목적을 여기 링크 계층에서 수행한다.

802.11 프로토콜은 전송 스테이션이 데이터 프레임을 전송하는 시간과 확인응답을 전송하는 시간을 포함하는 기간 동안 채널을 예약할 수 있게 한다. 이 지속 시간 값은 프레임의 지속 시간 필드(데이터 프레임과 RTS 및 CTS 프레임 모두)에 포함된다.

프레임 제어 필드에는 많은 서브필드가 있다. *type*과 *subtype* 필드는 연결, RTS, CTS, ACK 및 데이터 프레임을 구별하는 데 사용된다. *to*와 *from* 필드는 다양한 주소 필드의 의미를 정의하는 데 사용된다. 마지막으로 WEP 필드는 암호화가 사용되고 있는지 여부를 나타낸다.

---

## 7.3.4 같은 IP 서브넷 내의 이동성

<img width="525" height="279" alt="Image" src="https://github.com/user-attachments/assets/e4137bca-22fc-47d8-be6d-177f52c67ae0" />

무선 LAN의 물리적 범위를 늘리기 위해 기업과 대학은 종종 같은 IP 서브넷 내에 여러 BSS를 배포한다. 이는 자연스럽게 BSS 간의 이동성 문제를 제기한다. 무선 스테이션이 진행 중인 TCP 세션을 유지하면서 한 BSS에서 다른 BSS로 원활하게 이동하는 방법은 무엇인가?

그림 7.15는 호스트 H1이 BSS 1에서 BSS 2로 이동하는 두 개의 상호연결된 BSS를 보여준다. 이 예에서 두 BSS를 연결하는 상호연결 장치가 라우터가 *아니기* 때문에 AP를 포함한 두 BSS의 모든 스테이션은 같은 IP 서브넷에 속한다. 따라서 H1이 BSS 1에서 BSS 2로 이동할 때 IP 주소와 모든 진행 중인 TCP 연결을 유지할 수 있다.

그러나 H1이 BSS 1에서 BSS 2로 이동할 때 구체적으로 어떤 일이 발생할까? H1이 AP1에서 멀어지면 H1은 AP1의 신호가 약해지는 것을 감지하고 더 강한 신호를 스캔하기 시작한다. H1은 AP2에서 비콘 프레임을 수신하고(많은 기업 및 대학 설정에서 AP1과 같은 SSID를 가짐) AP1과의 연결을 해제하고 IP 주소를 유지하면서 진행 중인 TCP 세션을 유지하며 AP2와 연결한다.

이는 호스트 및 AP 관점에서 핸드오버 문제를 해결한다. 하지만 그림 7.15의 스위치는 어떨까? 호스트가 한 AP에서 다른 AP로 이동했음을 어떻게 알까? 6장에서 스위치가 "자기 학습"하고 자동으로 포워딩 테이블을 구축한다는 것을 상기하자. 이 자기 학습 기능은 가끔 이동(예: 직원이 한 부서에서 다른 부서로 이동하는 경우)을 잘 처리하지만, 스위치는 BSS 간을 이동하면서 TCP 연결을 유지하려는 고도로 이동성 있는 사용자를 지원하도록 설계되지 않았다.

여기서 문제를 인식하기 위해 이동 전에 스위치는 H1의 MAC 주소를 H1에 도달할 수 있는 나가는 스위치 인터페이스와 짝지은 포워딩 테이블 항목을 가지고 있다는 것을 상기하자. H1이 처음에 BSS1에 있으면 H1으로 향하는 데이터그램은 AP1을 통해 H1으로 전달된다. 그러나 H1이 BSS2와 연결되면 프레임은 AP2로 전달되어야 한다. 한 가지 해결책(약간 편법이지만)은 새 연결 직후 AP2가 H1의 출발지 주소로 스위치에 브로드캐스트 이더넷 프레임을 보내는 것이다. 스위치가 프레임을 수신하면 포워딩 테이블을 업데이트하여 H1이 AP2를 통해 도달할 수 있도록 한다.

---

## 7.3.5 802.11의 고급 기능

802.11 네트워크에서 발견되는 두 가지 고급 기능에 대한 짧은 논의로 802.11 다루기를 마무리한다. 이 기능들은 802.11 표준에 완전히 명시되어 있지 않고 오히려 표준에 명시된 메커니즘에 의해 가능해진다는 것을 알 수 있다. 이를 통해 다양한 벤더가 자체(독점적) 접근 방식을 사용하여 이러한 기능을 구현할 수 있어 경쟁사보다 우위를 점할 수 있다.

### 전송률 적응

그림 7.3에서 다른 변조 기술(제공하는 전송률이 다름)이 다른 SNR 시나리오에 적합하다는 것을 앞서 살펴보았다. 예를 들어, 처음에 기지국에서 20미터 떨어진 곳에서 높은 신호 대 잡음비를 가진 802.11 사용자를 고려해 보자. 높은 SNR이 주어지면 사용자는 낮은 BER을 유지하면서 높은 전송률을 제공하는 물리 계층 변조 기술을 사용하여 기지국과 통신할 수 있다. 이제 사용자가 이동성을 갖게 되어 기지국에서 멀어지고 기지국으로부터의 거리가 증가함에 따라 SNR이 떨어진다고 가정하자. 이 경우 기지국과 사용자 사이에서 작동하는 802.11 프로토콜에 사용되는 변조 기술이 변경되지 않으면 SNR이 감소함에 따라 BER이 허용할 수 없을 정도로 높아지고 결국 전송된 프레임이 올바르게 수신되지 않게 된다.

이러한 이유로 일부 802.11 구현에는 현재 또는 최근 채널 특성에 기반하여 사용할 기본 물리 계층 변조 기술을 적응적으로 선택하는 전송률 적응 기능이 있다. 노드가 연속으로 두 개의 프레임을 확인응답 없이 보내면(채널의 비트 오류에 대한 암묵적 표시) 전송률은 다음으로 낮은 속도로 떨어진다. 연속으로 10개의 프레임이 확인응답되거나 마지막 후퇴 이후의 시간을 추적하는 타이머가 만료되면 전송률은 다음으로 높은 속도로 증가한다.

### 전력 관리

전력은 모바일 장치에서 귀중한 자원이므로 802.11 표준은 802.11 노드가 감지, 전송, 수신 기능 및 기타 회로가 "켜져" 있어야 하는 시간을 최소화할 수 있는 전력 관리 기능을 제공한다.

802.11 전력 관리는 다음과 같이 작동한다. 노드는 802.11 프레임 헤더의 전력 관리 비트를 1로 설정하여 AP에 절전 모드로 전환할 것임을 나타낼 수 있다. 그런 다음 노드의 타이머는 AP가 비콘 프레임을 보내기로 예정된 직전에 노드를 깨우도록 설정된다(AP는 일반적으로 100밀리초마다 비콘 프레임을 보낸다). AP에서 보내는 비콘 프레임에는 프레임이 AP에 버퍼링된 노드 목록이 포함되어 있다. 노드에 대해 버퍼링된 프레임이 없으면 다시 절전 모드로 돌아갈 수 있다. 그렇지 않으면 노드는 AP에 폴링 메시지를 보내 버퍼링된 프레임이 전송되도록 명시적으로 요청할 수 있다.

100밀리초의 비콘 간격, 250마이크로초의 웨이크업 시간, 비콘 프레임을 수신하고 버퍼링된 프레임이 없는지 확인하는 비슷하게 짧은 시간으로, 보내거나 받을 프레임이 없는 노드는 99%의 시간 동안 절전 상태에 있을 수 있어 상당한 에너지 절약을 가져온다.

---

## 7.3.6 개인 영역 네트워크: 블루투스

**블루투스** 네트워크는 빠르게 일상 생활의 일부가 된 것 같다. 아마도 무선 키보드, 마우스 또는 기타 주변 장치를 컴퓨터에 연결하는 "케이블 대체" 기술로 블루투스 네트워크를 사용해 본 적이 있을 것이다. 또는 무선 이어버드, 스피커, 시계, 건강 모니터링 밴드를 스마트폰에 연결하거나 스마트폰을 자동차의 오디오 시스템에 연결하는 데 블루투스 네트워크를 사용했을 수 있다.

이러한 모든 경우에서 블루투스는 짧은 범위(수십 미터 이하), 저전력, 저비용으로 작동한다. 이러한 이유로 블루투스 네트워크는 때때로 **무선 개인 영역 네트워크(WPAN)** 또는 **피코넷**이라고 한다.

블루투스 네트워크는 설계상 작고 비교적 단순하지만, 시분할 다중화(TDM, 6.3.1절), 주파수 분할(6.3.1절), 랜덤화된 백오프(6.3.2절), 폴링(6.3.3절), 오류 감지 및 수정(6.2절), ACK와 NAK를 통한 신뢰성 있는 데이터 전송(3.4.1절)을 포함하여 우리가 이전에 공부한 많은 링크 수준 네트워킹 기술로 가득 차 있다.

블루투스 네트워크는 전자레인지, 차고 문 오프너, 무선 전화기와 같은 다른 가정용 기기와 함께 무허가 2.4 GHz ISM(산업, 과학, 의료) 무선 대역에서 작동한다. 결과적으로 블루투스 네트워크는 잡음과 간섭을 명시적으로 염두에 두고 설계되었다. 블루투스 무선 채널은 625마이크로초의 타임 슬롯을 가진 TDM 방식으로 운영된다. 각 타임 슬롯 동안 송신자는 79개 채널 중 하나에서 전송하며, 채널(주파수)은 슬롯마다 알려진 그러나 유사 난수 방식으로 변경된다. 이러한 채널 호핑 형태를 **주파수 호핑 확산 스펙트럼(FHSS)**이라고 하며, ISM 대역에서 작동하는 다른 장치나 기기의 간섭이 슬롯의 일부분에만 블루투스 통신에 영향을 미치도록 사용된다. 블루투스 데이터 전송률은 최대 3 Mbps에 달할 수 있다.

블루투스 네트워크는 애드혹 네트워크이다. 네트워크 인프라(예: 액세스 포인트)가 필요 없다. 대신 블루투스 장치는 최대 8개의 활성 장치로 구성된 피코넷으로 스스로를 조직해야 한다. 이 장치들 중 하나는 마스터로 지정되며 나머지 장치는 클라이언트로 활동한다. 마스터 노드는 피코넷의 클록 결정자 역할을 한다. 마스터는 활성 장치 외에 피코넷에 최대 255개의 "파킹된" 장치도 있을 수 있다. 파킹된 장치는 종종 에너지를 절약하기 위한 일종의 "절전 모드"에 있으며 마스터의 일정에 따라 주기적으로 깨어나 마스터로부터 비콘 메시지를 수신한다. 파킹된 장치는 상태가 파킹에서 활성으로 변경될 때까지 마스터와 통신할 수 없다. 그 전까지는 마스터 노드가 지시한 대로 동작한다.
