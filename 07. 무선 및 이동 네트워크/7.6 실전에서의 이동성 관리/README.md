# 7.6 실전에서의 이동성 관리

이전 절에서 우리는 장치 이동성을 지원하기 위한 네트워크 아키텍처 개발의 핵심적인 근본적인 도전과 잠재적 해결책을 확인했습니다: 홈 네트워크와 방문 네트워크의 개념, 해당 홈 네트워크에 가입된 모바일 장치에 대한 정보 및 제어의 중앙 지점으로서 홈 네트워크의 역할, 방문 네트워크 사이를 로밍하는 모바일 장치를 추적하기 위해 홈 네트워크의 이동성 관리 엔티티에 필요한 제어 평면 기능, 그리고 통신 상대와 모바일 장치가 데이터그램을 교환할 수 있도록 하는 직접 및 간접 라우팅의 데이터 평면 접근 방식 등이 있습니다. 이제 이러한 원칙이 실제로 어떻게 적용되는지 살펴보겠습니다! 7.6.1절에서는 4G/5G 네트워크의 이동성 관리를 학습하고, 7.6.2절에서는 인터넷을 위해 제안된 Mobile IP를 살펴보겠습니다.

---

## 7.6.1 4G/5G 네트워크에서의 이동성 관리

<img width="590" height="328" alt="Image" src="https://github.com/user-attachments/assets/6ede3280-247c-4879-825f-b85d52fcd451" />

7.4절에서 4G 및 새롭게 등장하는 5G 아키텍처에 대한 이전 학습을 통해 4G/5G 이동성 관리에서 핵심적인 역할을 하는 모든 네트워크 요소에 대해 알게 되었습니다. 이제 이러한 요소들이 오늘날의 4G/5G 네트워크에서 이동성 서비스를 제공하기 위해 어떻게 서로 상호 운용되는지 살펴보겠습니다. 이 네트워크들은 이전 3G 셀룰러 음성 및 데이터 네트워크와 훨씬 이전의 2G 음성 전용 네트워크에 뿌리를 두고 있습니다. 이것은 지금까지 배운 것을 종합하고, 몇 가지 더 고급 주제를 소개하며, 5G 이동성 관리에 대한 향후 전망을 제공하는 데 도움이 될 것입니다.

모바일 사용자(예: 자동차의 승객)가 방문 4G/5G 네트워크에 스마트폰을 연결하고 원격 서버에서 HD 비디오를 스트리밍하기 시작한 다음, 하나의 4G/5G 기지국 셀 커버리지에서 다른 기지국으로 이동하는 간단한 시나리오를 고려해 봅시다. 이 시나리오의 네 가지 주요 단계는 그림 7.28에 나와 있습니다:

1. **모바일 장치와 기지국 연결**: 모바일 장치가 방문 네트워크의 기지국과 연결합니다.

2. **모바일 장치를 위한 네트워크 요소의 제어 평면 구성**: 방문 네트워크와 홈 네트워크가 모바일 장치가 방문 네트워크에 상주함을 나타내는 제어 평면 상태를 설정합니다.

3. **모바일 장치를 위한 포워딩 터널의 데이터 평면 구성**: 방문 네트워크와 홈 네트워크가 모바일 장치와 스트리밍 서버가 홈 네트워크의 패킷 데이터 네트워크 게이트웨이(P-GW)를 통해 간접 라우팅을 사용하여 IP 데이터그램을 송수신할 수 있는 터널을 설정합니다.

4. **한 기지국에서 다른 기지국으로의 모바일 장치 핸드오버**: 모바일 장치가 핸드오버를 통해 한 기지국에서 다른 기지국으로 방문 네트워크에 대한 연결 지점을 변경합니다.

이제 이 네 단계 각각을 더 자세히 살펴보겠습니다.

### 1. 기지국 연결

7.4.2절에서 모바일 장치가 기지국과 연결하는 절차를 학습했습니다. 모바일 장치는 해당 지역의 기지국이 송신하는 주 신호를 모든 주파수에서 수신 대기한다는 것을 배웠습니다. 모바일 장치는 이러한 기지국에 대한 정보를 점진적으로 더 많이 획득하고, 궁극적으로 연결할 기지국을 선택하며, 해당 기지국과 제어 시그널링 채널을 부트스트랩합니다. 이 연결의 일부로, 모바일 장치는 기지국에 국제 모바일 가입자 식별번호(IMSI)를 제공하는데, 이는 모바일 장치를 고유하게 식별할 뿐만 아니라 홈 네트워크 및 기타 추가 가입자 정보도 제공합니다.

### 2. 모바일 장치를 위한 LTE 네트워크 요소의 제어 평면 구성

모바일 장치-기지국 시그널링 채널이 설정되면, 기지국은 방문 네트워크의 MME에 연락할 수 있습니다. MME는 모바일 노드를 대신하여 홈 네트워크와 방문 네트워크 모두에서 여러 4G/5G 요소를 참조하고 구성합니다:

- MME는 모바일 장치가 제공한 IMSI 및 기타 정보를 사용하여 해당 가입자에 대한 인증, 암호화 및 사용 가능한 네트워크 서비스 정보를 검색합니다. 해당 정보는 MME의 로컬 캐시에 있거나, 모바일 장치가 최근에 연락한 다른 MME에서 검색하거나, 모바일 장치의 홈 네트워크에 있는 HSS에서 검색할 수 있습니다. 상호 인증 프로세스(8.8절에서 더 자세히 다룸)는 방문 네트워크가 모바일 장치의 신원을 확신하고 장치가 연결하려는 네트워크를 인증할 수 있도록 보장합니다.

- MME는 모바일 장치의 홈 네트워크에 있는 HSS에 모바일 장치가 이제 방문 네트워크에 상주함을 알리고, HSS는 데이터베이스를 업데이트합니다.

- 기지국과 모바일 장치는 모바일 장치와 기지국 사이에 설정될 데이터 평면 채널의 매개변수를 선택합니다(제어 평면 시그널링 채널은 이미 동작 중임을 상기하십시오).

### 3. 모바일 장치를 위한 포워딩 터널의 데이터 평면 구성

<img width="585" height="370" alt="Image" src="https://github.com/user-attachments/assets/ca60ffe2-71ba-42a4-8812-b23f219ea3be" />

그 다음으로 MME는 그림 7.29에 표시된 대로 모바일 장치를 위한 데이터 평면을 구성합니다. 두 개의 터널이 설정됩니다. 하나의 터널은 기지국과 방문 네트워크의 서빙 게이트웨이 사이에 있습니다. 두 번째 터널은 서빙 게이트웨이와 *모바일 장치의 홈 네트워크*에 있는 PDN 게이트웨이 라우터 사이에 있습니다.

4G LTE는 이 형태의 대칭적 간접 라우팅을 구현합니다 - 모바일 장치로부터/로의 모든 트래픽은 장치의 홈 네트워크를 통해 터널링됩니다. 4G/5G 터널은 [3GPP GTPv1-U 2019]에 명시된 GPRS 터널링 프로토콜(GTP)을 사용합니다. GTP 헤더의 터널 엔드포인트 ID(TEID)는 데이터그램이 속한 터널을 나타내며, 터널 엔드포인트 간에 여러 흐름을 다중화하고 역다중화할 수 있게 합니다.

그림 7.29(방문 네트워크에서 모바일 로밍의 경우)의 터널 구성을 그림 7.18(모바일 장치의 홈 네트워크 내에서만 이동성의 경우)과 비교하는 것이 유익합니다. 두 경우 모두 서빙 게이트웨이가 모바일 장치와 동일한 네트워크에 공동 상주하지만, PDN 게이트웨이(모바일 장치의 홈 네트워크에 있는 PDN 게이트웨이)는 모바일 장치와 다른 네트워크에 있을 수 있음을 알 수 있습니다. 이것이 바로 간접 라우팅입니다.

간접 라우팅의 대안으로, **로컬 브레이크아웃(local breakout)** 이라고 알려진 방식이 명시되어 있는데, 여기서 서빙 게이트웨이가 로컬 방문 네트워크의 PDN 게이트웨이로 터널을 설정합니다. 그러나 실제로 로컬 브레이크아웃은 널리 사용되지 않습니다.

터널이 구성되고 활성화되면, 모바일 장치는 이제 홈 네트워크의 PDN 게이트웨이를 통해 인터넷으로부터/으로 패킷을 전달할 수 있습니다!

### 4. 핸드오버 관리

<img width="578" height="331" alt="Image" src="https://github.com/user-attachments/assets/7dc4e19a-944b-4f04-914e-b6ff72887cfa" />

**핸드오버(handover)** 는 모바일 장치가 한 기지국에서 다른 기지국으로 연결을 변경할 때 발생합니다. 아래에 설명된 핸드오버 프로세스는 모바일 장치가 홈 네트워크에 상주하든 방문 네트워크에서 로밍하든 동일합니다.

그림 7.30에 표시된 것처럼, 핸드오버 전에 장치로/에서의 데이터그램은 처음에 하나의 기지국(**소스** 기지국)을 통해 모바일로 포워딩되고, 핸드오버 후에는 다른 기지국(**타겟** 기지국)을 통해 모바일 장치로 라우팅됩니다. 기지국 간의 핸드오버는 모바일 장치가 새 기지국에서 송수신하는 것뿐만 아니라 그림 7.29의 서빙-게이트웨이-기지국 터널의 기지국 측 변경도 초래합니다.

핸드오버가 발생하는 데에는 몇 가지 이유가 있을 수 있습니다. 예를 들어, 현재 기지국과 모바일 간의 신호가 심하게 손상되어 통신이 저하되거나, 셀이 과부하 상태여서 많은 양의 트래픽을 처리해야 하는 상황에서 혼잡한 셀 근처로 모바일 장치를 이동하여 덜 혼잡한 셀로 전환하면 이를 완화할 수 있습니다. 모바일 장치는 주기적으로 현재 기지국의 비콘 신호 특성과 인근 기지국에서 수신되는 신호를 측정합니다. 이러한 측정은 초당 한두 번 반복됩니다. 이러한 측정, 인근 셀의 모바일 부하, 기타 요인에 기반하여 소스 기지국은 핸드오버를 시작할지 여부를 선택할 수 있습니다. 4G/5G 표준은 어떤 기지국이 핸드오버를 시작할지 또는 핸드오버를 수행할지 여부를 결정하는 특정 알고리즘을 명시하지 않습니다; 이것은 활발한 연구 분야입니다.

그림 7.30은 소스 기지국이 모바일 장치를 타겟 기지국으로 핸드오버하기로 결정할 때 관련된 단계를 보여줍니다:

1. **소스 기지국이 타겟 기지국을 선택하고 핸드오버 요청 메시지 전송**: 현재(소스) 기지국이 타겟 기지국을 선택하고, 타겟 기지국에 핸드오버 요청 메시지를 보냅니다.

2. **타겟 기지국의 자원 확인**: 타겟 기지국이 모바일 장치를 지원하고 서비스 품질 요구 사항을 충족하기 위해 충분한 자원(예: 라디오 액세스 네트워크의 타임 슬롯)과 기타 자원을 가지고 있는지 확인합니다. 이 자원 사전 할당은 시간 소모적인 기지국 연결 프로토콜을 거치지 않아도 되므로 모바일 장치가 핸드오버를 가능한 한 빨리 실행할 수 있도록 합니다. 타겟 기지국은 소스 기지국에 핸드오버 요청 확인 메시지로 응답하며, 타겟 기지국에서 새 기지국과 연결하기 위해 필요한 모바일 장치의 모든 정보를 포함합니다.

3. **소스 기지국이 모바일 장치에 핸드오버 명령 전송**: 소스 기지국은 모바일 장치에 핸드오버 요청 확인 메시지를 수신하여 타겟 기지국의 신원 및 채널 액세스 정보가 포함된 핸드오버 명령 메시지를 보냅니다. 이 시점에서 모바일 장치는 새 타겟 기지국으로의 재구성 데이터그램을 전송하기 시작할 수 있습니다. 모바일 장치 관점에서 핸드오버는 이제 완료되었습니다! 그러나 네트워크 내에서 수행해야 할 작업이 아직 남아 있습니다.

4. **소스 기지국의 데이터그램 포워딩**: 소스 기지국은 모바일 장치로 데이터그램 포워딩을 중지하고 대신 수신하는 터널된 데이터그램을 타겟 기지국으로 포워딩합니다. 타겟 기지국은 나중에 이러한 데이터그램을 모바일 장치로 전달합니다.

5. **타겟 기지국이 서빙 게이트웨이와 MME에 알림**: 타겟 기지국은 서빙 게이트웨이와 타겟 기지국에 모바일 장치가 이제 자신에게 연결되어 있음을 알리고, 서빙-게이트웨이-기지국 터널을 소스 기지국이 아닌 타겟 기지국에서 종단하도록 재구성합니다.

6. **타겟 기지국이 소스 기지국에 확인**: 타겟 기지국은 소스 기지국에 터널이 재구성되었음을 확인하여 소스 기지국이 해당 모바일 장치와 관련된 자원을 해제할 수 있게 합니다.

7. **타겟 기지국의 데이터그램 전달 시작**: 이 시점에서 타겟 기지국은 핸드오버 중 소스 기지국이 타겟 기지국으로 포워딩한 데이터그램과 재구성된 서빙 게이트웨이 터널에서 새로 도착하는 데이터그램을 포함하여 모바일 장치로 데이터그램 전달을 시작할 수 있습니다. 또한 모바일 장치로부터 수신된 발신 데이터그램을 서빙 게이트웨이로의 터널로 포워딩할 수 있습니다.

위에서 논의한 것과 같은 오늘날의 4G LTE 네트워크의 로밍 구성은 미래에 등장하는 5G 네트워크에서도 사용될 것입니다. 그러나 7.4.6절의 논의에서 5G 네트워크는 셀 크기가 상당히 작아 더 밀집될 것임을 상기하십시오. 이로 인해 핸드오버가 더욱 중요한 네트워크 기능이 될 것입니다. 또한 많은 실시간 5G 애플리케이션에서 낮은 핸드오버 지연 시간이 중요합니다. 5장에서 학습한 SDN 프레임워크로 셀룰러 네트워크 제어 평면을 마이그레이션하면 더 높은 용량, 더 낮은 지연 시간의 5G 셀룰러 네트워크 제어 평면 구현이 가능해집니다. 5G 컨텍스트에서 SDN 적용은 상당한 연구의 주제입니다.

---

## 7.6.2 Mobile IP

오늘날의 인터넷은 4G/5G 셀룰러 네트워크에서 만났던 "이동 중" 모바일 사용자를 위한 서비스 유형을 제공하는 널리 배포된 인프라가 없습니다. 그러나 이것은 인터넷 환경에서 그러한 서비스를 제공하기 위한 기술적 해결책이 부족해서가 아닙니다! 실제로, 아래에서 간략히 논의할 Mobile IP 아키텍처와 프로토콜 [RFC 5944]은 20년 이상 인터넷 RFC에 의해 표준화되었으며, 새롭고 더 안전하며 더 일반화된 이동성 솔루션에 대한 연구가 계속되고 있습니다.

대신, Mobile IP 배포를 둔화시킨 것은 아마도 동기 부여 비즈니스 및 사용 사례의 부족과 셀룰러 네트워크에서 대안적인 이동성 솔루션의 시기적절한 개발 및 배포였습니다. 20년 전, 2G 셀룰러 네트워크는 이미 모바일 사용자를 위한 솔루션(모바일 음성 서비스, "킬러 앱")을 제공했습니다. 또한 음성 *및* 데이터를 지원하는 차세대 3G 네트워크가 지평선에 있었습니다. 아마도 이중 기술 솔루션 - 진정으로 이동 중일 때(즉, 그림 7.24의 이동성 스펙트럼의 가장 오른쪽) 셀룰러 네트워크를 통한 모바일 서비스와 고정 또는 로컬 이동 시(즉, 그림 7.24의 이동성 스펙트럼의 가장 왼쪽) 802.11 네트워크 또는 유선 네트워크를 통한 인터넷 서비스 - 이 20년 전에 가지고 있었고 오늘날에도 여전히 미래에 지속될 것입니다.

그럼에도 불구하고 Mobile IP 표준을 간략하게 개요하는 것이 유익할 것입니다. 왜냐하면 셀룰러 네트워크와 동일한 많은 서비스를 제공하고 동일한 기본 이동성 원칙 중 많은 것을 구현하기 때문입니다. 이 교과서의 이전 판들은 여기서 제공할 것보다 더 깊은 Mobile IP 연구를 제공했습니다. 관심 있는 독자는 이 교과서의 웹사이트에서 이 퇴역한 자료를 찾을 수 있습니다. 이동성을 지원하기 위한 인터넷 아키텍처와 프로토콜, 총칭하여 Mobile IP로 알려진 것은 주로 IPv4용 RFC 5944에 정의되어 있습니다. Mobile IP는 4G/5G와 마찬가지로 복잡한 표준이며, 상세히 설명하려면 전체 책이 필요할 것입니다. 여기서의 우리의 modest 목표는 Mobile IP의 가장 중요한 측면에 대한 개요를 제공하는 것입니다.

Mobile IP의 전체 아키텍처와 요소는 셀룰러 공급자 네트워크와 놀랍도록 유사합니다. 홈 네트워크에 대한 강한 개념이 있으며, 여기서 모바일 장치는 영구 IP 주소를 가지고, 방문 네트워크(Mobile IP에서 "외부(foreign)" 네트워크로 알려짐)가 있으며, 여기서 모바일 장치는 케어-오브-주소(care-of-address)를 할당받습니다. Mobile IP의 홈 에이전트는 LTE HSS와 유사한 기능을 합니다: 외부 네트워크의 외부 에이전트로부터 업데이트를 받아 모바일 장치의 위치를 추적하며, 4G 모바일 장치가 상주하는 방문 네트워크에서 HSS가 이동성 관리 엔티티(MME)로부터 업데이트를 받는 것과 같습니다. 그리고 4G/5G와 Mobile IP 모두 간접 라우팅을 사용하여 모바일 노드로 라우팅하며, 홈 및 방문/외부 네트워크의 게이트웨이 라우터를 연결하기 위해 터널을 사용합니다. 표 7.3은 Mobile IP 아키텍처의 요소와 4G/5G 네트워크의 유사한 요소와의 비교를 요약합니다.

### 4G/5G와 Mobile IP 아키텍처 비교

| 4G/5G 요소 | Mobile IP 요소 | 설명 |
|-----------|---------------|------|
| 홈 네트워크 | 홈 네트워크 | |
| 방문 네트워크 | 외부 네트워크 | |
| IMSI 식별자 | 영구 IP 주소 | 전역적으로 고유한 라우팅 가능 주소 정보 |
| 홈 가입자 서비스 (HSS) | 홈 에이전트 | |
| 이동성 관리 엔티티 (MME) | 외부 에이전트 | |
| 데이터 평면: 홈 네트워크를 통한 간접 포워딩, 홈 및 방문 네트워크 간 터널링, 모바일 장치가 상주하는 네트워크 내 터널링 | 데이터 평면: 홈 네트워크를 통한 간접 포워딩, 홈 및 방문 네트워크 간 터널링 | |
| 기지국 (eNode-B) | 액세스 포인트 (AP) | Mobile IP에는 특정 AP 기술이 명시되지 않음 |
| 무선 액세스 네트워크 | WLAN | Mobile IP에는 특정 WLAN 기술이 명시되지 않음 |

### Mobile IP 표준의 세 가지 주요 구성 요소

Mobile IP 표준은 세 가지 주요 부분으로 구성됩니다:

- **에이전트 발견(Agent discovery)**: Mobile IP는 외부 에이전트가 자신의 네트워크에 연결하려는 모바일 장치에게 이동성 서비스를 광고하는 데 사용하는 프로토콜을 정의합니다. 이러한 서비스에는 외부 네트워크에서 사용할 케어-오브-주소를 모바일 장치에 제공하는 것, 모바일 장치의 홈 네트워크에 있는 홈 에이전트에 모바일 장치 등록, 모바일 장치로부터/으로의 데이터그램 포워딩 등이 포함됩니다.

- **홈 에이전트 등록(Registration with the home agent)**: Mobile IP는 모바일 장치 및/또는 외부 에이전트가 모바일 장치의 홈 에이전트에 케어-오브-주소를 등록하고 등록 해제하는 데 사용하는 프로토콜을 정의합니다.

- **데이터그램의 간접 라우팅(Indirect routing of datagrams)**: Mobile IP는 또한 홈 에이전트가 모바일 장치로 데이터그램을 포워딩하는 방식을 정의하며, 데이터그램 포워딩 규칙과 오류 조건 처리, 여러 형태의 터널링 [RFC 2003, RFC 2004]을 포함합니다.

다시 말씀드리지만, 여기서 Mobile IP에 대한 우리의 커버리지는 의도적으로 간략했습니다. 관심 있는 독자는 이 절의 참조 자료나 이 교과서의 이전 판에서 Mobile IP에 대한 더 자세한 논의를 참조하시기 바랍니다.
