# 7.5 이동성 관리: 원칙

무선 네트워크에서 통신 링크의 무선적 특성을 다루었으니, 이제 이러한 무선 링크가 가능하게 하는 **이동성(mobility)** 에 대해 관심을 돌릴 차례입니다. 넓은 의미에서, 모바일 장치는 시간이 지남에 따라 네트워크에 대한 연결 지점을 변경하는 장치입니다. "이동성"이라는 용어는 컴퓨터와 전화 분야 모두에서 다양한 의미를 가지므로, 먼저 이동성의 형태를 주의 깊게 살펴보는 것이 좋습니다.

---

## 7.5.1 장치 이동성: 네트워크 계층 관점

<img width="572" height="253" alt="Image" src="https://github.com/user-attachments/assets/f5713deb-d439-436f-ac21-ae542c406077" />

네트워크 계층의 관점에서, 물리적으로 이동하는 모바일 장치는 네트워크에 대한 연결 지점 사이를 이동할 때 장치가 얼마나 활성화되어 있는지에 따라 매우 다른 도전 과제를 제시합니다. 스펙트럼의 한쪽 끝에서, 그림 7.24의 시나리오 (a)는 스스로 전원을 끄거나 네트워크 사이를 물리적으로 이동하지만 이동할 때 모바일 장치의 전원을 끄는 모바일 사용자입니다. 예를 들어, 학생이 무선 교실 네트워크에서 연결을 끊고 전원을 끈 다음, 식당으로 이동하여 식당 공용 네트워크에 연결하거나 도서관의 무선 네트워크에 연결할 수 있습니다.

네트워킹 관점에서 공부하는 동안 이 장치는 우리의 모빌인데 - 액세스 네트워크에 연결하고 해당 액세스 네트워크에 남아 있으면서 나중에 해당 무선 액세스 네트워크와의 연결을 해제하고 분리합니다. 이 경우의 (비)이동성은 7.3과 7.4에서 이미 학습한 네트워킹 메커니즘을 사용하여 완전히 처리할 수 있습니다.

그림 7.24의 시나리오 (b)에서, 장치는 물리적으로 이동하지만 동일한 액세스 네트워크에 연결된 상태로 유지됩니다. 이 경우에도 장치는 네트워크 계층 관점에서 이동하지 않습니다. 또한, 장치가 동일한 802.11 AP 또는 LTE 기지국과 연결된 상태로 유지되는 경우, 장치는 링크 계층 관점에서도 이동하지 않습니다.

네트워크 관점에서 우리의 관심사는 시나리오 (c), 즉 장치가 액세스 네트워크를 변경하는 경우(예: 802.11 WLAN 또는 LTE 셀)에서 시작되며, 상위 계층 연결(예: TCP 연결)을 유지하면서 이동합니다. 여기서 네트워크는 **핸드오버(handover)** 를 수행해야 합니다 - 하나의 AP 또는 기지국에서 다른 AP 또는 기지국으로의 전환자. 7.6절에서 핸드오버를 자세히 다룹니다. 모바일 장치가 여러 공급자 네트워크 사이를 로밍할 때, 시나리오 (d)에서처럼, 공급자들은 핸드오버를 함께 조정해야 하며, 이는 핸드오버 프로세스를 상당히 복잡하게 만듭니다.

---

## 7.5.2 홈 네트워크와 방문 네트워크에서의 로밍

7.4.1절에서 셀룰러 4G LTE 네트워크에 대한 논의에서 알 수 있듯이, 모든 가입자는 일부 셀룰러 공급자와 "홈"을 가지고 있습니다. 홈 가입자 서비스(HSS)가 각 가입자에 대한 정보를 저장한다는 것을 배웠는데, 여기에는 전역적으로 고유한 장치 ID(모바일 장치의 SIM 카드에 내장됨)와 가입자가 액세스할 수 있는 서비스, 암호화 키 정보에 대한 정보가 포함됩니다.

장치가 셀룰러 네트워크에 연결할 때, 해당 장치는 **홈 네트워크(home network)** 가 아닌 **방문 네트워크(visited network)** 에서 **로밍(roaming)** 한다고 합니다. 모바일 장치가 방문하는 네트워크에 연결하고 해당 네트워크에서 로밍할 때, 홈 네트워크와 방문 네트워크 사이에 조정이 필요합니다. 인터넷은 홈 네트워크 또는 방문 네트워크에 대한 강한 개념이 없습니다. 실제로, 학생의 홈 네트워크는 학교 또는 해당 회사의 네트워크일 수 있으며, 모바일 전문가의 경우 홈 네트워크가 해당 회사의 네트워크일 수 있습니다. 방문 네트워크는 그들이 방문하는 학교 또는 회사의 네트워크일 수 있습니다. 하지만 인터넷 아키텍처에서 "홈 네트워크"라는 개념에 내장된 네트워크의 개념이 없습니다. 7.6절에서 간략히 다룰 **Mobile IP 프로토콜** 은 홈 네트워크화된 네트워크의 개념을 강력하게 통합한 제안이었습니다.

홈 네트워크를 가진 모바일 장치의 개념은 두 가지 중요한 이점을 제공합니다: 홈 네트워크는 그 장치에 대한 위치 정보를 찾을 수 있는 단일 위치를 제공하고, 그 장치와 우리가 인터넷이라고 부르는 것 사이에 조정 지점을 제공합니다.

이 개념의 잠재적 가치를 이해하기 위해, 가정을 떠나는 20대의 Bob의 비유를 고려해 봅시다. Bob은 이동하면서 기숙사와 아파트 등에서 살며 종종 주소를 변경합니다. 만약 오래된 친구 Alice가 Bob의 현재 주소를 알고 싶다면, Bob의 현재 주소를 어떻게 찾을 수 있을까요? 한 가지 방법은 Bob의 가족에게 연락하는 것입니다. 왜냐하면 가족이 Bob의 위치에 대한 중앙 정보 및 조정 지점 역할을 하기 때문입니다. 그러면 Alice는 Bob에게 직접(예: Bob의 가족에서 얻은 주소를 사용하여 Alice가 Bob의 가족 집으로 편지를 보내고 그곳에서 Bob에게 전달) 또는 간접(예: Alice가 Bob의 부모에게 편지를 보내 전달하도록 요청)으로 연락할 수 있습니다.

---

## 7.5.3 모바일 장치로부터의/로의 직접 및 간접 라우팅

<img width="712" height="491" alt="Image" src="https://github.com/user-attachments/assets/b7450d7e-3d71-43d9-9079-f2b24c4ef6ec" />

이제 인터넷에 연결된 호스트(우리는 이를 **통신 상대(correspondent)** 라고 부름)가 모바일 장치와 통신하려는 그림 7.25의 시나리오를 고려해 봅시다. 4G에서 이것은 국제 모바일 가입자 식별번호(IMSI)와 모바일 장치의 SIM 카드에 저장된 관련 전화번호가 될 것입니다. 모바일 인터넷 사용자의 경우, 이것은 Mobile IP 아키텍처의 경우처럼 홈 네트워크의 IP 주소 범위 내의 영구 IP 주소가 될 것입니다.

통신 상대가 보낸 데이터그램이 모바일 장치에 도달할 수 있게 하는 모바일 네트워크 아키텍처에서 어떤 접근 방식을 사용할 수 있을까요? 세 가지 기본 접근 방식을 식별할 수 있으며, 후자의 두 가지가 실제로 채택되고 있습니다.

### 기존 IP 주소 인프라 활용

방문 네트워크에 있는 모바일 장치로 라우팅하는 가장 간단한 접근 방식은 기존 IP 주소 지정 인프라를 단순히 사용하는 것입니다 - 아키텍처에 새로운 것을 추가하지 않는 것입니다. 무엇이 더 쉬울 수 있겠습니까!

그림 4.21의 논의에서 ISP가 BGP를 사용하여 도달 가능한 네트워크의 CIDR화된 주소 범위를 열거하여 목적지 네트워크로의 경로를 광고한다는 것을 상기해 봅시다. 방문 네트워크는 특정 모바일 장치가 해당 네트워크에 상주한다는 것을 다른 모든 네트워크에 광고할 수 있습니다 - 본질적으로 해당 장치로의 매우 구체적인 경로를 광고합니다. 모든 데이터그램은 항상 해당 모바일 장치가 위치한 모바일 장치로 전달되므로, 이것은 매력적입니다. 하지만 큰 단점이 있습니다 - 확장성 문제입니다. 네트워크 전체 라우터는 잠재적으로 수십억 개의 모바일 장치에 대한 포워딩 테이블 항목을 유지해야 하고, 장치의 항목은 한 네트워크에서 다른 네트워크로 이동할 때마다 업데이트되어야 합니다. 이것은 분명히 실제로 작동하지 않습니다! 몇 가지 추가적인 단점은 이 장의 끝에 있는 문제에서 탐구됩니다.

대안적이고 더 실용적인 접근 방식(실제로 채택된 것)은 네트워크 계층 기능을 인터넷 아키텍처 연구에서 반복되는 주제로 밀어내는 것입니다 - 모바일 장치의 홈 네트워크를 통해서입니다. 이렇게 하는 자연스러운 방법은 같은 방식입니다. 부모의 모바일 장치의 홈 네트워크가 해당 장치 자녀의 위치를 추적하는 것과 같습니다. HSS의 이동성 관리 엔티티(MME)가 모바일 장치가 상주하는 방문 네트워크를 추적할 수 있습니다. 이 정보는 그림 7.25에서 HSS 데이터베이스에 표시됩니다. 당신은 이미 이것을 접했을 것입니다. 4G LTE의 MME와 HSS 요소를 연구할 때(섹션 4.3.4 참조) 이것을 우연히 만났을 것입니다.

여기서 가능성에는 모바일 장치의 홈 네트워크에서 방문 네트워크의 주소 범위에 있는 새 주소를 할당하거나 NAT IP 주소를 할당하거나 방문 네트워크에서 영구 IP 주소를 제공하는 것(섹션 4.3.4 참조)이 포함됩니다. 후자의 두 경우, 모바일 장치는 홈 네트워크의 HSS에 있는 영구 식별자 외에도 임시 주소(새로 할당된 IP 주소)를 갖습니다. 이러한 경우는 그림 7.25에서 NAT 주소를 수신하는 대응자와 같은 우편물을 수신하는 대응자를 쓸 때 Bob이 현재 살고 있는 집의 주소를 사용하는 것과 유사합니다. NAT 주소의 경우, 모바일 장치로 향하는 데이터그램은 결국 방문 네트워크의 NAT 게이트웨이 라우터에 도달하게 되며, 이 라우터는 NAT 변환을 수행하고 모바일 장치로 데이터그램을 전달합니다.

### 모바일 장치로의 간접 라우팅

<img width="690" height="488" alt="Image" src="https://github.com/user-attachments/assets/8bd8619a-7694-44c8-ab5a-fcdfa37c46e1" />

이제 그림 7.24의 딜레마에 대한 해결책의 여러 요소를 살펴보았습니다: 홈 및 방문 네트워크, MME와 HSS, 그리고 모바일 장치 주소 지정. 하지만 데이터그램은 어떻게 주소 지정되고 모바일 장치로 전달되어야 할까요? HSS만이(네트워크 전체 라우터가 아닌) 모바일 장치의 위치를 알고 있으므로, 통신 상대는 단순히 데이터그램을 모바일 장치의 영구 주소로 주소 지정하여 네트워크로 보낼 수 없습니다. 더 많은 것이 필요합니다. 두 가지 접근 방식을 식별할 수 있습니다: 간접 라우팅과 직접 라우팅.

**간접 라우팅(indirect routing)** 접근 방식에서, 통신 상대는 단순히 데이터그램을 모바일 장치의 영구 주소로 주소 지정하고 데이터그램을 네트워크로 보냅니다. 모바일 장치가 홈 네트워크에 있든 방문 네트워크에 있든 전혀 알지 못합니다. 이동성은 통신 상대에게 완전히 투명합니다. 이러한 데이터그램은 평소처럼 먼저 모바일 장치의 홈 네트워크로 라우팅됩니다. 이것은 그림 7.26의 단계 1에서 설명됩니다.

단계는 다음과 같습니다:

1. 통신 상대가 데이터그램을 모바일 장치의 영구 주소로 전송합니다.
2. 홈 네트워크 게이트웨이가 데이터그램을 수신하고, HSS를 쿼리하여 모바일 장치의 현재 위치(방문 네트워크)를 확인합니다.
3. 방문 네트워크의 이동성 관리자가 모바일 장치의 위치를 확인합니다.
4a. 홈 네트워크가 데이터그램을 방문 네트워크 게이트웨이로 터널링합니다.
4b. 또는 데이터그램이 직접 통신 상대에게 전송될 수 있습니다.

방문 네트워크 게이트웨이 라우터는 수신된 데이터그램을 모바일 장치로 전달하기 위해 NAT 변환을 수행합니다.

간접 라우팅을 위한 몇 가지 추가 프로토콜이 필요합니다:

- **모바일 장치-방문 네트워크 연결 프로토콜**: 모바일 장치는 방문 네트워크와 연결해야 하며, 방문 네트워크를 떠날 때도 마찬가지로 연결을 해제해야 합니다.

- **방문 네트워크-홈 네트워크 HSS 등록 프로토콜**: 방문 네트워크는 모바일 장치의 위치를 홈 네트워크의 HSS에 등록해야 하며, 아마도 장치 인증을 수행할 때 HSS에서 얻은 정보를 사용해야 합니다.

- **홈 네트워크 게이트웨이와 방문 네트워크 게이트웨이 라우터 사이의 데이터그램 터널링 프로토콜**: 송신 측은 통신 상대의 원본 데이터그램의 캡슐화 및 포워딩을 수행합니다. 수신 측에서 게이트웨이 라우터는 역캡슐화, NAT 변환, 그리고 원본 데이터그램을 모바일 장치로 전달합니다.

이전 논의는 장치가 네트워크 사이를 이동할 때 모바일 장치가 통신 상대와의 지속적인 연결을 유지하는 데 필요한 모든 요소를 제공합니다. 장치가 한 방문 네트워크에서 다른 방문 네트워크로 로밍할 때, 새 방문 네트워크 정보가 홈 네트워크 HSS에서 업데이트되어야 하고, 홈-게이트웨이-라우터-방문-게이트웨이-라우터 터널 엔드포인트가 이동해야 합니다. 하지만 장치가 네트워크 사이를 이동할 때 모바일 장치가 데이터그램의 중단된 흐름을 볼까요? 한 방문 네트워크에서 모바일 장치의 연결 해제와 다음 방문 네트워크에 대한 연결 사이의 시간이 작은 한, 손실되는 데이터그램은 거의 없습니다. 3장에서 종단간 연결이 네트워크 혼잡으로 인한 데이터그램 손실을 경험할 수 있다는 것을 상기해 봅시다. 따라서 장치가 네트워크 사이를 이동할 때 연결 내의 가끔 데이터그램 손실은 절대로 치명적인 문제가 아닙니다. 손실 없는 통신이 필요한 경우, 상위 계층 메커니즘은 이러한 손실이 네트워크 혼잡에서 발생하든 장치 이동성에서 발생하든 데이터그램 손실에서 복구합니다.

간접 라우팅 접근 방식은 모바일 IP 표준 [RFC 5944]와 4G LTE 네트워크 [Sauter 2014]에서 사용됩니다. 세부 사항, 특히 사용되는 터널링 절차는 위의 일반적인 논의와 약간 다릅니다.

### 모바일 장치로의 직접 라우팅

<img width="654" height="503" alt="Image" src="https://github.com/user-attachments/assets/08099e92-f580-4fc1-8d9a-b7e8575635ca" />

그림 7.26에 설명된 간접 라우팅 접근 방식은 **삼각 라우팅 문제(triangle routing problem)** 라고 알려진 비효율성을 겪습니다 - 모바일 장치로 주소 지정된 데이터그램은 통신 상대와 로밍 모바일 장치 사이에 훨씬 더 효율적인 경로가 존재하더라도, 먼저 홈 네트워크로 전달된 다음 방문 네트워크로 전달되어야 합니다. 최악의 경우, 해외 동료가 방문하고 있는 바로 그 네트워크가 우리 모바일 사용자의 홈 네트워크인 모바일 사용자를 상상해 보십시오. 두 사람이 나란히 앉아 데이터를 교환하고 있습니다. 모바일 사용자와 그의 해외 동료 사이의 데이터그램은 모바일 사용자의 홈 네트워크로 전달된 다음 다시 방문 네트워크로 돌아갑니다!

**직접 라우팅(direct routing)** 은 삼각 라우팅의 비효율성을 극복하지만, 추가적인 복잡성의 대가가 있습니다. 그림 7.27에 표시된 직접 라우팅 접근 방식에서, 통신 상대는 먼저 모바일이 상주하는 방문 네트워크를 발견합니다. 이것은 간접 라우팅의 경우처럼 모바일 장치의 방문 네트워크가 HSS에 등록되어 있다고 가정하고, 모바일 장치의 홈 네트워크에 있는 HSS를 쿼리하여 수행됩니다. 이것은 그림 7.27의 단계 1과 2로 표시됩니다. 그런 다음 통신 상대는 모바일 장치의 방문 네트워크에 있는 게이트웨이 라우터로 자신의 네트워크에서 직접 데이터그램을 터널링합니다.

직접 라우팅은 삼각 라우팅 문제를 극복하지만, 두 가지 중요한 추가 도전 과제를 도입합니다:

- 통신 상대가 모바일 장치의 방문 네트워크를 얻기 위해 HSS를 쿼리하는 모바일 사용자 위치 프로토콜이 필요합니다(그림 7.27의 단계 1과 2). 이것은 모바일 장치가 HSS에 자신의 위치를 등록하는 데 필요한 프로토콜에 추가됩니다.

- 모바일 장치가 한 방문 네트워크에서 다른 방문 네트워크로 이동할 때, 통신 상대가 새 방문 네트워크로 데이터그램을 전달하도록 어떻게 알릴 것인가? 간접 라우팅의 경우, 이 문제는 홈 네트워크에서 HSS를 업데이트하고 새 방문 네트워크의 게이트웨이 라우터에서 종료하도록 터널 엔드포인트를 변경함으로써 쉽게 해결되었습니다. 그러나 직접 라우팅에서 이러한 방문 네트워크 변경은 그렇게 쉽게 처리되지 않습니다. 왜냐하면 HSS는 세션 시작 시에만 통신 상대에 의해 쿼리되기 때문입니다. 따라서 모바일 장치가 이동할 때마다 통신 상대를 능동적으로 업데이트하는 추가 프로토콜 메커니즘이 필요합니다. 이 장의 끝에 있는 두 가지 문제에서 이 문제에 대한 해결책을 탐구합니다.
