# 6.6 데이터 센터 네트워킹

## 개요

Google, Microsoft, Amazon, Alibaba와 같은 인터넷 기업들은 수만에서 수십만 대의 호스트를 수용하는 대규모 데이터 센터를 구축해왔다. 데이터 센터는 인터넷에 연결될 뿐만 아니라 내부 호스트를 상호연결하는 **데이터 센터 네트워크**를 포함한다.

### 데이터 센터의 세 가지 목적

| 목적 | 설명 |
|------|------|
| **콘텐츠 제공** | 웹 페이지, 검색 결과, 이메일, 스트리밍 비디오 등의 콘텐츠 제공 |
| **대규모 병렬 컴퓨팅** | 검색 엔진의 분산 인덱스 계산과 같은 특정 데이터 처리 작업 수행 |
| **클라우드 컴퓨팅** | AWS, Microsoft Azure, Alibaba Cloud 등을 통해 기업의 모든 IT 요구 처리 |

---

## 6.6.1 데이터 센터 아키텍처

### 데이터 센터 비용 구조

대규모 데이터 센터의 비용은 막대하다 (예: 2009년 기준 100,000 호스트 데이터 센터의 월 비용 1,200만 달러 이상).

| 비용 항목 | 비율 | 세부 내용 |
|----------|------|----------|
| **호스트** | 45% | 3-4년마다 교체 필요 |
| **인프라** | 25% | 변압기, UPS, 발전기, 냉각 시스템 |
| **전기 요금** | 15% | 전력 소비 비용 |
| **네트워킹** | 15% | 스위치, 라우터, 로드 밸런서, 외부 링크, 트래픽 비용 |

> 네트워킹이 가장 큰 비용은 아니지만, 네트워킹 혁신이 전체 비용 절감과 성능 극대화의 핵심이다.

### 호스트 구성

- **블레이드(Blade)**: 피자 상자 모양의 범용 호스트 (CPU, 메모리, 디스크 스토리지 포함)
- **랙(Rack)**: 블레이드를 쌓아 놓은 구조, 일반적으로 20~40개의 블레이드 포함
- **TOR 스위치 (Top of Rack Switch)**: 각 랙 상단에 위치하여 랙 내 호스트와 다른 스위치를 상호연결
  - 각 호스트는 TOR 스위치에 연결되는 네트워크 인터페이스 보유
  - 호스트는 일반적으로 40 Gbps 또는 100 Gbps 이더넷으로 TOR 스위치에 연결
  - 각 호스트에는 데이터 센터 내부 IP 주소가 할당됨

### 계층적 토폴로지

<img width="627" height="439" alt="Image" src="https://github.com/user-attachments/assets/bdf7a120-93a1-4828-804a-9b63fbba706a" />

### 트래픽 유형

| 트래픽 유형 | 설명 |
|------------|------|
| **외부-내부** | 외부 클라이언트와 내부 호스트 간의 트래픽 |
| **내부-내부** | 내부 호스트 간의 트래픽 |

### 로드 밸런싱

- **기능**: 외부 요청을 호스트들에게 분배하여 현재 부하에 따라 균형 조정
- **레이어-4 스위치**: 목적지 포트 번호와 IP 주소를 기반으로 결정
- **NAT 유사 기능**: 공개 외부 IP를 적절한 호스트의 내부 IP로 변환 (양방향)
- **보안 이점**: 내부 네트워크 구조를 숨기고 클라이언트가 호스트와 직접 상호작용하는 것을 방지

### 계층적 아키텍처

- **소규모 데이터 센터**: 경계 라우터, 로드 밸런서, 단일 이더넷 스위치로 충분
- **대규모 확장**: 수십만 호스트를 지원하기 위해 라우터와 스위치의 계층 구조 사용

**계층 구조**:
1. 경계 라우터 → 접속 라우터
2. 접속 라우터 → 1계층 스위치 + 로드 밸런서
3. 1계층 스위치 → 다중 2계층 스위치
4. 2계층 스위치 → 다중 TOR 스위치 (3계층)
5. TOR 스위치 → 서버 랙

> 모든 링크는 일반적으로 이더넷을 사용하며, 구리 및 광섬유 케이블링 혼합

### 고가용성을 위한 이중화

- **중복 네트워크 장비**: 각 TOR 스위치가 두 개의 2계층 스위치에 연결
- **중복 링크**: 모든 접속 라우터, 1계층, 2계층 스위치가 이중화
- **단일 서브넷**: 각 접속 라우터 아래의 호스트가 단일 서브넷 형성
- **VLAN 분할**: ARP 브로드캐스트 트래픽 지역화를 위해 더 작은 VLAN 서브넷으로 분할

### 호스트 간 용량 제한 문제

**문제점**:
- 같은 랙 내 두 호스트: 호스트 네트워크 인터페이스 속도(10 Gbps)로만 제한
- 다른 랙의 두 호스트: 동시 흐름이 많으면 최대 속도가 크게 감소

**예제**:
- 40개의 동시 흐름이 100 Gbps A-to-B 링크를 공유
- 각 흐름은 100 Gbps / 40 = 2.5 Gbps만 수신 (10 Gbps보다 훨씬 적음)
- 상위 계층으로 올라갈수록 문제가 더 심각해짐

### 해결책

| 해결책 | 설명 | 단점 |
|--------|------|------|
| **고속 스위치/라우터** | 더 빠른 포트 속도의 장비 배포 | 비용이 매우 비쌈 |
| **서비스 공동 배치** | 관련 서비스와 데이터를 같은 랙이나 인근 랙에 배치 | 배치 유연성 제한 |
| **계층 간 연결성 증가** | TOR-2계층, 2계층-1계층 간 연결성 향상 | 복잡성 증가 |

### 고도로 상호연결된 데이터 네트워크 토폴로지

<img width="631" height="266" alt="Image" src="https://github.com/user-attachments/assets/d4a97539-91b8-4276-9c75-04e5ea16fb92" />

**Facebook 데이터 센터 예제**:
- 각 TOR가 4개의 서로 다른 2계층 스위치에 연결
- 각 2계층 스위치가 4개의 서로 다른 1계층 스위치에 연결
- 결과: 용량 증가 + 경로 다양성으로 인한 신뢰성 향상

### 다중 경로 라우팅 (Multi-path Routing)

- **ECMP (Equal Cost Multi Path)** [RFC 2992]: 소스와 목적지 간 스위치에서 무작위 다음 홉 선택
- **세분화된 로드 밸런싱**: 흐름 수준 또는 개별 패킷 수준에서 다중 경로 라우팅

---

## 6.6.2 데이터 센터 네트워킹 동향

데이터 센터 네트워킹은 **비용 절감**, **가상화**, **물리적 제약**, **모듈화**, **맞춤화**에 의해 빠르게 발전하고 있다.

### 비용 절감

- **계층화된 네트워크**: 데이터 센터 호스트를 상호연결하는 계층적, 다단계 상호연결 네트워크
- **클로스 네트워크 (Clos Networks)**: Charles Clos가 연구한 다중 스위치 계층 상호연결 네트워크
  - 전화 교환 맥락에서 개념적으로 단일 대형 크로스바 스위치와 같은 역할
  - 데이터 센터 네트워킹과 멀티프로세서 상호연결에서 추가적인 활용

**Google Jupiter 데이터센터 패브릭 예제**:
- TOR 스위치와 서버 간 48개 링크
- 최대 8개의 2계층 스위치 연결
- 2계층 스위치는 256개의 TOR 스위치와 최대 16개의 1계층 스위치에 연결

**스위치 구축 방식**:
- 대형 데이터 센터 운영자들은 범용 상용 실리콘으로 자체 스위치 구축
- 스위치 벤더에서 구매하지 않고 직접 제작

### 중앙 집중식 SDN 제어 및 관리

- **단일 조직 관리**: 데이터 센터는 단일 조직에서 관리하므로 논리적 중앙 집중식 제어 적합
- **주요 기업 채택**: Google, Microsoft, Facebook
- **아키텍처**: 상대적으로 단순한 범용 스위치로 구성된 데이터 평면 + 소프트웨어 기반 제어 평면
- **필수 기능**: 대규모 데이터 센터에서 자동화된 구성 및 운영 상태 관리

### 가상화 (Virtualization)

- **가상 머신 (VM)**: 소프트웨어 실행 애플리케이션을 물리적 하드웨어에서 분리
- **원활한 VM 마이그레이션**: 다른 랙에 위치한 물리적 서버 간 VM 이동 가능
- **표준 이더넷/IP의 한계**: 활성 네트워크 연결을 유지하면서 VM 이동에 제한

**해결책**:
- 데이터 센터 네트워크를 **단일, 평면, 레이어-2 네트워크**로 취급
- **ARP 메커니즘 수정**: 브로드캐스트 대신 DNS 스타일 쿼리 시스템 사용
- 디렉토리가 VM에 할당된 IP 주소와 MAC 주소, 현재 연결된 물리적 스위치 매핑 유지

### 물리적 제약 (Physical Constraints)

| 특성 | 설명 |
|------|------|
| **높은 용량** | 40 Gbps, 100 Gbps 링크가 일반적 |
| **극히 낮은 지연** | 마이크로초 단위 |
| **TCP 스케일링 문제** | 버퍼 크기가 작고 혼잡 제어가 빠르게 반응해야 함 |

**해결 방안**:
- **데이터 센터 전용 TCP 변형**: 빠른 반응과 낮은 손실 환경에 최적화
- **RDMA (Remote Direct Memory Access)**: 표준 이더넷에서 RDMA 기술 구현
- **스케줄링 이론**: 흐름 스케줄링과 속도 제어를 분리하여 간단한 혼잡 제어로 높은 링크 활용률 달성

### 하드웨어 모듈화 및 맞춤화

**모듈형 데이터 센터 (MDC)**:
- 표준 12미터 컨테이너 내에 "미니 데이터 센터" 구축
- 컨테이너당 수천 대의 호스트 (수십 개의 랙에 빽빽이 배치)
- 공장에서 제작 후 데이터 센터 위치로 배송

**MDC 특징**:
- **점진적 성능 저하**: 구성 요소(서버, 스위치) 장애 시에도 저하된 성능으로 계속 운영
- **교체 전략**: 많은 구성 요소 장애로 성능이 임계값 이하로 떨어지면 전체 컨테이너 교체

**MDC 네트워킹 과제**:
- 컨테이너 내부 네트워크: 저렴한 기가비트 이더넷 스위치로 구축 가능
- 코어 네트워크: 수백~수천 개의 컨테이너를 상호연결하며 높은 호스트 간 대역폭 제공 (도전적 문제)
- **전기/광학 스위치 하이브리드 아키텍처**: 컨테이너 상호연결을 위한 솔루션

### 맞춤화 및 가용성 영역

**대형 클라우드 제공자의 맞춤화**:
- 네트워크 어댑터, 스위치, 라우터, TOR, 소프트웨어, 네트워킹 프로토콜 등 모든 것을 자체 구축 또는 맞춤화

**가용성 영역 (Availability Zones)**:
- Amazon이 개척한 신뢰성 향상 방안
- 서로 다른 인근 건물에 별도의 데이터 센터를 복제
- 건물 간 거리가 수 킬로미터 이내
- **장점**: 트랜잭션 데이터를 동일 가용성 영역 내 데이터 센터 간 동기화하면서 내결함성 제공

> 데이터 센터 설계에서 더 많은 혁신이 계속될 것이다.
