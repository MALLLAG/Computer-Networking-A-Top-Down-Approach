## 6.1 링크 계층 소개

이 장에서는 중요한 용어들을 먼저 정리합니다. 링크 계층(link-layer) 프로토콜을 실행하는 모든 장치를 **노드(node)** 라고 부릅니다.
노드에는 호스트, 라우터, 스위치, 그리고 WiFi 액세스 포인트(7장에서 다룸)가 포함됩니다.

통신 경로상에서 인접한 노드들을 연결하는 통신 채널을 **링크(link)** 라고 합니다.
데이터그램이 출발지에서 목적지까지 전달되려면, 경로를 따라 각각의 개별 링크를 거쳐 이동해야 합니다.

예를 들어, 그림 6.1 하단의 네트워크에서 무선 호스트 중 하나가 서버로 데이터그램을 보내는 경우를 생각해 봅시다.
이 데이터그램은 실제로 6개의 링크를 통과합니다:
- 송신 호스트와 WiFi 액세스 포인트 사이의 WiFi 링크
- 액세스 포인트와 링크 계층 스위치 사이의 이더넷 링크
- 링크 계층 스위치와 라우터 사이의 링크
- 두 라우터 사이의 이더넷 링크
- 라우터와 링크 계층 스위치 사이의 링크
- 스위치와 서버 사이의 이더넷 링크

주어진 링크에서 전송 노드는 데이터그램을 **링크 계층 프레임(link-layer frame)** 으로 캡슐화하여 링크로 전송합니다.

<img width="566" height="600" alt="Image" src="https://github.com/user-attachments/assets/67e272b1-d4f3-47b3-8f75-b039044559d2" />

### 교통수단 비유

링크 계층과 네트워크 계층의 관계를 더 잘 이해하기 위해 교통수단 비유를 생각해 봅시다.

여행사가 뉴저지 프린스턴에서 스위스 로잔까지 여행하는 관광객의 여정을 계획한다고 가정합니다.
여행사는 관광객이 다음과 같이 이동하는 것이 가장 편리하다고 결정합니다:
1. 프린스턴에서 JFK 공항까지 리무진
2. JFK 공항에서 제네바 공항까지 비행기
3. 제네바 공항에서 로잔 기차역까지 기차

여행사가 세 가지 예약을 하면:
- 프린스턴 리무진 회사가 관광객을 JFK까지 데려다 주고
- 항공사가 관광객을 제네바까지 데려다 주고
- 스위스 철도가 관광객을 로잔까지 데려다 줍니다

세 구간 각각은 두 "인접한" 위치 사이의 "직접" 이동입니다.

이 교통수단 비유에서:
- **관광객** = 데이터그램
- **각 교통 구간** = 링크
- **교통수단(리무진, 비행기, 기차)** = 링크 계층 프로토콜
- **여행사** = 라우팅 프로토콜

---

## 6.1.1 링크 계층이 제공하는 서비스

링크 계층의 기본 서비스는 단일 통신 링크를 통해 한 노드에서 인접한 노드로 데이터그램을 이동시키는 것입니다.
하지만 제공되는 서비스의 세부 사항은 링크 계층 프로토콜마다 다를 수 있습니다.

링크 계층 프로토콜이 제공할 수 있는 서비스는 다음과 같습니다:

### 프레이밍 (Framing)

거의 모든 링크 계층 프로토콜은 링크를 통해 전송하기 전에 각 네트워크 계층 데이터그램을 링크 계층 프레임 내에 캡슐화합니다.
프레임은 네트워크 계층 데이터그램이 삽입되는 **데이터 필드**와 여러 **헤더 필드**로 구성됩니다.

프레임의 구조는 링크 계층 프로토콜에 의해 지정됩니다.
이 장의 후반부에서 특정 링크 계층 프로토콜들을 살펴볼 때 여러 다른 프레임 형식을 보게 될 것입니다.

### 링크 접근 (Link Access)

**매체 접근 제어(MAC, Medium Access Control)** 프로토콜은 프레임이 링크로 전송되는 규칙을 지정합니다.

- **점대점(point-to-point) 링크**: 링크의 한쪽 끝에 단일 송신자가 있고 다른 쪽 끝에 단일 수신자가 있는 경우, MAC 프로토콜은 단순합니다(또는 존재하지 않음). 링크가 유휴 상태일 때마다 송신자가 프레임을 보낼 수 있습니다.
- **브로드캐스트 링크**: 여러 노드가 단일 브로드캐스트 링크를 공유할 때가 더 흥미로운 경우입니다. 이를 **다중 접근 문제(multiple access problem)** 라고 합니다. 여기서 MAC 프로토콜은 여러 노드의 프레임 전송을 조정하는 역할을 합니다.

### 신뢰성 있는 전달 (Reliable Delivery)

링크 계층 프로토콜이 신뢰성 있는 전달 서비스를 제공하면, 각 네트워크 계층 데이터그램을 오류 없이 링크를 통해 이동시키는 것을 보장합니다.

TCP와 같은 특정 전송 계층 프로토콜도 신뢰성 있는 전달 서비스를 제공한다는 점을 기억하세요.
전송 계층의 신뢰성 있는 전달 서비스와 유사하게, 링크 계층의 신뢰성 있는 전달 서비스는 **확인응답(acknowledgment)** 과 **재전송(retransmission)** 을 통해 달성할 수 있습니다(섹션 3.4 참조).

링크 계층의 신뢰성 있는 전달 서비스는 주로 **무선 링크와 같이 오류율이 높은 링크**에서 사용됩니다.
목표는 오류가 발생한 링크에서 **로컬하게** 오류를 수정하는 것입니다. 전송 계층이나 애플리케이션 계층의 데이터 재전송을 기다리는 것보다 효율적입니다.

그러나 **광섬유, 동축 케이블, 많은 연선(twisted-pair) 구리선**과 같이 비트 오류율이 낮은 링크에서는 링크 계층의 신뢰성 있는 전달이 불필요한 오버헤드로 간주될 수 있습니다.
이러한 이유로, 많은 유선 링크 계층 프로토콜은 신뢰성 있는 전달 서비스를 제공하지 않습니다.

### 오류 검출 및 정정 (Error Detection and Correction)

수신 노드의 링크 계층 하드웨어는 프레임의 비트가 1로 전송되었는데 0으로 잘못 판단할 수 있습니다(그 반대도 마찬가지).
이러한 비트 오류는 **신호 감쇠(signal attenuation)** 와 **전자기 잡음(electromagnetic noise)** 에 의해 발생합니다.

오류가 있는 데이터그램을 전달할 필요가 없으므로, 많은 링크 계층 프로토콜은 이러한 비트 오류를 검출하는 메커니즘을 제공합니다:
- 전송 노드가 프레임에 **오류 검출 비트**를 포함
- 수신 노드가 **오류 검사**를 수행

3장과 4장에서 인터넷의 전송 계층과 네트워크 계층도 제한된 형태의 오류 검출(인터넷 체크섬)을 제공한다는 것을 기억하세요.

링크 계층의 오류 검출은 일반적으로 더 정교하며 **하드웨어로 구현**됩니다.

**오류 정정(error correction)** 은 오류 검출과 유사하지만, 수신자가 프레임에서 비트 오류가 발생했는지 검출할 뿐만 아니라 프레임에서 **오류가 발생한 정확한 위치를 결정**하고 이러한 오류를 정정합니다.

---

## 6.1.2 링크 계층의 구현 위치

링크 계층에 대한 상세한 학습에 들어가기 전에, 호스트의 링크 계층이 어디에 구현되어 있는지 살펴봅시다.
호스트의 링크 계층은 하드웨어로 구현되어 있을까요, 소프트웨어로 구현되어 있을까요?
별도의 카드나 칩에 구현되어 있을까요? 호스트의 하드웨어 및 운영체제 구성요소와 어떻게 인터페이스할까요?

그림 6.2는 일반적인 호스트 아키텍처를 보여줍니다.

<img width="516" height="398" alt="Image" src="https://github.com/user-attachments/assets/670a0cf1-b74a-4ddd-82cd-001908a884bc" />

### 네트워크 어댑터 (Network Adapter)

이더넷 기능은 마더보드 칩셋에 통합되거나 저렴한 전용 이더넷 칩을 통해 구현됩니다.

대부분의 경우, 링크 계층은 **네트워크 어댑터(network adapter)** 라고 불리는 칩에 구현됩니다.
이는 **네트워크 인터페이스 컨트롤러(NIC, Network Interface Controller)** 라고도 불립니다.

네트워크 어댑터는 다음과 같은 많은 링크 계층 서비스를 구현합니다:
- 프레이밍
- 링크 접근
- 오류 검출 등

따라서 링크 계층 컨트롤러의 기능 대부분은 **하드웨어로 구현**됩니다.

예시:
- Intel의 700 시리즈 어댑터: 섹션 6.5에서 다룰 이더넷 프로토콜을 구현
- Atheros AR5006: 7장에서 다룰 802.11 WiFi 프로토콜을 구현

### 송신 측 동작

1. 컨트롤러가 프로토콜 스택의 상위 계층에서 생성되어 호스트 메모리에 저장된 데이터그램을 가져옴
2. 데이터그램을 링크 계층 프레임으로 캡슐화 (프레임의 다양한 필드 채우기)
3. 링크 접근 프로토콜을 따라 프레임을 통신 링크로 전송

### 수신 측 동작

1. 컨트롤러가 전체 프레임을 수신
2. 네트워크 계층 데이터그램을 추출

링크 계층이 오류 검출을 수행하는 경우:
- **송신 컨트롤러**: 프레임 헤더에 오류 검출 비트를 설정
- **수신 컨트롤러**: 오류 검출을 수행

### 하드웨어와 소프트웨어의 결합

그림 6.2에서 보듯이 링크 계층의 대부분은 하드웨어로 구현되지만, 링크 계층의 일부는 호스트의 CPU에서 실행되는 **소프트웨어로 구현**됩니다.

링크 계층의 소프트웨어 구성요소는 다음과 같은 상위 수준의 링크 계층 기능을 구현합니다:
- 링크 계층 주소 정보 조합
- 컨트롤러 하드웨어 활성화

수신 측에서 링크 계층 소프트웨어는 컨트롤러 인터럽트에 응답합니다(예: 하나 이상의 프레임 수신으로 인해).
오류 조건을 처리하고 데이터그램을 네트워크 계층으로 전달합니다.

따라서 **링크 계층은 하드웨어와 소프트웨어의 결합**입니다.
이는 프로토콜 스택에서 **소프트웨어가 하드웨어를 만나는 지점**입니다.
