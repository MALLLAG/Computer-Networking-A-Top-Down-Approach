# 4.1 네트워크 계층 개요 (Overview of Network Layer)

<img width="666" height="713" alt="Image" src="https://github.com/user-attachments/assets/c63501b7-0f14-41e4-be06-88939dd7a027" />

그림은 두 호스트(H1, H2)와 이들 사이에 존재하는 여러 라우터로 구성된 간단한 네트워크를 보여줍니다.  
H1이 H2로 정보를 전송한다고 가정해 봅시다. 이때 네트워크 계층이 수행하는 역할을 살펴보겠습니다.

H1의 네트워크 계층은 전송 계층으로부터 세그먼트를 받아 각각을 데이터그램(datagram)으로 캡슐화하고,  
이를 인접 라우터 R1으로 전송합니다.  
수신 측 H2에서는 인접 라우터 R2로부터 데이터그램을 받고,  
이를 전송 계층 세그먼트로 추출한 뒤, H2의 전송 계층에 전달합니다.

라우터의 주요 역할은 데이터 평면(data plane)과 제어 평면(control plane)으로 나뉩니다.
- **데이터 평면의 주요 역할**은 입력 링크로 들어온 데이터그램을 출력 링크로 전달하는 것입니다.
- **제어 평면의 주요 역할**은 이러한 라우터 단위의 전달 동작을 조정하여,  
  데이터그램이 송신 호스트에서 수신 호스트까지 올바르게 전달되도록 하는 것입니다.

그림의 라우터들은 네트워크 계층까지만 표시되어 있습니다.  
이는 라우터가 애플리케이션 계층이나 전송 계층 프로토콜(TCP, UDP 등)을 실행하지 않기 때문입니다.

## 4.1.1 전달(Forwarding)과 라우팅(Routing): 데이터 평면과 제어 평면

네트워크 계층의 주된 역할은 단순합니다 — 송신 호스트에서 수신 호스트로 패킷을 전달하는 것입니다.  
이를 수행하기 위해 네트워크 계층에는 두 가지 중요한 기능이 있습니다.

### Forwarding (전달)

패킷이 라우터의 입력 링크에 도착하면, 라우터는 해당 패킷을 적절한 출력 링크로 이동시켜야 합니다.  
예를 들어, H1에서 온 패킷이 R1에 도착했다면,  
R1은 이 패킷을 다음 라우터로 전달해야 합니다.  
이 작업이 바로 **forwarding**이며, 주로 데이터 평면에서 수행됩니다.

Forwarding은 하드웨어 수준에서 매우 빠르게 처리되며 (수 나노초 단위),  
패킷을 한 인터페이스에서 다른 인터페이스로 직접 옮기는 동작입니다.

### Routing (라우팅)

라우팅은 패킷이 송신지에서 수신지로 이동하는 **경로(route)** 를 결정하는 과정입니다.  
이 경로를 계산하는 알고리즘을 **라우팅 알고리즘(routing algorithms)** 이라고 합니다.  
예를 들어, H1에서 H2로 데이터그램이 어떤 경로를 통해 이동할지를 결정하는 것입니다.  
라우팅은 네트워크 계층의 **제어 평면(control plane)** 에서 수행됩니다.

### Forwarding vs Routing

두 용어는 자주 혼용되지만, 의미는 다릅니다.
- **Forwarding**은 라우터 내부의 동작으로, 입력 인터페이스로 들어온 패킷을  
  어떤 출력 인터페이스로 보낼지를 결정하는 과정입니다.
- **Routing**은 네트워크 전체 수준의 과정으로, 패킷이 송신지에서 수신지로 가는  
  전체 경로를 결정하는 것입니다.

Forwarding은 나노초 단위로 빠르게 작동하며 주로 하드웨어에서 실행됩니다.  
Routing은 초 단위 이상의 시간이 걸리고, 주로 소프트웨어로 구현됩니다.

### 운전의 비유로 이해하기

Forwarding과 Routing을 자동차 여행에 비유할 수 있습니다.  
예를 들어, 펜실베이니아에서 플로리다까지 여행한다고 합시다.

- **Forwarding**은 고속도로 분기점(인터체인지)을 통과할 때,  
  어떤 출구로 나가야 하는지를 결정하는 과정입니다.
- **Routing**은 여행을 시작하기 전에 지도를 보고  
  전체 경로를 계획하는 과정입니다.

즉, Forwarding은 “지금 어느 길로 나가야 하는가”이고,  
Routing은 “전체적으로 어떤 길을 선택해야 하는가”입니다.

### Forwarding Table (전달 테이블)

모든 라우터는 **Forwarding Table**을 가지고 있습니다.  
라우터는 도착한 패킷의 헤더 정보를 참고해 테이블을 조회하고,  
그에 따라 패킷을 어떤 인터페이스로 내보낼지를 결정합니다.

예를 들어, 패킷의 헤더 필드 값이 `0110`이라면,  
라우터는 전달 테이블을 조회해 “출력 인터페이스 2번”으로 지정된 경로를 찾고,  
해당 인터페이스를 통해 패킷을 전송합니다.

이처럼 Forwarding은 **데이터 평면의 핵심 기능**입니다.

## Control Plane: 전통적 접근 방식 (Traditional Approach)

이제 Forwarding 테이블이 어떻게 구성되는지가 궁금하실 겁니다.  
이는 매우 중요한 문제이며, Forwarding(데이터 평면)과 Routing(제어 평면)의  
상호작용을 이해하는 데 핵심적인 부분입니다.

전통적인 방식에서는, 각 라우터가 자체적으로 **라우팅 알고리즘(routing algorithm)** 을 실행합니다.  
이 라우팅 알고리즘은 다른 라우터들과 **라우팅 메시지(routing messages)** 를 교환하며,  
이를 통해 Forwarding 테이블의 내용을 계산하고 구성합니다.

예를 들어, R1과 R2가 서로 라우팅 정보를 교환하여  
각자의 Forwarding 테이블을 업데이트하는 것입니다.  
이와 같은 프로세스를 **라우팅 프로토콜(routing protocol)** 이라고 부릅니다.  

### Forwarding과 Routing의 역할 차이

Forwarding과 Routing의 역할 차이는  
모든 라우터의 Forwarding 테이블을 수동으로 구성하는 가상의 시나리오로 더 명확히 이해할 수 있습니다.

만약 네트워크 운영자가 모든 라우터에 직접 가서 Forwarding 테이블을 입력해야 한다면,  
라우팅 프로토콜은 필요 없을 것입니다.  
하지만 이런 방식은 사람이 직접 설정하므로 오류가 많고,  
네트워크 변화에 즉각 대응하기 어렵습니다.

따라서 자동화된 **라우팅 프로토콜**은 네트워크의 유연성과 안정성을 유지하는 데 필수적입니다.  
즉, 모든 네트워크는 **Forwarding 기능과 Routing 기능**을 함께 가져야 합니다.

## Control Plane: SDN 접근 방식 (The SDN Approach)

<img width="626" height="380" alt="Image" src="https://github.com/user-attachments/assets/0e4117bf-a60a-462c-9048-c15fda4c8f2b" />

그림에서 설명한 전통적인 접근 방식에서는  
각 라우터가 자체적으로 라우팅 기능을 수행하며,  
서로 라우팅 정보를 교환합니다.

하지만 최근에는 **SDN(Software-Defined Networking, 소프트웨어 정의 네트워킹)** 이라는  
새로운 접근 방식이 등장했습니다.

SDN 방식에서는 **제어 평면(control plane)** 과 **데이터 평면(data plane)** 을 분리합니다.  
각 라우터는 단순히 Forwarding만 수행하고,  
라우팅 알고리즘과 Forwarding 테이블 계산은  
**중앙의 원격 컨트롤러(remote controller)** 가 담당합니다.

### SDN의 동작 방식

중앙 컨트롤러는 데이터센터나 ISP(인터넷 서비스 제공자)에 위치하며,  
모든 라우터의 Forwarding 테이블을 계산해 배포합니다.  
라우터와 컨트롤러는 **라우팅 정보 메시지**를 교환하면서 통신합니다.

이 접근 방식의 핵심은 네트워크가 “소프트웨어로 정의된다”는 점입니다.  
즉, 라우터의 동작(Forwarding 규칙)을 제어하는 소프트웨어가 존재하고,  
그 코드를 수정하거나 확장함으로써 네트워크의 동작을 유연하게 변경할 수 있습니다.

이러한 개념을 **소프트웨어 정의 네트워킹(SDN)** 이라고 하며, 5.5절에서 자세히 다룹니다.

요약하자면,
- 전통적 방식에서는 **각 라우터가 자체적으로 라우팅과 전달 기능을 수행**합니다.
- SDN 방식에서는 **중앙 컨트롤러가 라우팅을 담당하고, 라우터는 전달만 수행**합니다.  
  이로써 네트워크를 더 유연하고 중앙집중적으로 관리할 수 있게 됩니다.

## 4.1.2 네트워크 서비스 모델 (Network Service Model)

이제 네트워크 계층의 데이터 평면에 대한 소개를 마무리하면서,  
네트워크 계층이 제공할 수 있는 **서비스의 종류**에 대해 좀 더 넓은 관점에서 살펴보겠습니다.

송신 호스트의 전송 계층이 네트워크 계층으로 패킷을 전달할 때,  
네트워크 계층이 이 패킷을 목적지 호스트로 신뢰성 있게 전달해줄 수 있을까요?  
여러 개의 패킷을 전송할 때, 그것들은 전송된 순서대로 도착할까요?  
또한 두 패킷을 연속으로 전송했을 때,  
그 사이의 시간 간격이 수신 측에서도 동일하게 유지될까요?  
네트워크는 혼잡 상태에 대해 어떤 피드백을 제공할까요?

이러한 질문들의 답은 **네트워크 서비스 모델(Network Service Model)** 에 의해 결정됩니다.  
즉, 네트워크 서비스 모델은 송신 호스트와 수신 호스트 간의 **종단 간(end-to-end)** 패킷 전송 특성을 정의합니다.

### 네트워크 계층이 제공할 수 있는 서비스의 예

네트워크 계층은 다음과 같은 다양한 서비스를 제공할 수 있습니다.

- **Guaranteed delivery (보장된 전달)**  
  송신 호스트에서 전송된 패킷이 반드시 목적지 호스트에 도착함을 보장합니다.

- **Guaranteed delivery with bounded delay (지연 한도가 있는 보장된 전달)**  
  패킷의 전달이 보장될 뿐만 아니라, 지정된 시간(예: 100ms) 이내에 목적지에 도착함을 보장합니다.

- **In-order packet delivery (순서 보장 전달)**  
  패킷들이 전송된 순서대로 목적지에 도착함을 보장합니다.

- **Guaranteed minimal bandwidth (최소 대역폭 보장)**  
  특정 비트 전송률(예: 1Mbps)을 보장하는 서비스입니다.  
  송신 호스트가 지정된 비트율 이하로 데이터를 전송하면,  
  모든 패킷은 결국 목적지까지 도착하게 됩니다.

- **Security (보안)**  
  네트워크 계층이 모든 데이터그램을 암호화하여 송신하고,  
  수신 시 복호화함으로써 전송 계층 세그먼트의 기밀성을 제공합니다.

이 목록은 네트워크 계층이 제공할 수 있는 서비스 중 일부일 뿐이며,  
이외에도 다양한 변형된 형태의 서비스가 존재할 수 있습니다.

### 인터넷의 네트워크 계층 서비스 모델

인터넷의 네트워크 계층은 단 하나의 서비스 모델을 제공합니다.  
그것은 바로 **Best-Effort Service (최선형 서비스)** 입니다.

Best-Effort Service는 다음과 같은 특징을 갖습니다:
- 패킷이 보낸 순서대로 도착할 것이라는 보장이 없습니다.
- 패킷이 결국 도착할 것이라는 보장도 없습니다.
- 지연 시간이나 최소 대역폭에 대한 보장도 없습니다.

즉, 네트워크가 패킷을 전혀 전달하지 않아도,  
형식상 "최선을 다했다"는 점에서 Best-Effort라는 표현을 씁니다.

### 다른 네트워크 모델의 예

일부 네트워크 구조는 인터넷의 Best-Effort보다 더 발전된 서비스를 제공합니다.  
예를 들어:

- **ATM 네트워크(Asynchronous Transfer Mode)**
    - 순서 보장 전달
    - 지연 시간 한도
    - 최소 대역폭 보장을 모두 제공합니다.

- **Intserv (Integrated Services, RFC 1633)**
    - 종단 간 지연 시간 보장과 혼잡 없는 전송을 목표로 합니다.

### Best-Effort의 현실적 가치

이처럼 다양한 대안들이 존재하지만,  
인터넷의 기본 Best-Effort 서비스 모델은  
적절한 대역폭 조절 및 응용 계층 프로토콜(예: DASH, HTTP Adaptive Streaming)과 결합되어  
충분히 효과적인 모델로 입증되었습니다.

실제로, Best-Effort 모델은 오늘날 다음과 같은 다양한 응용을 가능하게 했습니다:
- **넷플릭스(Netflix)**, **IP 기반 실시간 화상회의(Zoom, Skype, Facetime)**
- **비디오 스트리밍(Video-over-IP)**
- **적응형 전송을 사용하는 실시간 애플리케이션**

### Forwarding과 Switching의 용어 구분

네트워크 분야에서는 **Forwarding**과 **Switching**이 종종 같은 의미로 사용됩니다.  
이 책에서도 두 용어를 혼용하지만,  
정확한 구분을 위해 다음과 같이 정의합니다.

- **Packet Switch (패킷 스위치)**  
  입력 링크 인터페이스로 들어온 패킷을  
  헤더 값에 따라 적절한 출력 인터페이스로 전달하는 일반적인 장치를 의미합니다.

패킷 스위치는 두 가지 주요 유형으로 나뉩니다.

1. **링크 계층 스위치 (Link-layer Switch, 2계층 스위치)**
    - 링크 계층 프레임의 헤더 값을 기준으로 Forwarding 결정을 내립니다.
    - 따라서 **2계층 장치(Layer 2 device)** 로 분류됩니다.

2. **라우터 (Router)**
    - 네트워크 계층 데이터그램의 헤더 값을 기반으로 Forwarding 결정을 내립니다.
    - 따라서 **3계층 장치(Layer 3 device)** 로 분류됩니다.

이 장에서는 네트워크 계층에 초점을 맞추기 때문에,  
“Packet Switch” 대신 **Router**라는 용어를 주로 사용합니다.

