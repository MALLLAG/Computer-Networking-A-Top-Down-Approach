# 4.1 네트워크 계층 개요 (Overview of Network Layer)

<img width="666" height="713" alt="Image" src="https://github.com/user-attachments/assets/c63501b7-0f14-41e4-be06-88939dd7a027" />

그림은 두 호스트(H1, H2)와 이들 사이에 존재하는 여러 라우터로 구성된 간단한 네트워크를 보여줍니다.  
H1이 H2로 정보를 전송한다고 가정해 봅시다. 이때 네트워크 계층이 수행하는 역할을 살펴보겠습니다.

H1의 네트워크 계층은 전송 계층으로부터 세그먼트를 받아 각각을 데이터그램(datagram)으로 캡슐화하고,  
이를 인접 라우터 R1으로 전송합니다.  
수신 측 H2에서는 인접 라우터 R2로부터 데이터그램을 받고,  
이를 전송 계층 세그먼트로 추출한 뒤, H2의 전송 계층에 전달합니다.

라우터의 주요 역할은 데이터 평면(data plane)과 제어 평면(control plane)으로 나뉩니다.
- **데이터 평면의 주요 역할**은 입력 링크로 들어온 데이터그램을 출력 링크로 전달하는 것입니다.
- **제어 평면의 주요 역할**은 이러한 라우터 단위의 전달 동작을 조정하여,  
  데이터그램이 송신 호스트에서 수신 호스트까지 올바르게 전달되도록 하는 것입니다.

그림의 라우터들은 네트워크 계층까지만 표시되어 있습니다.  
이는 라우터가 애플리케이션 계층이나 전송 계층 프로토콜(TCP, UDP 등)을 실행하지 않기 때문입니다.

## 4.1.1 전달(Forwarding)과 라우팅(Routing): 데이터 평면과 제어 평면

네트워크 계층의 주된 역할은 단순합니다 — 송신 호스트에서 수신 호스트로 패킷을 전달하는 것입니다.  
이를 수행하기 위해 네트워크 계층에는 두 가지 중요한 기능이 있습니다.

### Forwarding (전달)

패킷이 라우터의 입력 링크에 도착하면, 라우터는 해당 패킷을 적절한 출력 링크로 이동시켜야 합니다.  
예를 들어, H1에서 온 패킷이 R1에 도착했다면,  
R1은 이 패킷을 다음 라우터로 전달해야 합니다.  
이 작업이 바로 **forwarding**이며, 주로 데이터 평면에서 수행됩니다.

Forwarding은 하드웨어 수준에서 매우 빠르게 처리되며 (수 나노초 단위),  
패킷을 한 인터페이스에서 다른 인터페이스로 직접 옮기는 동작입니다.

### Routing (라우팅)

라우팅은 패킷이 송신지에서 수신지로 이동하는 **경로(route)** 를 결정하는 과정입니다.  
이 경로를 계산하는 알고리즘을 **라우팅 알고리즘(routing algorithms)** 이라고 합니다.  
예를 들어, H1에서 H2로 데이터그램이 어떤 경로를 통해 이동할지를 결정하는 것입니다.  
라우팅은 네트워크 계층의 **제어 평면(control plane)** 에서 수행됩니다.

### Forwarding vs Routing

두 용어는 자주 혼용되지만, 의미는 다릅니다.
- **Forwarding**은 라우터 내부의 동작으로, 입력 인터페이스로 들어온 패킷을  
  어떤 출력 인터페이스로 보낼지를 결정하는 과정입니다.
- **Routing**은 네트워크 전체 수준의 과정으로, 패킷이 송신지에서 수신지로 가는  
  전체 경로를 결정하는 것입니다.

Forwarding은 나노초 단위로 빠르게 작동하며 주로 하드웨어에서 실행됩니다.  
Routing은 초 단위 이상의 시간이 걸리고, 주로 소프트웨어로 구현됩니다.

### 운전의 비유로 이해하기

Forwarding과 Routing을 자동차 여행에 비유할 수 있습니다.  
예를 들어, 펜실베이니아에서 플로리다까지 여행한다고 합시다.

- **Forwarding**은 고속도로 분기점(인터체인지)을 통과할 때,  
  어떤 출구로 나가야 하는지를 결정하는 과정입니다.
- **Routing**은 여행을 시작하기 전에 지도를 보고  
  전체 경로를 계획하는 과정입니다.

즉, Forwarding은 “지금 어느 길로 나가야 하는가”이고,  
Routing은 “전체적으로 어떤 길을 선택해야 하는가”입니다.

### Forwarding Table (전달 테이블)

모든 라우터는 **Forwarding Table**을 가지고 있습니다.  
라우터는 도착한 패킷의 헤더 정보를 참고해 테이블을 조회하고,  
그에 따라 패킷을 어떤 인터페이스로 내보낼지를 결정합니다.

예를 들어, 패킷의 헤더 필드 값이 `0110`이라면,  
라우터는 전달 테이블을 조회해 “출력 인터페이스 2번”으로 지정된 경로를 찾고,  
해당 인터페이스를 통해 패킷을 전송합니다.

이처럼 Forwarding은 **데이터 평면의 핵심 기능**입니다.

## Control Plane: 전통적 접근 방식 (Traditional Approach)

이제 Forwarding 테이블이 어떻게 구성되는지가 궁금하실 겁니다.  
이는 매우 중요한 문제이며, Forwarding(데이터 평면)과 Routing(제어 평면)의  
상호작용을 이해하는 데 핵심적인 부분입니다.

전통적인 방식에서는, 각 라우터가 자체적으로 **라우팅 알고리즘(routing algorithm)** 을 실행합니다.  
이 라우팅 알고리즘은 다른 라우터들과 **라우팅 메시지(routing messages)** 를 교환하며,  
이를 통해 Forwarding 테이블의 내용을 계산하고 구성합니다.

예를 들어, R1과 R2가 서로 라우팅 정보를 교환하여  
각자의 Forwarding 테이블을 업데이트하는 것입니다.  
이와 같은 프로세스를 **라우팅 프로토콜(routing protocol)** 이라고 부릅니다.  

### Forwarding과 Routing의 역할 차이

Forwarding과 Routing의 역할 차이는  
모든 라우터의 Forwarding 테이블을 수동으로 구성하는 가상의 시나리오로 더 명확히 이해할 수 있습니다.

만약 네트워크 운영자가 모든 라우터에 직접 가서 Forwarding 테이블을 입력해야 한다면,  
라우팅 프로토콜은 필요 없을 것입니다.  
하지만 이런 방식은 사람이 직접 설정하므로 오류가 많고,  
네트워크 변화에 즉각 대응하기 어렵습니다.

따라서 자동화된 **라우팅 프로토콜**은 네트워크의 유연성과 안정성을 유지하는 데 필수적입니다.  
즉, 모든 네트워크는 **Forwarding 기능과 Routing 기능**을 함께 가져야 합니다.

## Control Plane: SDN 접근 방식 (The SDN Approach)

<img width="626" height="380" alt="Image" src="https://github.com/user-attachments/assets/0e4117bf-a60a-462c-9048-c15fda4c8f2b" />

그림에서 설명한 전통적인 접근 방식에서는  
각 라우터가 자체적으로 라우팅 기능을 수행하며,  
서로 라우팅 정보를 교환합니다.

하지만 최근에는 **SDN(Software-Defined Networking, 소프트웨어 정의 네트워킹)** 이라는  
새로운 접근 방식이 등장했습니다.

SDN 방식에서는 **제어 평면(control plane)** 과 **데이터 평면(data plane)** 을 분리합니다.  
각 라우터는 단순히 Forwarding만 수행하고,  
라우팅 알고리즘과 Forwarding 테이블 계산은  
**중앙의 원격 컨트롤러(remote controller)** 가 담당합니다.

### SDN의 동작 방식

중앙 컨트롤러는 데이터센터나 ISP(인터넷 서비스 제공자)에 위치하며,  
모든 라우터의 Forwarding 테이블을 계산해 배포합니다.  
라우터와 컨트롤러는 **라우팅 정보 메시지**를 교환하면서 통신합니다.

이 접근 방식의 핵심은 네트워크가 “소프트웨어로 정의된다”는 점입니다.  
즉, 라우터의 동작(Forwarding 규칙)을 제어하는 소프트웨어가 존재하고,  
그 코드를 수정하거나 확장함으로써 네트워크의 동작을 유연하게 변경할 수 있습니다.

이러한 개념을 **소프트웨어 정의 네트워킹(SDN)** 이라고 하며, 5.5절에서 자세히 다룹니다.

요약하자면,
- 전통적 방식에서는 **각 라우터가 자체적으로 라우팅과 전달 기능을 수행**합니다.
- SDN 방식에서는 **중앙 컨트롤러가 라우팅을 담당하고, 라우터는 전달만 수행**합니다.  
  이로써 네트워크를 더 유연하고 중앙집중적으로 관리할 수 있게 됩니다.
