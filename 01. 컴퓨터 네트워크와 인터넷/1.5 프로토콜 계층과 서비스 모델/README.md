# 컴퓨터 네트워킹 — 1.5 프로토콜 계층과 서비스 모델

지금까지 우리는 인터넷이 매우 복잡한 시스템임을 알 수 있었으며, 많은 구성 요소로 이루어져 있습니다. <br>
예를 들면, 다양한 애플리케이션과 통신 프로토콜, 여러 종류의 단말 시스템이나 패킷 교환기, 그리고 다양한 전송 매체 등이 있습니다.

## 1.5.1 계층화된 아키텍처

<img width="711" height="464" alt="Image" src="https://github.com/user-attachments/assets/d798ef07-cb43-4e57-81bc-04e45d12a203" />

인터넷 아키텍처를 조직하기 전에, 일상 생활에서 복잡한 시스템을 어떻게 다루는지 비유해보겠습니다. <br>
예를 들어, 비행기를 타는 과정을 생각해봅시다. 이 과정에는 티켓 담당자, 수하물 검사원, 탑승구 직원, 조종사, 비행기, 항공 교통 관제사, 전 세계를 잇는 항로 시스템 등 다양한 요소가 포함됩니다. <br>
이를 설명하는 한 가지 방법은 비행을 할 때 거치는 일련의 단계를 통해서입니다. 먼저 비행기 표를 사고, 수하물을 맡기고, 출국 심사를 거쳐 탑승합니다. 비행기가 출발하면 항로를 따라 목적지로 이동합니다. 도착 후에는 하차, 입국 심사, 수하물 수령을 합니다. 만약 비행이 불만족스러웠다면, 티켓 담당자에게 불평할 수도 있지만, 별다른 이득은 없습니다.

<img width="742" height="261" alt="Image" src="https://github.com/user-attachments/assets/00f3bef4-52f6-43d0-a2df-c365ae825fe9" />

이 비유에서 볼 수 있듯이, 비행기는 출발지에서 목적지로 이동하고, 인터넷의 패킷도 출발지에서 목적지로 이동합니다. <br>
하지만 우리가 원하는 비유는 구조적인 관점입니다. 위 그림에서 양쪽 끝에 티켓 기능, 수하물 기능(티켓이 있어야 사용 가능), 출입국 기능(티켓과 수하물 필요), 그리고 이륙/착륙 기능(티켓, 수하물, 출국 필요)이 있습니다. 비행 중에는 항로 계획 기능이 있습니다. 즉, 수평적으로 보면 여러 층이 쌓여 있는 구조가 보입니다. <br>
이런 계층화된 구조는 복잡한 시스템을 논의할 때 한 부분에 집중할 수 있게 해줍니다. <br>
이 방식의 장점은 시스템을 **모듈화**하여 특정 계층의 서비스 구현 방식을 변경할 때 더 쉽다는 것입니다. <br>
상위 계층에 동일한 서비스를 제공하고, 하위 계층의 동일한 서비스를 사용한다면 전체 시스템의 동작은 변하지 않습니다(구현 방식 변경과 서비스 자체 변경은 다름). <br>
예를 들어, 출입국 기능이 변경되어도(예: 키 순으로 탑승/하차) 전체 항공 시스템의 동작은 변하지 않습니다. 대규모, 복잡하고 자주 업데이트되는 시스템에서 한 구성 요소가 변경되어도 다른 요소에 영향을 주지 않는 것이 계층화의 또 다른 큰 장점입니다.

### 프로토콜 계층화

비행기 예시를 충분히 봤으니, 이제 네트워크 프로토콜로 돌아가겠습니다. <br>
네트워크 아키텍처 설계자는 다양한 프로토콜(그리고 이를 구현하는 소프트웨어/하드웨어)을 **계층화**합니다. <br>
각 프로토콜은 네트워크의 특정 계층에 속하며, 각 계층이 상위 계층에 어떤 **서비스**를 제공하는지가 중요합니다. <br>
이를 해당 계층의 **서비스 모델(service model)**이라 부릅니다. 비행기 예시와 마찬가지로, 각 계층의 서비스는 "자신의 계층에서 특정 동작을 수행"하고 "하위 계층의 기능을 사용"해서 완성됩니다. <br>
예를 들어, n계층이 "엣지 네트워크 간 신뢰성 있는 메시지 전송" 서비스를 제공한다면, 이는 n-1계층이 제공하는 "엣지 네트워크 간 비신뢰성 메시지 전송" 서비스를 이용하고, 자신의 계층에서 "패킷 손실 감지 및 재전송" 기능을 구현함으로써 이루어집니다.

프로토콜 계층은 소프트웨어, 하드웨어, 또는 둘 다로 구현될 수 있습니다.

- **응용 계층(application layer, HTTP, SMTP 등)**과 **전송 계층(transport layer)**의 프로토콜은 거의 대부분 단말 시스템에서 소프트웨어로 구현됩니다.
- **물리 계층(physical layer)**과 **데이터 링크 계층(data link layer)**은 특정 종류의 회선 간 통신을 처리하므로, 해당 회선의 네트워크 인터페이스 카드(예: 이더넷, Wi-Fi)에 구현됩니다.
- **네트워크 계층(network layer)**은 소프트웨어와 하드웨어가 결합되어 구현됩니다.

또한, 비행 시스템의 계층화된 기능이 전 세계 공항과 관제 센터에 분산되어 구현되는 것처럼, 네트워크의 계층화된 프로토콜도 전 세계의 단말 시스템, 스위치, 기타 네트워크 구성 요소에 분산되어 구현됩니다. <br>
프로토콜 계층화는 개념적으로, 구조적으로 여러 장점을 제공합니다. 계층화는 시스템 구성 요소를 구조적으로 논의할 수 있게 해주고, 모듈화는 시스템 업그레이드를 쉽게 해줍니다. <br>
하지만 일부 연구자와 네트워크 엔지니어는 계층화에 반대하기도 합니다. 그 이유 중 하나는, 일부 기능이 여러 계층에서 중복 구현될 수 있기 때문입니다. <br>
예를 들어, 많은 프로토콜 스택에서 링크 단위(per-link basis)와 종단 간(end-to-end basis) 오류 처리 및 복구 기능이 모두 제공됩니다. 또 다른 단점은, 어떤 계층의 기능이 다른 계층의 데이터(예: 타임스탬프)만 필요할 때가 있는데, 이는 계층화의 목표에 어긋납니다.

<img width="272" height="321" alt="Image" src="https://github.com/user-attachments/assets/68ff2385-0159-48ff-966f-5e465a798891" />

이렇게 여러 계층의 프로토콜을 쌓아 올린 것을 **프로토콜 스택(protocol stack)**이라 부릅니다. 인터넷의 프로토콜 스택은 총 5계층으로 구성되어 있습니다.

- 응용 계층(Application layer)
- 전송 계층(Transport layer)
- 네트워크 계층(Network layer)
- 데이터 링크 계층(Data link layer)
- 물리 계층(Physical layer)

이 책의 목차도 이 구조에 맞춰 구성되어 있으며, **상위에서 하위로(Top-Down Approach)** 인터넷 프로토콜 스택을 소개합니다.

#### 응용 계층(Application Layer)

응용 계층은 **네트워크 응용 서비스**와 **응용 계층 프로토콜**로 구성되어 있습니다. 대표적인 프로토콜로는

- HTTP(HyperText Transfer Protocol): 웹 페이지 전송
- SMTP(Simple Mail Transfer Protocol): 이메일 전송
- FTP(File Transfer Protocol): 파일 전송

또한, 사람이 읽기 쉬운 도메인을 32비트 IP 주소로 변환하는 DNS(Domain Name System) 서비스도 응용 계층 프로토콜로 구현됩니다. 2장에서 다루겠지만, 새로운 응용 계층 프로토콜을 직접 구현하고 배포하는 것은 매우 쉽습니다. <br>
응용 계층 프로토콜은 여러 단말 시스템에 분산되어 구현되며, 일반적으로 응용 프로그램과 함께 동작해 단말 시스템 간에 패킷을 교환할 수 있게 해줍니다. 이렇게 응용 계층에서 생성된 패킷을 **메시지(message)** 라고 부릅니다.

#### 전송 계층(Transport Layer)

전송 계층은 **응용 프로그램 단말(application endpoint) 간에 응용 계층 메시지를 전송**하는 역할을 합니다. 인터넷에서 가장 많이 사용되는 두 가지 전송 계층 프로토콜은 TCP와 UDP입니다.

- **TCP(Transmission Control Protocol)**: 연결 지향(connection-oriented) 서비스 제공
    - 신뢰성 있는 전송(reliable delivery): 메시지가 반드시 목적지로 전달됨을 보장
    - 흐름 제어(flow control): 송수신 양쪽의 전송 속도를 맞춤
    - 혼잡 제어(congestion-control): 메시지가 너무 길면 작은 조각으로 나누어 혼잡 시 전송 속도 자동 조절
- **UDP(User Datagram Protocol)**: 비연결 지향(non-connection-oriented) 서비스 제공
    - 필요한 기본 기능만 제공하며, 신뢰성, 흐름 제어, 혼잡 제어는 하지 않음

이 책에서는 전송 계층에서 생성된 패킷을 **세그먼트(segment)** 라고 부릅니다.

#### 네트워크 계층(Network Layer)

네트워크 계층은 서로 다른 호스트 간에 패킷을 전송하는 역할을 하며, 이 계층의 패킷을 **데이터그램(datagram)** 이라고 부릅니다. 데이터 송신 호스트는 메시지 조각과 목적지 주소를 네트워크 계층에 전달하며, 네트워크 계층은 이를 목적지 호스트의 전송 계층으로 전달합니다. <br>
네트워크 계층의 대표적인 프로토콜은 **IP(Internet Protocol)** 로, 데이터그램의 필드와 단말 시스템 및 라우터가 이를 해석하는 방법을 정의합니다. IP 프로토콜은 하나만 존재하므로, 네트워크 계층이 있는 모든 장치는 반드시 IP를 지원해야 합니다. <br>
또한, 네트워크 계층에는 여러 종류의 라우팅 프로토콜이 포함되어 있습니다. 라우팅 프로토콜은 데이터그램이 출발지에서 목적지까지 어느 경로로 갈지 결정합니다. 각 네트워크의 관리자는 사용할 라우팅 프로토콜을 자유롭게 선택할 수 있습니다. <br>
네트워크 계층은 IP와 여러 라우팅 프로토콜을 포함하지만, 흔히 "IP 계층"이라 부르기도 합니다. 이는 IP가 인터넷을 연결하는 핵심 요소임을 보여줍니다.

#### 링크 계층(Link Layer)

네트워크 계층에서 데이터그램은 출발지, 여러 라우터를 거쳐 목적지에 도달합니다. 패킷을 한 노드(호스트나 라우터)에서 다른 노드로 이동시키기 위해 네트워크 계층은 링크 계층의 서비스를 이용합니다. <br>
즉, 각 노드에서 네트워크 계층은 데이터그램을 링크 계층으로 내리고, 링크 계층은 이를 다음 노드로 전달합니다. 도착한 노드의 링크 계층은 다시 이를 네트워크 계층으로 올립니다.
링크 계층 프로토콜마다 제공하는 서비스가 다르며, 해당 경로의 회선 종류에 따라 프로토콜이 결정됩니다. 예를 들어, 일부 링크 계층 프로토콜은 인접 노드 간 신뢰성 있는 전송을 보장합니다. <br>
이 계층의 신뢰성 전송과 TCP가 제공하는 신뢰성 전송은 다릅니다. TCP는 종단 간 신뢰성 전송을 제공하지만, 링크 계층은 인접 노드 간만 보장합니다.

대표적인 링크 계층 프로토콜로는 이더넷, Wi-Fi, 케이블 인터넷의 DOCSIS 등이 있습니다. 하나의 데이터그램이 목적지까지 여러 회선을 거치기 때문에, 다양한 프로토콜을 거칠 수 있습니다. 예를 들어, 어떤 회선에서는 이더넷 프로토콜을, 다음 회선에서는 PPP 프로토콜을 사용할 수 있습니다. <br>
링크 계층에서 생성된 패킷을 **프레임(frame)** 이라 부릅니다.

#### 물리 계층(Physical Layer)

링크 계층이 인접 네트워크 노드 간에 하나의 프레임을 이동시키는 역할이라면, 물리 계층은 인접 노드 간에 프레임 내의 비트를 이동시키는 역할을 합니다. 물리 계층의 프로토콜은 회선의 물리적 구성(예: 꼬임선, 단일모드 광섬유 등)에 따라 다릅니다. 예를 들어, 이더넷 기술은 여러 종류의 물리 계층 프로토콜(꼬임선, 동축 케이블, 광섬유 등)을 구현합니다. 각 프로토콜마다 비트를 회선에 전송하는 방식이 다릅니다.

| 번호 | 이름 | 기능                                          | 동작 위치 | 프로토콜 | 패킷 명칭 |
| --- | --- |---------------------------------------------| --- | --- | --- |
| 5 | 응용 계층 | 다양한 응용 서비스 제공                               | 단말 장치 | HTTP, SMTP, TPC 등 | 메시지 (message) |
| 4 | 전송 계층 | 응용 계층 메시지를 다른 응용 프로그램으로 전달                  | 단말 장치 | TCP, UDP 등 | 세그먼트 (segment) |
| 3 | 네트워크 계층 | 전송 계층 세그먼트를                   다른 전송 계층으로 전달 | 모든 네트워크 노드 | IP, 다양한 라우팅 프로토콜             | 데이터그램 (datagram) |
| 2 | 링크 계층 | 네트워크 계층 데이터그램을                              인접 노드의 네트워크 계층으로 전달 | 라우터 | Ethernet, Wi-Fi, DOCSIS, PPP                | 프레임 (frame) |
| 1 | 물리 계층 | 링크 계층 프레임을                                  비트로 분해하여 다음 노드로 전달 | 회선 | 각 링크 계층 프로토콜의                               물리 매체별 버전 | 비트 |

### OSI 모델

지금까지 인터넷 프로토콜 스택의 세부 사항을 다뤘지만, 프로토콜 스택이 하나만 있는 것은 아닙니다. <br>
1970년대 후반, 국제표준화기구(ISO)는 컴퓨터 네트워크를 7계층 구조로 조직하여 **개방형 시스템 상호 연결 모델(Open Systems Interconnection, OSI)** 을 제안했습니다. <br>
OSI 모델이 제안될 당시, IP 프로토콜은 막 개발된 여러 프로토콜 중 하나였습니다. OSI 모델을 만든 사람들은 인터넷에 대한 개념이 없었을 수도 있습니다. <br>
그럼에도 불구하고, 1970년대 후반부터 많은 네트워크 교육 및 대학 과정에서 ISO의 위임을 받아 7계층 모델 관련 내용을 다뤘습니다. 초기 네트워크 교육에서 영향력이 컸기 때문에 OSI 7계층 모델은 여러 네트워크 교재에 지속적으로 등장하고 있습니다.

<img width="242" height="403" alt="Image" src="https://github.com/user-attachments/assets/9959d224-550b-4efc-b371-0b5d4632cc86" />

OSI 7계층 모델은 아래와 같습니다.

- 응용 계층(Application layer)
- **표현 계층(Presentation layer)**
- **세션 계층(Session layer)**
- 전송 계층(Transport layer)
- 네트워크 계층(Network layer)
- 데이터 링크 계층(Data link layer)
- 물리 계층(Physical layer)

이 중 5계층은 앞서 설명한 인터넷 프로토콜 스택과 동일하므로, 추가된 두 계층만 설명합니다.

#### 표현 계층(Presentation Layer)

표현 계층의 역할은 통신 중인 두 응용 프로그램이 받은 데이터를 해석할 수 있도록 서비스를 제공하는 것입니다. 주요 서비스는 다음과 같습니다.

- 데이터 압축
- 데이터 암호화
- 데이터 해석(응용 프로그램이 데이터 표현/저장 방식을 신경 쓰지 않아도 되도록 지원, 예: 인코딩, 바이트 순서 등)

#### 세션 계층(Session Layer)

세션 계층은 데이터 교환 동작의 경계 설정과 동기화 기능을 제공합니다. 체크포인트 설정이나 세션 복구 메커니즘 등이 포함됩니다. <br>
인터넷 프로토콜 스택에는 이 두 계층이 없는데, 이에 대해 몇 가지 흥미로운 질문이 제기됩니다: 이 두 계층의 서비스가 중요하지 않은가? 어떤 응용 프로그램이 이 서비스가 필요하다면 어떻게 해야 하는가? 인터넷 설계자들은 이 질문에 같은 답을 했습니다. <br>
이 모든 것은 **응용 프로그램 개발자가 결정**하도록 맡긴다는 것입니다. 개발자가 중요하다고 판단하면, 응용 계층에서 직접 구현할 수 있습니다.

## 1.5.2 캡슐화(Encapsulation)

아래 그림은 데이터가 물리적으로 어떤 계층을 거쳐 목적지에 도달하는지 보여줍니다. <br>
데이터는 출발지 컴퓨터의 응용 계층에서 아래로 내려가고, 링크 계층 스위치와 라우터를 거칠 때는 위로 올라갔다가 다시 내려가며, 최종적으로 목적지 컴퓨터에 도달하면 다시 응용 계층으로 올라갑니다. <br>
라우터와 링크 계층 스위치는 패킷 교환기이며, 이들의 소프트웨어/하드웨어도 인터넷 프로토콜 스택의 계층 구조로 구성됩니다. <br>
하지만 라우터와 링크 계층 스위치는 모든 계층을 구현하지 않으며, 주로 하위 몇 개 계층만 구현합니다. 예를 들어, 링크 계층 스위치는 1,2계층만 구현하고, 라우터는 1~3계층만 구현합니다. <br>
즉, 라우터는 3계층(IP 프로토콜)을 구현할 수 있지만, 링크 계층 스위치는 할 수 없습니다. 링크 계층 스위치는 IP 주소를 해석하지 못하지만, 2계층 주소(이더넷 주소 등)는 해석할 수 있습니다. <br>
단말 장치는 5계층 모두 구현하며, 이는 인터넷 아키텍처가 엣지 네트워크 부분이 가장 복잡하다는 사실과 일치합니다.

<img width="733" height="462" alt="Image" src="https://github.com/user-attachments/assets/f0ad080a-19b3-4632-be54-36fe7ed266b0" />

또한, 아래 그림은 **캡슐화(encapsulation)** 라는 중요한 개념을 보여줍니다.

- 송신 호스트에서 응용 계층의 **메시지**(M)는 전송 계층으로 전달됩니다. 가장 간단한 경우(메시지가 짧고 분할 필요 없음), 전송 계층은 메시지에 추가 정보를 붙입니다. 이를 **전송 계층 헤더(Ht)** 라고 하며, 수신 호스트의 전송 계층이 이를 참조합니다. 응용 계층 메시지와 전송 계층 헤더가 합쳐져 전송 계층의 세그먼트가 되므로, **전송 계층의 세그먼트가 응용 계층 메시지를 캡슐화**했다고 합니다.
    - 추가 정보에는 수신 호스트의 전송 계층이 메시지를 어느 응용 프로그램에 전달할지 결정하는 정보, 오류 검출 비트 등이 포함될 수 있습니다.
- 전송 계층의 세그먼트는 네트워크 계층으로 전달되어 **네트워크 계층 헤더(Hn)** 가 추가되어 **네트워크 계층 데이터그램**이 됩니다.
    - 네트워크 계층 헤더에는 송/수신 호스트 주소 등이 포함될 수 있습니다.
- 네트워크 계층 데이터그램은 링크 계층으로 전달되어 **링크 계층 헤더(Hl)** 가 추가되어 **링크 계층 프레임**이 됩니다.

각 계층의 패킷은 **헤더(header)** 와 **페이로드(payload)** 로 나눌 수 있으며, 페이로드는 일반적으로 상위 계층의 전체 패킷입니다.

이 과정을 기업의 지점 간 메모를 우편으로 보내는 상황에 비유할 수 있습니다. 예를 들어, A지점의 직원이 B지점의 직원에게 메모를 보낸다고 합시다.

- 메모는 응용 계층 메시지입니다. 직원은 메모를 회사 내부용 봉투에 넣고, 봉투에 수신자 이름과 부서를 씁니다. 이 봉투가 전송 계층의 세그먼트이며, 봉투 표면의 정보가 전송 계층 헤더입니다. 이렇게 봉투가 응용 계층 메시지를 캡슐화합니다.
- 이 봉투는 A지점의 우편실로 전달되고, 우편실 직원은 이를 일반 우편용 봉투에 다시 넣고, 봉투에 B지점 주소(수신자), A지점 주소(발신자)를 씁니다. 이 봉투가 네트워크 계층 데이터그램이며, 내부 봉투를 캡슐화합니다.
- 우체국은 이 봉투를 B지점 우편실로 전달합니다. 우편실 직원은 봉투를 열고, 내부 봉투의 정보를 참조해 수신자에게 전달합니다. 마지막으로 수신자는 봉투에서 메모를 꺼냅니다.

실제로는 캡슐화 과정이 더 복잡합니다. 예를 들어, 너무 큰 메시지는 전송 계층에서 여러 세그먼트로 분할되고, 이 세그먼트는 네트워크 계층에서 다시 여러 데이터그램으로 분할될 수 있습니다. 수신 측에서는 분할된 데이터그램을 모아 원래의 세그먼트로 복구해야 합니다.