# 2.6 비디오 스트리밍과 콘텐츠 전송 네트워크

사전 녹화된 비디오 스트리밍 트래픽은 이제 북미 가정용 ISP의 대다수 대역폭을 차지하고 있습니다. <br>
특히 넷플릭스와 유튜브는 2015년에 각각 37%, 16%의 가정용 네트워크 ISP 트래픽을 소비했습니다. <br>
이 절에서는 오늘날 인터넷에서 가장 인기 있는 영상 스트리밍 서비스가 어떻게 구현되는지 소개합니다. <br>
이러한 서비스는 응용 계층 프로토콜로 구현되며, 서버는 일종의 캐시 메커니즘을 통해 동작합니다.

## 2.6.1 인터넷 비디오

사전 녹화된 영상 스트리밍 애플리케이션에서는 영화, TV 프로그램, 녹화된 스포츠 경기, 또는 사용자 생성 영상(user-generated video) 등 미리 녹화된 미디어가 전송됩니다(이러한 영상은 주로 유튜브에서 볼 수 있습니다). <br>
이 영상들은 서버에 저장되어 있으며, 사용자가 보고 싶을 때 서버에 요청하여 영상을 받을 수 있습니다. 현재 넷플릭스, 유튜브(Google), 아마존, 그리고 유쿠(Youku) 등 많은 인터넷 기업들이 영상 스트리밍 서비스를 제공합니다.

본격적으로 영상 스트리밍을 논의하기 전에, 전송되는 미디어 자체가 무엇인지 알아야 합니다. <br>
영상은 일련의 사진으로 구성되어 있으며, 일반적으로 고정된 프레임률(예: 초당 24 또는 30장)로 재생됩니다. <br>
무압축 디지털 이미지 한 장은 픽셀 배열로 이루어져 있고, 각 픽셀은 밝기와 색상을 표현하기 위해 여러 비트로 인코딩됩니다. <br>
영상의 중요한 특징은 압축이 가능하다는 점으로, 화질과 비트레이트(여기서 비트레이트가 전송 비트레이트인지, 미디어 인코딩 비트레이트인지 구분이 어렵습니다) 사이에서 절충이 가능합니다. <br>
다양한 압축 알고리즘 덕분에 영상을 거의 원하는 비트레이트로 압축할 수 있습니다. 물론 비트레이트가 높을수록 화질이 좋아지고, 전반적인 시청 경험도 향상됩니다.

네트워크 전송 관점에서 영상의 가장 큰 특징은 높은 비트레이트입니다. <br>
압축된 인터넷 영상은 저화질(100kbps)부터 고화질(3Mbps)까지 다양하며, 4K 스트리밍은 10Mbps를 초과하는 비트레이트가 필요합니다. <br>
이러한 높은 비트레이트는 막대한 네트워크 트래픽과 저장 공간을 필요로 하며, 특히 고화질 영상에서 더 두드러집니다. <br>
예를 들어, 2Mbps 비트레이트의 67분짜리 영상 하나는 1GB의 저장 공간과 전송 대역폭을 소모합니다. 현재까지 영상 스트리밍 서비스의 중요한 성능 지표는 종단 간 처리량입니다. <br>
영상이 끊김 없이 재생되려면 네트워크는 최소한 영상의 비트레이트만큼의 평균 처리량을 제공해야 합니다.

영상 압축 기술을 이용해 동일한 영상의 여러 압축 버전을 만들 수 있습니다. <br>
예를 들어, 300kbps, 1Mbps, 3Mbps의 세 가지 버전을 만들어 사용자가 자신의 네트워크 대역폭에 맞게 선택할 수 있습니다. <br>
고속 네트워크 사용자라면 3Mbps 버전을, 3G 네트워크로 모바일에서 시청하는 사용자는 300kbps 버전을 선택할 수 있습니다.

## 2.6.2 HTTP 스트리밍과 DASH

HTTP 기반 스트리밍 서비스에서는 영상이 특정 URL을 가진, HTTP 서버에 저장된 파일일 뿐입니다. <br>
사용자가 영상을 시청하려고 하면, 클라이언트는 서버와 TCP 연결을 맺고 HTTP GET 요청을 통해 해당 URL의 파일을 요청합니다. <br>
이후 서버는 HTTP 응답 메시지로, 가능한 최고 속도로 영상을 클라이언트에 전송합니다. 클라이언트에서는 영상의 각 바이트가 애플리케이션 버퍼에 저장됩니다. <br>
버퍼 내 바이트 수가 미리 정해진 임계값을 넘으면 애플리케이션이 영상을 재생하기 시작합니다. 정확히 말하면, 스트리밍 애플리케이션은 주기적으로 버퍼에서 프레임을 가져와 압축을 해제한 뒤, 화면에 표시합니다. <br>
즉, 스트리밍 애플리케이션은 영상을 재생하면서 동시에 다음 부분의 프레임을 수신 및 버퍼링합니다.

이러한 HTTP 스트리밍 시스템은 널리 구현 및 배포되었지만(예: 유튜브의 초기 모델), 큰 단점이 있습니다. <br>
클라이언트의 가용 대역폭은 매우 다양하지만, 모든 클라이언트가 동일하게 인코딩된 영상을 받게 됩니다(사용자별, 시간별로 모두 동일). <br>
이 문제로 인해 HTTP 기반의 새로운 스트리밍 방식이 등장했으며, 이를 HTTP 기반 동적 적응 스트리밍(Dynamic Adaptive Streaming over HTTP, DASH)이라고 합니다. <br>
DASH에서는 하나의 영상을 여러 버전으로 인코딩하고, 각 버전은 다른 비트레이트와 화질을 가집니다. 클라이언트는 몇 초 길이의 영상 조각(데이터 블록)을 동적으로 요청합니다. <br>
가용 대역폭이 높으면 고화질 버전을, 낮으면 저화질 버전을 선택합니다. 클라이언트는 HTTP GET 요청으로 한 번에 하나의 영상 조각을 요청합니다.

DASH는 다양한 인터넷 접속 속도를 가진 클라이언트가 각기 다른 인코딩 속도로 영상을 시청할 수 있게 해줍니다. <br>
저속 3G 연결 사용자는 저비트레이트(저화질) 버전을, 광섬유 인터넷 사용자는 고화질 버전을 받을 수 있습니다. <br>
DASH는 또한 클라이언트가 세션 내에서도 가용 대역폭 변화에 따라 재생 속도를 조정할 수 있게 해줍니다. 이는 모바일 사용자에게 매우 중요한데, 이들의 가용 대역폭은 이동 시 기지국에 따라 달라지기 때문입니다.

DASH 구조에서는 각 영상의 여러 버전이 HTTP 서버에 저장되고, 각 버전은 다른 URL을 가집니다. <br>
HTTP 서버에는 매니페스트(manifest) 파일이 있어, 각 버전의 URL과 비트레이트 정보를 담고 있습니다. <br>
클라이언트는 먼저 매니페스트를 요청해 각 버전 정보를 얻고, 이후 HTTP GET 요청으로 특정 URL과 바이트 범위를 지정해 영상 블록을 하나씩 다운로드합니다. <br>
다운로드 중 클라이언트는 현재 대역폭을 측정하고, 비트레이트 결정 알고리즘을 실행해 다음에 요청할 버전을 선택합니다. <br>
버퍼에 충분히 영상이 쌓이고 대역폭이 높으면 고비트레이트 버전을, 버퍼가 적고 대역폭이 낮으면 저비트레이트 버전을 선택합니다. DASH는 클라이언트가 자유롭게 화질을 선택할 수 있도록 합니다.

## 2.6.3 콘텐츠 전송 네트워크(CDN)

오늘날 많은 인터넷 영상 기업들은 매일 수백만 사용자에게 수 Mbps 스트리밍 영상을 전송해야 합니다. <br>
예를 들어 유튜브는 수억 개의 영상을 데이터베이스에 저장하고, 이를 매일 전 세계 사용자에게 스트리밍합니다. <br>
이러한 트래픽을 전 세계로 전달하면서 지속적 방송과 높은 상호작용성을 제공하는 것은 매우 도전적인 일입니다.

영상 기업이 스트리밍 서비스를 제공하는 가장 직관적인 방법은 하나의 초대형 데이터센터를 구축해 모든 영상을 저장하고, 여기서 세계 각지 사용자에게 직접 스트리밍하는 것입니다. <br>
하지만 이 방식에는 세 가지 큰 문제가 있습니다. <br>
첫째, 클라이언트가 데이터센터에서 멀리 떨어져 있으면, 패킷이 많은 전송 경로와 여러 ISP를 거쳐야 하며, 일부 ISP는 다른 대륙에 있을 수도 있습니다. 이 중 어느 한 경로라도 소비 속도보다 낮은 처리량을 제공하면, 전체 종단 간 처리량도 낮아져서 영상이 끊깁니다. 이런 문제는 경로가 많아질수록 발생 확률이 높아집니다. <br>
둘째, 인기 영상은 동일 경로에서 반복적으로 전송되어, 네트워크 대역폭이 낭비되고, 기업은 ISP에 반복 전송에 대한 요금을 많이 내야 합니다. <br>
셋째, 단일 데이터센터는 단일 장애점(single point of failure) 문제를 가집니다. 데이터센터나 주요 네트워크 연결이 고장나면 영상을 전송할 수 없습니다.

이러한 문제를 해결하기 위해, 대부분의 대형 영상 스트리밍 기업들은 콘텐츠 전송 네트워크(Content Distribution Networks, CDN)를 이용합니다. <br>
CDN에서는 서버가 지리적으로 분산되어 있고, 영상(및 문서, 이미지, 오디오 등 웹 콘텐츠)의 복사본이 각 서버에 저장됩니다. <br>
시스템은 사용자 요청을 최적의 CDN 위치로 안내합니다. CDN은 사설 CDN(예: Google의 CDN은 유튜브 영상 등 전송)일 수도, 제3자 CDN(예: Akamai, Limelight, Level-3 등)일 수도 있습니다. <br>
현대 CDN 시스템에 대한 참고 문헌은 등이 있습니다.

CDN 시스템은 서버 위치를 선정할 때 일반적으로 두 가지 원칙 중 하나를 따릅니다:

**Enter Deep**: Akamai가 처음 도입한 원칙으로, 서버 클러스터를 세계 각지의 ISP 접속망에 배치하여 ISP 내부로 깊이 진입합니다(접속망에 대해서는 1.3절 참고). Akamai는 약 1,700곳에 서버 클러스터를 배치했습니다. 이 방법의 목적은 서버를 최대한 사용자 가까이에 두어, 서버와 사용자 사이의 경로 및 라우터 수를 줄여 지연과 처리량을 개선하는 것입니다. 하지만 시스템이 매우 분산되어 관리 및 유지보수가 어렵습니다.

**Bring Home**: Limelight 등 다른 CDN 기업들이 채택한 방법으로, 소수(예: 10개)의 대형 서버 클러스터를 인터넷 교환 지점(IXP)에 배치합니다(IXP에 대해서는 1.3절 참고). 이 방법은 ISP를 집으로 불러들이는 것처럼, 서버를 ISP 내부에 두지 않고 IXP에 둡니다. 관리 비용은 낮지만, 사용자에게 더 높은 지연과 낮은 처리량을 초래할 수 있습니다.

서버 클러스터 위치를 선정한 후, CDN은 제공할 콘텐츠를 각 클러스터에 복사합니다. <br>
모든 영상을 모든 클러스터에 복사하지는 않습니다. 일부 영상은 인기가 없거나 특정 지역에서만 인기일 수 있기 때문입니다. <br>
많은 CDN은 영상을 미리 업로드하지 않고, 클러스터에 해당 영상이 없을 때 요청이 들어오면 중앙 데이터베이스나 다른 클러스터에서 영상을 가져와 클라이언트에 스트리밍하면서 복사본을 저장합니다. <br>
저장 공간이 가득 차면 덜 인기 있는 영상을 삭제하는 웹 캐싱과 유사한 방식입니다.

> ### 구글의 네트워크 인프라
> 
> 구글은 검색엔진, Gmail, 캘린더, 유튜브 영상, 지도, 공동 문서, 소셜 네트워크 등 다양한 클라우드 서비스를 제공하기 위해 광범위한 사설 네트워크와 CDN 인프라를 구축했습니다. 구글 CDN 인프라는 3단계 서버 클러스터로 나뉩니다.
> - **14개 초대형 데이터센터**: 북미 8개, 유럽 4개, 아시아 2개(각 데이터센터는 수십만 대 서버 보유). 동적 콘텐츠(검색 결과, Gmail 메시지 등)를 제공.
> - **전 세계 50여개 IXP 클러스터**: 각 클러스터는 100~500대 서버로 구성 [Adhikari 2011a]. 정적 콘텐츠(유튜브 영상 등) 제공.
> - **수백 개의 "enter-deep" 클러스터**: ISP 접속망에 위치, 한 랙에 수십 대 서버로 구성. TCP 부하 분할(TCP splitting, 3.7절 참고) 및 정적 콘텐츠 제공.
>
> 이 데이터센터와 클러스터는 구글의 사설 네트워크로 연결됩니다. <br>
> 사용자가 검색을 하면, 지역 ISP를 통해 가까운 enter-deep 캐시로 요청이 가고, 정적 웹 콘텐츠를 얻습니다. <br>
> 캐시는 정적 콘텐츠를 제공하면서, 요청을 사설 네트워크를 통해 초대형 데이터센터로 전달해 개인화 콘텐츠를 얻습니다. <br>
> 유튜브 영상은 bring-home 캐시에서, 웹 페이지 정적 콘텐츠는 enter-deep 캐시에서, 광고는 데이터센터에서 가져올 수 있습니다. <br>
> 즉, 구글의 클라우드 서비스는 공용 인터넷과 별도의 사설 네트워크 인프라로 제공됩니다.

## CDN 운영

CDN 배치 방법을 알았으니, 이제 CDN의 동작 원리를 살펴봅니다. <br>
사용자의 브라우저가 특정 URL로 영상을 요청하면, CDN은 요청을 가로채서 (1) 가장 적합한 서버 클러스터를 결정하고 (2) 해당 클러스터 내 서버로 요청을 리다이렉트합니다. CDN이 클러스터를 결정하는 방법을 간략히 설명합니다. 그 전에, 요청 가로채기 및 리다이렉트 메커니즘을 살펴봅니다.

대부분의 CDN은 DNS 시스템을 활용해 사용자 요청을 가로채고 전달합니다. <br>
예를 들어, NetCinema라는 콘텐츠 공급자가 KingCDN이라는 제3자 CDN을 이용한다고 가정합니다. <br>
NetCinema 웹사이트의 각 영상에는 "video"가 포함된 고유 URL이 지정됩니다(예: http://video.netcinema.com/6Y7B23V). 이후 아래 6단계가 진행됩니다.

<img width="694" height="478" alt="Image" src="https://github.com/user-attachments/assets/960cc582-ac9f-4dd4-8c47-12690e16c7d9" />

1. 사용자가 NetCinema 웹사이트 방문
2. 사용자가 http://video.netcinema.com/6Y7B23V 링크 클릭 시, DNS 요청으로 video.netcinema.com의 IP 주소 질의
3. 사용자의 로컬 DNS 서버(LDNS)가 NetCinema의 권한 DNS 서버에 요청을 전달. 권한 서버는 URL에 "video"가 포함된 것을 인식하고, KingCDN 도메인의 호스트명(예: a1105.kingcdn.com)을 LDNS에 반환(IP 주소가 아님)
4. 이후 DNS 요청은 KingCDN의 사설 DNS 인프라로 전달됨. LDNS가 a1105.kingcdn.com에 질의하면, KingCDN DNS가 콘텐츠 서버의 IP 주소를 반환
5. LDNS가 CDN 노드의 IP 주소를 사용자에게 전달
6. 사용자는 KingCDN 콘텐츠 서버 IP로 TCP 연결을 맺고, HTTP GET 요청으로 영상을 다운로드. DASH를 사용한다면, 서버가 여러 URL이 담긴 manifest 파일을 제공하며, 클라이언트는 적절한 버전을 선택해 데이터 블록을 다운로드

### 클러스터 선택 전략

CDN 배치의 핵심은 클러스터 선택 전략(cluster selection strategy)입니다. <br>
즉, CDN 시스템 내에서 클라이언트 요청을 동적으로 서버 클러스터/데이터센터로 안내하는 메커니즘입니다. <br>
CDN은 클라이언트의 DNS 요청에서 LDNS IP 주소를 얻고, 이를 기반으로 적절한 서버 클러스터를 선택합니다. 일반적으로 CDN의 클러스터 선택 전략은 기업별로 다릅니다.

간단한 전략은 사용자의 요청을 지리적으로 가장 가까운 클러스터로 보내는 것입니다. 상용 데이터베이스(Quova, MaxMind 등)를 이용해 LDNS IP를 실제 위치에 매핑합니다. <br>
특정 LDNS에서 DNS 요청을 받으면, 가장 가까운(직선 거리 기준) 클러스터를 선택합니다. 대부분의 클라이언트는 좋은 결과를 얻지만, 때로는 지리적으로 가까운 클러스터가 네트워크 경로상 가장 빠른 경로가 아닐 수 있습니다. <br>
또한, DNS 기반 방법은 일부 사용자가 먼 LDNS를 사용하도록 설정된 경우 문제가 있습니다. 이 경우 LDNS가 사용자의 실제 위치와 매우 멀 수 있습니다. 더 나아가, 이 전략은 경로 지연과 가용 대역폭의 시간적 변화를 무시하고, 항상 같은 클러스터를 할당합니다.

네트워크 상황에 따라 최적의 클러스터를 선택하려면, CDN 시스템이 클라이언트와 클러스터 간의 지연 및 패킷 손실률을 실시간으로 측정해야 합니다. <br>
예를 들어, 각 클러스터가 모든 LDNS에 주기적으로 ping 또는 DNS 요청 등 probe 메시지를 보냅니다. 하지만 많은 LDNS가 이런 probe 메시지에 응답하지 않도록 설정되어 있다는 단점이 있습니다.

## 2.6.4 사례 연구: 넷플릭스, 유튜브, 칸칸

마지막으로, 대규모 영상 스트리밍 서비스의 대표적 성공 사례인 넷플릭스, 유튜브, 칸칸을 살펴봅니다. 각 시스템은 구현 방식이 크게 다르지만, 이 절에서 다룬 핵심 원칙들을 모두 적용하고 있습니다.

### 넷플릭스

2015년 기준 넷플릭스는 북미 접속망 ISP 다운로드 트래픽의 약 37%를 차지하며, 미국 온라인 영화 및 TV 서비스의 선두주자입니다. 넷플릭스의 영상 전송 서비스는 Amazon 클라우드와 넷플릭스 자체 CDN 인프라로 구성됩니다. <br>
넷플릭스 웹사이트는 사용자 등록/로그인, 결제, 영상 검색/목록, 추천 시스템 등 다양한 기능을 제공합니다. 이 웹사이트와 관련 데이터베이스는 모두 Amazon 클라우드의 서버에서 동작합니다. Amazon 클라우드는 다음과 같은 핵심 기능도 제공합니다.

<img width="742" height="596" alt="Image" src="https://github.com/user-attachments/assets/6b730291-eb42-4cd1-ad06-17a33bde0021" />

- **콘텐츠 인제스트**: 넷플릭스가 영상을 사용자에게 제공하기 전에, 스튜디오에서 받은 주요 버전을 Amazon 클라우드의 서버에 업로드
- **콘텐츠 처리**: Amazon 클라우드 내 컴퓨터가 각 영상의 다양한 포맷과 비트레이트 버전을 생성하여, 데스크톱, 스마트폰, 게임 콘솔 등 다양한 클라이언트 소프트웨어에 대응(DASH를 이용해 HTTP 기반 적응형 스트리밍 구현)
- **각 버전을 CDN에 업로드**: 모든 버전 준비 후 Amazon 클라우드의 서버가 CDN에 업로드

2007년 넷플릭스가 스트리밍 서비스를 처음 시작할 때는 세 개 제3자 CDN을 이용했지만, 자체 CDN을 구축한 이후 모든 영상은 자체적으로 전송합니다(웹 콘텐츠는 여전히 Akamai를 사용). <br>
넷플릭스는 IXP와 가정용 ISP의 기계실에 서버 랙을 설치해 자체 CDN을 구축했습니다. 현재 50개 이상의 IXP에 서버 랙을 설치했고, 수백 개 ISP 기계실에도 넷플릭스 서버가 있습니다. <br>
각 서버에는 10Gbps 이더넷 포트와 100TB 이상의 저장 공간이 있습니다. 랙당 서버 수는 IXP에는 수십 대, 지역 IXP에는 한 대 등 다양하며, IXP에는 전체 넷플릭스 영상 데이터베이스(및 DASH 지원 버전)를, 지역형 IXP에는 인기 영상만 저장합니다. <br>
넷플릭스는 IXP/ISP CDN 서버에 pull-caching을 사용하지 않고, 오히려 오프피크 시간에 미리 영상을 서버에 업로드(push caching)합니다. 전체 데이터베이스를 저장할 수 없는 CDN에는 인기 영상만 업로드하며, 인기 영상은 매일 갱신됩니다.

영상 전송 과정에서, 클라이언트와 서버 간 상호작용을 살펴보면, 사용자가 영상 목록을 보는 웹페이지는 Amazon 클라우드의 서버에서 제공됩니다. <br>
사용자가 영상을 선택하면, Amazon 클라우드의 넷플릭스 소프트웨어가 해당 영상을 보유한 CDN 서버 목록을 찾고, 그 중 가장 적합한 서버를 선택합니다. <br>
사용자의 네트워크가 넷플릭스 서버 랙이 설치된 ISP이고, 해당 영상이 랙 내 서버에 있다면 그 서버가 선택됩니다. 그렇지 않으면, 인근 IXP가 선택됩니다.

넷플릭스 소프트웨어가 CDN 서버를 결정하면, 클라이언트에 해당 서버의 IP와 영상 버전별 URL 목록이 담긴 manifest 파일을 제공합니다. <br>
이후 클라이언트는 CDN 서버와 직접 상호작용하며, 전용 DASH 소프트웨어를 사용합니다. 즉, 클라이언트는 HTTP GET 요청에 byte-range 헤더를 사용해 각 버전에서 데이터 블록을 다운로드합니다. <br>
넷플릭스는 약 4초 길이의 데이터 블록을 사용합니다. 클라이언트가 블록을 다운로드할 때마다 처리량을 측정하고, 비트레이트 결정 알고리즘을 실행해 다음 블록의 화질을 선택합니다.

넷플릭스는 적응형 스트리밍과 CDN 콘텐츠 전송 등 핵심 원칙을 구현합니다. 넷플릭스는 사설 CDN을 사용하므로, CDN은 영상만 전송하고 웹페이지는 전송하지 않아 CDN 설계를 단순화할 수 있습니다. <br>
DNS 리다이렉션 대신, Amazon 클라우드의 소프트웨어가 직접 클라이언트에 CDN 서버 정보를 제공합니다. <br>
또한 넷플릭스 CDN은 push caching을 사용하며, 영상은 오프피크 시간에 미리 업로드되고, 캐시 미스 시 동적으로 가져오지 않습니다.

### 유튜브

유튜브는 매분 300시간의 영상이 업로드되고, 매일 수십억 건의 영상 조회가 이루어지는 세계 최대의 영상 공유 플랫폼입니다. <br>
2005년 4월에 시작된 유튜브는 2006년 11월 구글에 인수되었습니다. 구글/유튜브의 플랫폼 설계와 프로토콜은 전용 소프트웨어이지만, 여러 독립적인 측정 연구를 통해 유튜브의 기본 동작을 파악할 수 있습니다. <br>
넷플릭스와 마찬가지로, 유튜브도 CDN을 광범위하게 활용해 영상 콘텐츠를 전송합니다. 구글은 사설 CDN을 사용해 유튜브 영상을 전송하며, 수백 개의 IXP와 ISP에 서버 랙을 설치했습니다. <br>
구글은 여기서뿐만 아니라, 대형 데이터센터에서도 유튜브 영상을 전송합니다. 넷플릭스와 달리, 구글은 2.2.5절에서 설명한 pull caching과 2.6.3절에서 설명한 DNS 리다이렉션을 사용합니다. <br>
대부분의 경우, 클러스터 선택 전략은 사용자와의 왕복 지연(RTT)이 가장 짧은 클러스터로 안내하지만, 클러스터 간 부하 분산을 위해 때때로 더 먼 클러스터로 안내하기도 합니다.

유튜브는 HTTP 스트리밍을 사용하며, 각 영상에는 여러 비트레이트 버전이 있어 다양한 화질을 제공합니다. 유튜브는 적응형 스트리밍(DASH 등)을 구현하지 않고, 사용자가 직접 화질 버전을 선택합니다. <br>
영상 재생 중 위치 이동(진행 바 이동)이나 조기 종료 시, 불필요한 대역폭/서버 자원 낭비를 줄이기 위해 HTTP의 byte range 요청을 활용해 미리 일정량만 로드하고 데이터 전송을 제한합니다.

매일 수백만 개의 영상이 유튜브에 업로드됩니다. 유튜브는 HTTP로 영상을 클라이언트에 스트리밍할 뿐만 아니라, 업로더가 영상을 서버에 업로드할 때도 HTTP를 사용합니다. <br>
유튜브는 받은 영상을 처리해 여러 비트레이트 버전으로 변환하며, 이 과정은 모두 구글 데이터센터에서 이루어집니다.

### 칸칸(KanKan)

앞서 살펴본 예시에서는 사설 CDN의 전용 서버가 넷플릭스와 유튜브 영상을 클라이언트에 전송하는 방식을 봤습니다. <br>
넷플릭스와 유튜브는 서버 하드웨어 비용뿐 아니라, 영상 전송에 사용되는 대역폭 비용도 지불해야 합니다. 이 두 서비스 규모와 소모 대역폭을 고려하면, 이런 수준의 CDN 시스템 구축은 상당한 비용이 듭니다.

마지막으로, 앞선 두 플랫폼과 완전히 다른 전략을 사용하는 대규모 인터넷 주문형 영상 시스템 사례를 봅니다. <br>
이 전략은 서비스 제공자의 인프라 및 대역폭 비용을 크게 절감할 수 있습니다. 예상대로, 이 설계는 P2P(peer-to-peer) 구조를 사용하며, 필요에 따라 마스터-슬레이브 구조를 보조적으로 사용해 영상을 전송합니다. <br>
2011년 이후, Xunlei가 운영하는 칸칸(KanKan) P2P 영상 스트리밍 플랫폼은 매월 수천만 명의 사용자를 확보하며 큰 성공을 거두었습니다.

전체적으로 P2P 영상 스트리밍과 BitTorrent 파일 다운로드 시스템은 매우 유사합니다. <br>
어떤 피어(peer)가 영상을 시청하고 싶으면, 트래커와 통신해 시스템 내에 해당 영상을 가진 다른 피어를 찾습니다. <br>
시청을 원하는 피어는 여러 피어에 동시 요청을 보내 영상 데이터 블록을 다운로드합니다. <br>
BitTorrent와 다른 점은, 재생될 영상 조각의 데이터 블록을 우선적으로 요청해 영상이 끊김 없이 재생되도록 한다는 것입니다.

최근 칸칸은 CDN-P2P 하이브리드 스트리밍 시스템으로 전환되었습니다. 칸칸은 중국에 수백 대의 서버를 배치해 영상 콘텐츠를 업로드합니다. <br>
이 CDN 서버들은 영상 스트리밍 초기에 중요한 역할을 하며, 대부분의 경우 클라이언트는 CDN 서버에서 영상의 첫 부분을 받고, 동시에 다른 피어에게도 영상 콘텐츠를 요청합니다. <br>
P2P 트래픽만으로 영상 재생이 충분하면, 클라이언트는 CDN에서 다운로드를 중단하고, 피어로부터만 스트리밍을 받습니다. <br>
P2P 스트리밍이 부족하면, 클라이언트는 CDN 연결을 재개해 CDN-P2P 하이브리드 스트리밍 모드로 돌아갑니다. <br>
덕분에 칸칸은 초기 영상 재생 지연을 줄이면서, 인프라와 서버 대역폭 의존도를 최소화할 수 있습니다.