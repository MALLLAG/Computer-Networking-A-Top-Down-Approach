# 3.1 소개 및 전송 계층 서비스

지난 두 챕터에서 우리는 전송 계층 프로토콜과 그것이 제공하는 서비스에 대해 매우 간단하게 언급했습니다. 이제 지금까지 우리가 전송 계층 프로토콜에 대해 이해한 내용을 빠르게 복습해보겠습니다. <br>
전송 계층 프로토콜은 서로 다른 호스트에서 실행되는 두 애플리케이션에 **논리적 전송 경로**를 제공합니다. <br>
여기서 '논리적 전송 경로'란, 데이터를 보내는 애플리케이션 입장에서 상대방 호스트가 마치 자신의 호스트와 직접 네트워크 케이블로 연결된 것처럼 느끼게 하는 것입니다. <br>
실제로는 상대방 호스트가 지구 반대편에 있을 수도 있고, 수많은 라우터와 다양한 네트워크 케이블을 거쳐 연결되어 있을 수 있습니다. <br>
애플리케이션은 전송 계층 프로토콜이 제공하는 논리적 전송 경로를 통해 서로 메시지를 주고받으며, 그 메시지가 실제로 어떻게 물리적으로 전달되는지 신경쓸 필요가 없습니다.

<img width="732" height="769" alt="Image" src="https://github.com/user-attachments/assets/e9c632f9-91bb-4980-ac50-971669242105" />

전송 계층 프로토콜은 네트워크의 라우터가 아니라 종단 시스템에 구현되어 있습니다. <br>
송신 측에서 전송 계층 프로토콜은 송신 애플리케이션으로부터 받은 메시지를 전송 계층 패킷으로 변환합니다. <br>
인터넷 용어로 이 패킷을 **세그먼트(segment)** 라고 부릅니다. 전송 계층 세그먼트는 애플리케이션 메시지를 여러 작은 조각으로 나누고, 전송 계층 헤더를 추가하여 만들어집니다. <br>
이후 전송 계층 프로토콜은 이 세그먼트를 종단 시스템의 네트워크 계층으로 전달하고, 네트워크 계층은 이를 네트워크 계층 패킷(데이터그램)으로 캡슐화하여 목적지 호스트로 보냅니다. <br>
중요한 점은 네트워크 계층의 라우터는 데이터그램 내 네트워크 계층 필드만 처리하며, 데이터그램에 캡슐화된 전송 계층 세그먼트의 필드는 볼 수 없다는 것입니다. <br>
수신 측에서는 네트워크 계층 프로토콜이 데이터그램에서 전송 계층 세그먼트를 추출하여 전송 계층 프로토콜로 전달합니다. <br>
전송 계층은 받은 세그먼트를 처리하여 내부의 데이터를 추출하고, 애플리케이션이 사용할 수 있게 합니다.

하나의 네트워크 애플리케이션은 둘 이상의 전송 계층 프로토콜을 사용할 수 있습니다. <br>
예를 들어, 인터넷에는 두 가지 전송 계층 프로토콜 — TCP와 UDP — 가 있습니다. 이 두 프로토콜은 각각 호출하는 애플리케이션에 서로 다른 전송 계층 서비스를 제공합니다.

## 3.1.1 전송 계층과 네트워크 계층의 관계

네트워크 계층 구조에서 전송 계층은 네트워크 계층 바로 위에 위치합니다. <br>
전송 계층 프로토콜은 서로 다른 호스트에서 실행되는 **프로세스(process)** 간에 논리적 전송 경로를 제공하고, 네트워크 계층 프로토콜은 두 **호스트** 간에 논리적 전송 경로를 제공합니다. 이 차이는 미묘하지만 매우 중요합니다. 집을 비유로 이 차이를 쉽게 이해해봅시다.

가령, 타이베이와 가오슝에 각각 집이 하나씩 있고, 각 집에는 12명의 아이들이 살고 있다고 가정합시다. <br>
타이베이에 사는 아이들은 가오슝에 사는 아이들의 사촌입니다. 이 아이들은 서로 편지 쓰는 것을 좋아해서, 매주 각자 다른 집의 모든 아이들에게 한 명씩 편지를 씁니다. <br>
각 편지는 개별 봉투에 담겨 전통적인 우편 시스템을 통해 한 집에서 다른 집으로 한 통씩 전달됩니다. 그래서 각 집은 매주 144통의 편지를 상대 집에 보내게 됩니다(이 아이들이 이메일을 쓸 수 있다면 돈을 많이 아꼈겠죠!). <br>
각 집에는 한 명씩 — 가오슝의 샤오메이와 타이베이의 샤오밍 — 이 모든 편지를 모으고 받은 편지를 분배하는 역할을 맡습니다. <br>
샤오메이는 매주 형제자매들에게서 편지를 받아, 매일 집에 오는 우편배달부에게 전달합니다. 편지가 집에 도착하면 샤오메이는 받은 편지를 형제자매들에게 나눠줍니다. 타이베이의 샤오밍도 같은 역할을 합니다.

이 예에서 전통적인 우편 시스템은 두 집 사이에 논리적 전송 경로를 제공합니다 — 우편배달부는 편지를 한 집에서 다른 집으로 전달할 뿐, 편지를 한 사람에게서 다른 사람에게 직접 전달하지는 않습니다. <br>
반면, 샤오메이와 샤오밍은 사촌들 사이에 논리적 전송 경로를 제공합니다 — 두 사람은 형제자매의 편지를 모아 보내고, 받은 편지를 나눠줍니다. <br>
두 집의 아이들에게는 샤오밍과 샤오메이가 바로 우편 시스템처럼 느껴지지만, 실제로는 종단 시스템 내의 일부분일 뿐입니다. 이 집의 비유는 전송 계층과 네트워크 계층의 관계를 이해하는 데 매우 도움이 됩니다:

- 애플리케이션 메시지 = 봉투에 담긴 편지
- 프로세스 = 사촌들
- 호스트(종단 시스템) = 집
- 전송 계층 프로토콜 = 샤오메이와 샤오밍
- 네트워크 계층 프로토콜 = 우편 시스템(우편배달부 포함)

이 집의 비유를 계속 살펴보면, 샤오메이와 샤오밍이 하는 모든 일은 각자의 집에서만 일어납니다. <br>
이들은 우체국에서 일하지 않으며, 우체국에서 편지를 분류하거나 옮기는 일에는 관여하지 않습니다. <br>
마찬가지로, 전송 계층 프로토콜은 오직 종단 시스템에만 존재합니다. <br>
해당 종단 시스템에서 전송 계층 프로토콜은 애플리케이션에서 네트워크 계층(네트워크의 가장자리)으로 메시지를 전달하거나, 네트워크 계층에서 애플리케이션으로 메시지를 전달하는 역할만 합니다. <br>
메시지가 네트워크 코어에서 어떻게 이동하는지는 관여하지 않습니다. 실제로 Figure 3.1에서 설명한 것처럼, 네트워크의 라우터는 전송 계층이 애플리케이션 메시지에 추가한 모든 정보에 대해 아무런 동작을 하지 않으며, 이를 식별할 수도 없습니다.

집의 이야기를 더 이어가면, 샤오메이와 샤오밍이 휴가를 떠났다고 가정합시다. <br>
그러면 샤오후이와 샤오화라는 다른 아이들이 대신 집 안에서 편지를 모으고 분배하는 역할을 맡게 됩니다. <br>
하지만 샤오후이와 샤오화는 샤오메이와 샤오밍만큼 일을 잘하지 못합니다. 두 사람은 나이가 더 어려서 편지를 모으고 보내는 빈도가 낮고, 때때로 편지를 잃어버리기도 합니다(가끔 집에서 기르는 개가 편지를 먹기도 합니다). <br>
따라서 샤오후이와 샤오화는 샤오메이와 샤오밍과 같은 서비스(서비스 모델)를 제공하지 못합니다. <br>
이처럼 하나의 컴퓨터 네트워크는 여러 전송 계층 프로토콜을 사용할 수 있고, 각 프로토콜은 애플리케이션에 다른 서비스 모델을 제공할 수 있습니다.

샤오메이와 샤오밍이 어떤 서비스를 제공할 수 있는지는 우편 시스템이 제공하는 서비스에 의해 제한됩니다. <br>
예를 들어, 우편 시스템이 며칠 내에 편지를 전달한다는 보증이 없다면(예: 3일 이내), 샤오메이와 샤오밍도 사촌들이 편지를 받는 데 얼마나 걸릴지 보장할 수 없습니다. <br>
마찬가지로, 전송 계층 프로토콜이 제공할 수 있는 서비스는 아래 네트워크 계층 프로토콜의 서비스 모델에 의해 제한됩니다. <br>
네트워크 계층 프로토콜이 두 호스트 간에 전송 계층 세그먼트를 전달할 때 지연이나 대역폭을 보장하지 않으면, 전송 계층 프로토콜도 애플리케이션 메시지의 지연이나 대역폭을 보장할 수 없습니다.

그럼에도 불구하고, 네트워크 계층이 관련 서비스를 제공하지 않더라도 전송 계층 프로토콜이 제공할 수 있는 특정 서비스들이 있습니다. <br>
예를 들어, 이번 챕터에서 살펴보겠지만, 전송 계층 프로토콜은 애플리케이션에 신뢰성 있는 데이터 전송 서비스를 제공할 수 있습니다. <br>
아래 네트워크 프로토콜이 신뢰성이 없더라도(패킷 손실, 데이터 손상, 중복 전송 등) 문제가 없습니다. <br>
또 다른 예로(이 예는 8장에서 네트워크 보안에서 자세히 다룹니다), 전송 계층 프로토콜은 암호화 기술을 사용해 애플리케이션이 전송하는 메시지 내용을 해커가 읽지 못하도록 보장할 수 있습니다. <br>
네트워크 계층이 전송 계층 세그먼트의 기밀성을 보장하지 않더라도 문제가 없습니다.

## 3.1.2 인터넷에서의 전송 계층 개요

앞서 언급했듯이, 인터넷에서는 애플리케이션 계층이 사용할 수 있는 두 가지 전송 계층 프로토콜이 있습니다. <br>
하나는 **UDP**(User Datagram Protocol)로, 신뢰성이 없고 연결이 없는 데이터 전송 서비스를 제공합니다. <br>
다른 하나는 **TCP**(Transmission Control Protocol)로, 신뢰성이 있고 연결 지향적인 데이터 전송 서비스를 제공합니다. <br>
네트워크 애플리케이션을 설계할 때, 개발자는 이 두 전송 계층 프로토콜 중 하나를 선택해야 합니다. 개발자가 소켓을 생성할 때 UDP 소켓 또는 TCP 소켓을 선택해야 합니다.

용어를 단순화하기 위해, 우리는 전송 계층 패킷을 모두 **세그먼트(segment)** 라고 부르겠습니다. <br>
하지만 인터넷 관련 문서(예: RFC)에서는 TCP의 전송 계층 패킷을 세그먼트(segment)라고 하고, UDP의 전송 계층 패킷을 데이터그램(datagram)이라고 부르기도 합니다(UDP의 D가 datagram임). <br>
또한 동일한 문서에서 데이터그램이 네트워크 계층 패킷을 의미하기도 합니다! 이 교과서에서는 TCP와 UDP의 패킷을 모두 세그먼트라고 부르고, 데이터그램은 네트워크 계층 패킷을 지칭하는 용어로 남기는 것이 혼란을 줄일 수 있다고 생각합니다.

UDP와 TCP를 소개하기 전에, 인터넷의 네트워크 계층에 대한 간단한 지식이 도움이 됩니다. <br>
인터넷의 네트워크 계층 프로토콜의 이름은 **IP**(Internet Protocol)입니다. IP는 두 호스트 사이에 논리적 전송 경로를 제공합니다. <br>
IP가 제공하는 서비스 모델은 "**최선의 노력(best-effort) 전송 서비스**"입니다. <br>
즉, IP는 두 통신 호스트 사이에 세그먼트를 "최선을 다해" 전달하지만, 어떠한 보증도 하지 않습니다. <br>
구체적으로, IP는 세그먼트가 반드시 전달된다는 보증, 전송 순서 보장, 안전한 전달(변조 방지) 보증을 제공하지 않습니다. <br>
이러한 이유로 IP는 **신뢰성이 없는 전송 서비스**로 간주됩니다. 참고로, 네트워크의 모든 호스트는 네트워크 계층 주소, 즉 IP 주소를 최소 하나 이상 가지고 있어야 합니다. <br>
4장에서 IP 주소에 대해 자세히 다루겠지만, 여기서는 "모든 호스트는 IP 주소가 있다" 정도만 기억하면 됩니다.

IP의 서비스 모델을 대략적으로 이해한 후, 이제 UDP와 TCP가 제공하는 서비스 모델을 요약해보겠습니다. <br>
UDP와 TCP의 가장 근본적인 목적은 IP가 "두 종단 시스템 간 전송 서비스"를 제공하는 기능을 "서로 다른 종단 시스템에서 실행되는 두 애플리케이션 간 전송 서비스"로 확장하는 것입니다. <br>
호스트 간 전송을 프로세스 간 전송으로 확장하는 것을 **전송 계층의 다중화 및 역다중화(transport-layer multiplexing and demultiplexing)** 라고 합니다. <br>
UDP와 TCP는 헤더에 오류 검출 필드를 추가하여 데이터 무결성(integrity) 검사도 제공합니다. <br>
이 두 가지 최소 서비스 — 프로세스 간 데이터 전송과 오류 검사 — 가 UDP의 유일한 기능입니다! <br>
즉, UDP는 IP와 마찬가지로 신뢰성이 없는 서비스로, 한 프로세스가 보낸 데이터가 반드시 안전하게 도착한다는 보증이 없습니다(도착 여부도 보장하지 않습니다!).

반면, TCP는 애플리케이션에 몇 가지 추가 서비스를 제공합니다. 첫째, 그리고 가장 중요한 것은 **신뢰성 있는 데이터 전송 서비스**를 제공한다는 점입니다. <br>
흐름 제어, 시퀀스 번호, 확인 메시지(acknowledgments), 타이머 등 다양한 기술(이 기술들은 본 챕터에서 자세히 설명합니다)을 통해 TCP는 송신 프로세스의 데이터가 반드시 수신 프로세스에 정확하고 순서대로 전달되도록 보장합니다. <br>
즉, TCP는 두 호스트 간 신뢰성이 없는 IP 전송을 두 프로세스 간 신뢰성 있는 전송으로 업그레이드합니다. <br>
TCP는 **혼잡 제어(congestion control)** 기능도 제공합니다. 혼잡 제어는 특정 애플리케이션을 위한 서비스가 아니라, 전체 인터넷의 전송 환경을 건강하게 유지하기 위한 서비스입니다. <br>
간단히 말해, TCP의 혼잡 제어 기능은 어떤 TCP 연결도 두 호스트 간 데이터 전달 경로나 라우터가 과도한 트래픽으로 인해 막히는 것을 방지합니다. <br>
TCP는 혼잡 경로의 모든 연결이 동일한 대역폭을 사용할 수 있도록, 송신 측의 패킷 전송 속도를 조절합니다. <br>
반면, UDP의 트래픽은 전혀 제어되지 않습니다. UDP로 데이터 전송을 하는 애플리케이션은 원하는 만큼 빠르고, 원하는 만큼 오래 데이터를 보낼 수 있습니다.