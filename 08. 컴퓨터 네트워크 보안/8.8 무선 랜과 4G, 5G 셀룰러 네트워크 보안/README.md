## 8.8 무선 랜과 4G/5G 셀룰러 네트워크 보안

보안은 무선 네트워크에서 특히 중요한 관심사입니다.
공격자가 송신자의 전송 범위 내 어디에서나 수신 장치를 위치시켜 **프레임을 스니핑**할 수 있기 때문입니다.
이것은 802.11 무선 LAN과 4G/5G 셀룰러 네트워크 모두에 해당됩니다.

두 환경 모두에서 이 장에서 학습한 기본 보안 기술을 광범위하게 사용합니다:
- 인증을 위한 **넌스** 사용
- 메시지 무결성을 위한 **암호화 해싱**
- 사용자 세션 데이터 암호화를 위한 **공유 대칭키 유도**
- **AES 암호화 표준**의 광범위한 사용

유선 인터넷 환경과 마찬가지로, 연구자와 해커가 기존 보안 프로토콜의 약점과 결함을 발견함에 따라 무선 보안 프로토콜은 **지속적인 진화**를 겪어왔습니다.

이 절에서는 802.11(WiFi)과 4G/5G 환경 모두에서 무선 보안에 대한 간략한 소개를 제공합니다.
더 심층적인 내용은 802.11 보안 서적 [Edney 2003; Wright 2015], 3G/4G/5G 보안에 대한 훌륭한 설명 [Sauter 2014], 최근 조사 [Zou 2016; Kohlios 2018]를 참조하세요.

---

## 8.8.1 802.11 무선 LAN에서의 인증 및 키 합의

802.11 네트워크가 처리해야 할 (많은 것 중) **두 가지 중요한 보안 문제** [Zou 2016]를 식별하여 802.11 보안 논의를 시작합시다:

### 상호 인증 (Mutual Authentication)

모바일 장치가 액세스 포인트에 완전히 연결되어 원격 호스트에 데이터그램을 보내기 전에, 네트워크는 일반적으로 먼저 장치를 **인증**하려 합니다.
즉, 네트워크에 연결하는 모바일 장치의 신원을 확인하고, 해당 장치의 접근 권한을 확인합니다.

마찬가지로, 모바일 장치도 연결하려는 네트워크를 **인증**하려 합니다.
즉, 가입하려는 네트워크가 실제로 연결하려는 네트워크인지 확인합니다.

이 양방향 인증을 **상호 인증(mutual authentication)** 이라고 합니다.

### 암호화 (Encryption)

802.11 프레임은 잠재적인 불량배에 의해 스니핑되고 조작될 수 있는 무선 채널을 통해 교환되므로, 모바일 장치와 액세스 포인트(AP) 사이에서 교환되는 사용자 수준 데이터를 전달하는 링크 계층 프레임을 **암호화**하는 것이 중요합니다.

대칭키 암호화가 실제로 사용됩니다. 암호화와 복호화가 **고속으로** 수행되어야 하기 때문입니다.
모바일 장치와 AP는 사용할 대칭 암호화 및 복호화 키를 **유도**해야 합니다.

### 802.11 인증 및 키 합의의 4단계

<img width="492" height="371" alt="Image" src="https://github.com/user-attachments/assets/cffad590-dfc2-48b5-9c16-10303ee4fa63" />

그림 8.30은 802.11 네트워크에 연결하려는 모바일 장치의 시나리오를 보여줍니다.

7.3절에서 802.11 네트워크에 대한 이전 연구에서 본 두 가지 일반적인 네트워크 구성요소(모바일 장치와 AP)를 볼 수 있습니다.
또한 모바일 장치를 인증하는 역할을 하는 새로운 아키텍처 구성요소인 **인증 서버(AS, Authentication Server)** 도 볼 수 있습니다.

인증 서버는 AP에 함께 위치할 수 있지만, 더 일반적으로 그림 8.30에서 보듯이 인증 서비스를 제공하는 **별도의 서버**로 구현됩니다.
인증을 위해 AP는 모바일 장치와 인증 서버 사이에서 인증 및 키 유도 메시지를 중계하는 **통과(pass-through) 장치** 역할을 합니다.
이러한 인증 서버는 일반적으로 네트워크 내의 모든 AP에 대한 인증 서비스를 제공합니다.

그림 8.30에서 상호 인증 및 암호화 키 유도와 사용 과정의 **네 가지 별개의 단계**를 식별할 수 있습니다:

#### 1. 발견 (Discovery)

발견 단계에서 AP는 자신의 존재와 모바일 장치에 제공할 수 있는 인증 및 암호화 형식을 **광고**합니다.
모바일 장치는 원하는 특정 형식의 인증 및 암호화를 요청합니다.

장치와 AP가 이미 메시지를 교환하고 있지만, 장치는 아직 인증되지 않았고 무선 링크를 통한 프레임 전송을 위한 암호화 키도 없으므로, 장치가 AP를 통해 안전하게 통신하기 전에 **몇 가지 추가 단계**가 필요합니다.

#### 2. 상호 인증 및 공유 대칭키 유도 (Mutual Authentication and Shared Symmetric Key Derivation)

이것은 802.11 채널을 "보호"하는 가장 중요한 단계입니다.

이 단계는 802.11과 4G/5G 네트워크 모두에서 실제로 해당되는 가정, 즉 인증 서버와 모바일 장치가 상호 인증을 시작하기 전에 이미 **공유 공통 비밀(shared common secret)** 을 가지고 있다고 가정함으로써 크게 용이해집니다.

이 단계에서 장치와 인증 서버는:
- 이 공유 비밀과 **넌스**(재생 공격 방지를 위해)를 사용합니다
- **암호화 해싱**(메시지 무결성 보장을 위해)을 사용합니다
- 서로를 인증합니다
- 모바일 장치와 AP가 802.11 무선 링크를 통해 전송되는 프레임을 암호화하는 데 사용할 **공유 세션 키**도 유도합니다

#### 3. 공유 대칭 세션 키 배포 (Shared Symmetric Session Key Distribution)

대칭 암호화 키가 모바일 장치와 인증 서버에서 유도되었으므로, 인증 서버가 AP에 공유 대칭 세션 키를 **알려주는 프로토콜**이 필요합니다.
이것은 다소 간단하지만 여전히 필요한 단계입니다.

#### 4. 모바일 장치와 원격 호스트 간의 AP를 통한 암호화 통신 (Encrypted Communication)

이 통신은 7.3.2절에서 이전에 본 것처럼 발생하며, 모바일 장치와 AP 사이에서 전송되는 링크 계층 프레임은 2단계와 3단계에서 생성되고 배포된 공유 세션 키를 사용하여 **암호화**됩니다.

8.2.1절에서 이전에 다룬 **AES 대칭키 암호화**가 일반적으로 802.11 프레임 데이터를 암호화/복호화하는 데 사용됩니다.

---

## 상호 인증 및 공유 대칭 세션 키 유도

상호 인증 및 공유 대칭 세션 키 유도 주제는 802.11 보안의 **핵심 구성요소**입니다.
802.11 보안의 다양한 이전 버전에서 보안 결함이 발견된 것은 바로 이 부분입니다.

### WEP의 문제점

802.11 보안 문제는 기술계와 언론 모두에서 상당한 관심을 끌었습니다.
상당한 논의가 있었지만, 원래의 802.11 보안 사양인 **WEP(Wired Equivalent Privacy)** 가 여러 가지 심각한 보안 결함을 포함하고 있다는 것에 대해서는 거의 논쟁의 여지가 없습니다 [Fluhrer 2001; Stubblefield 2002].

이러한 결함이 발견되자, 공용 도메인 소프트웨어가 곧 이러한 구멍을 악용할 수 있게 되어, WEP으로 보안된 802.11 WLAN 사용자가 **보안 기능을 전혀 사용하지 않은 것처럼** 보안 공격에 노출되었습니다.

WEP에 대해 배우고 싶은 독자는 이 교과서의 이전 판과 Companion Website에서 참고자료를 찾을 수 있습니다.

### WPA와 WPA2

**WPA1(WiFi Protected Access)** 은 WEP의 보안 결함을 극복하기 위해 2003년 WiFi Alliance [WiFi 2020]에 의해 개발되었습니다.
WPA1의 초기 버전은:
- **메시지 무결성 검사**를 도입하여 WEP을 개선했습니다
- 암호화된 메시지 스트림을 관찰한 후 사용자가 암호화 키를 추론할 수 있게 하는 공격을 회피했습니다

WPA1은 곧 **AES 대칭키 암호화** 사용을 의무화한 **WPA2**로 대체되었습니다.

### WPA2의 4-way 핸드셰이크

<img width="517" height="335" alt="Image" src="https://github.com/user-attachments/assets/2c7b504f-1274-44f5-ad07-5c35cc9de1fd" />

WPA의 핵심은 상호 인증과 공유 대칭 세션 키 유도를 모두 수행하는 **4-way 핸드셰이크 프로토콜**입니다.

핸드셰이크 프로토콜은 그림 8.31에 단순화된 형태로 나와 있습니다.
모바일 장치(M)와 인증 서버(AS) 모두 공유 비밀키 **K_AS-M**(예: 비밀번호)을 알고 시작합니다.

그들의 작업 중 하나는 모바일 장치(M)와 AP 사이에서 나중에 전송되는 프레임을 암호화/복호화하는 데 사용될 공유 대칭 세션 키 **K_M-AP**를 유도하는 것입니다.

상호 인증과 공유 대칭 세션 키 유도는 그림 8.31에 표시된 4-way 핸드셰이크의 처음 두 단계, **a와 b**에서 수행됩니다.
단계 **c와 d**는 그룹 통신에 사용되는 두 번째 키를 유도하는 데 사용됩니다. 자세한 내용은 [Kohlios 2018; Zou 2016]을 참조하세요.

#### 단계 a

이 첫 번째 단계에서 인증 서버(AS)는 넌스 **Nonce_AS**를 생성하여 모바일 장치에 보냅니다.
8.4절에서 넌스가 **재생 공격을 피하고** 인증되는 상대방의 "라이브니스(liveness)"를 증명하는 데 사용됨을 기억하세요.

#### 단계 b

모바일 장치 M은 AS로부터 넌스 **Nonce_AS**를 받고 자신의 넌스 **Nonce_M**을 생성합니다.

모바일 장치는 그런 다음 다음을 사용하여 대칭 공유 세션 키 **K_M-AP**를 생성합니다:
- **Nonce_AS**
- **Nonce_M**
- 초기 공유 비밀키 **K_AS-M**
- 자신의 MAC 주소
- AS의 MAC 주소

그런 다음 자신의 넌스 **Nonce_M**과 **Nonce_AS 및 원본 공유 비밀**을 인코딩하는 **HMAC 서명된 값**(그림 8.9 참조)을 보냅니다.

AS는 M으로부터 이 메시지를 받습니다.
방금 보낸 넌스 **Nonce_AS**의 HMAC 서명된 버전을 보면, 인증 서버는 모바일 장치가 **라이브**임을 알 수 있습니다.
모바일 장치가 공유 비밀키 **K_AS-M**을 사용하여 암호화할 수 있었기 때문에, AS는 모바일 장치가 실제로 자신이 주장하는 장치(즉, 공유 비밀을 아는 장치)임을 알 수 있습니다.

**AS는 이렇게 모바일 장치를 인증했습니다!**

AS는 또한 모바일 장치와 정확히 동일한 계산을 수행하여 공유 대칭 세션 키 **K_M-AP**를 유도할 수 있습니다:
- 받은 **Nonce_M**
- **Nonce_AS**
- 초기 공유 비밀키 **K_AS-M**
- 자신의 MAC 주소
- 모바일 장치의 MAC 주소

이 시점에서 모바일 장치와 인증 서버 모두 **동일한 공유 대칭키 K_M-AP**를 계산했습니다.
이 키는 모바일 장치와 AP 사이에서 전송되는 프레임을 암호화/복호화하는 데 사용됩니다.

AS는 그림 8.30의 3단계에서 이 키 값을 AP에 알립니다.

### WPA3

**WPA3**는 2018년 6월에 WPA2의 업데이트로 출시되었습니다.

이 업데이트는 이전에 사용된 넌스의 **재사용을 유도**할 수 있는 4-way 핸드셰이크 프로토콜에 대한 공격 [Vanhoef 2017]을 해결하지만, 여전히 레거시 프로토콜로서 4-way 핸드셰이크의 사용을 허용하고 다른 변경 사항 중에서 **더 긴 키 길이**를 포함합니다 [WiFi 2019].

---

## 802.11 보안 메시징 프로토콜

<img width="495" height="321" alt="Image" src="https://github.com/user-attachments/assets/a3de9dec-f4e0-45c5-8724-fd50d4ac4b4e" />

그림 8.32는 위에서 논의한 802.11 보안 프레임워크를 구현하는 데 사용되는 프로토콜을 보여줍니다.

**EAP(Extensible Authentication Protocol)** [RFC 3748]는 모바일 장치와 인증 서버 사이의 단순한 요청/응답 모드 상호작용에서 사용되는 종단 간 메시지 형식을 정의하며, WPA2에서 인증됩니다.

그림 8.32에서 보듯이, EAP 메시지는:
- **EAPoL(EAP over LAN)** 을 사용하여 캡슐화되고 802.11 무선 링크를 통해 전송됩니다
- 이러한 EAP 메시지는 액세스 포인트에서 디캡슐화된 다음
- 인증 서버로의 전송을 위해 **RADIUS 프로토콜**을 사용하여 UDP/IP를 통해 **재캡슐화**됩니다

RADIUS 서버와 프로토콜 [RFC 2865]은 필수가 아니지만 **사실상(de facto)** 표준 구성요소입니다.
최근 표준화된 **DIAMETER 프로토콜** [RFC 3588]이 향후 RADIUS를 대체할 것으로 예상됩니다.

---

## 8.8.2 4G/5G 셀룰러 네트워크에서의 인증 및 키 합의

이 절에서는 4G/5G 네트워크에서의 상호 인증 및 키 생성 메커니즘을 설명합니다.

우리가 접하게 될 접근 방식의 대부분은 방금 802.11 네트워크에서 연구한 것과 병행하지만, 4G/5G 네트워크에서는 모바일 장치가 자신의 **홈 네트워크**(즉, 가입한 셀룰러 통신 사업자 네트워크)에 연결되거나 **방문 네트워크**에서 로밍 중일 수 있다는 중요한 예외가 있습니다.

후자의 경우, 방문 네트워크와 홈 네트워크는 모바일 장치를 인증하고 암호화 키를 생성할 때 **상호작용**해야 합니다.

계속하기 전에, 7.4절과 7.7.1절을 다시 읽어 4G/5G 네트워크 아키텍처에 다시 익숙해지는 것이 좋습니다.

### 4G/5G에서의 상호 인증과 키 생성의 목표

상호 인증과 키 생성의 목표는 802.11 환경과 같습니다:
- 무선 채널을 통해 전송되는 프레임의 내용을 암호화하기 위해 모바일 장치와 기지국은 **공유 대칭 암호화 키를 유도**해야 합니다
- 또한 모바일 장치가 연결하는 네트워크는 장치의 신원을 인증하고 접근 권한을 확인해야 합니다
- 마찬가지로, 모바일 장치도 연결하는 네트워크를 인증하려 합니다

네트워크가 모바일 장치를 인증해야 하는 필요성은 명백하지만, 역방향 인증의 필요성은 그렇게 명확하지 않을 수 있습니다.
그러나 의심하지 않는 모바일 장치를 불량 네트워크에 연결하도록 유인하는 **불량 셀룰러 기지국을 운영**하는 불량배의 문서화된 사례가 있습니다 [Li 2017].

따라서 802.11 WLAN의 경우와 마찬가지로, 모바일 장치는 셀룰러 네트워크에 연결할 때 **충분한 주의**를 기울여야 합니다!

### 4G 인증 및 키 합의 (AKA) 프로토콜

<img width="505" height="382" alt="Image" src="https://github.com/user-attachments/assets/043ceb1a-1283-4208-9950-35279a8e315e" />

그림 8.33은 4G 셀룰러 네트워크에 연결하는 모바일 장치의 시나리오를 보여줍니다.

그림 8.33 상단에서 7.4절에서 이전에 만난 4G 구성요소 중 많은 것을 볼 수 있습니다:
- **모바일 장치(M)**
- **기지국(BS)**
- **이동성 관리 엔티티(MME, Mobility Management Entity)**: 모바일 장치가 연결하려는 네트워크
- **홈 가입자 서비스(HSS, Home Subscriber Service)**: 모바일 장치의 홈 네트워크

그림 8.30과 8.33을 비교하면 802.11과 4G 보안 환경 사이의 유사점과 차이점을 알 수 있습니다.
우리는 다시 모바일 장치와 기지국을 봅니다.
사용자 세션 키 **K_BS-M**은 네트워크 연결 중에 유도되며, 무선 링크를 통해 전송되는 프레임을 암호화/복호화하는 데 사용됩니다.

4G MME와 HSS는 함께 802.11 환경의 인증 서버와 유사한 역할을 합니다.
HSS와 모바일 장치도 **공통 비밀 K_HSS-M**을 공유하며, 이는 인증이 시작되기 전에 두 엔티티에 알려져 있습니다.
이 키는 모바일 장치의 **SIM 카드**에 저장되어 있고, 모바일 장치의 홈 네트워크의 **HSS 데이터베이스**에 저장되어 있습니다.

**4G AKA(Authentication and Key Agreement)** 프로토콜은 다음 단계로 구성됩니다:

#### a. HSS에 대한 인증 요청 (Authentication request to HSS)

모바일 장치가 기지국을 통해 네트워크에 연결을 처음 요청할 때, **IMSI(international mobile subscriber identity)** 를 포함하는 연결 메시지를 보내며, 이는 MME에 전달됩니다.

MME는 IMSI와 방문 네트워크에 대한 정보("VN info")를 장치의 홈 네트워크에 있는 **HSS**에 보냅니다.
7.4절에서 MME가 상호 연결된 셀룰러 네트워크의 전체 IP 글로벌 네트워크를 통해 HSS와 통신할 수 있는 방법을 설명했습니다.

#### b. HSS의 인증 응답 (Authentication response from HSS)

HSS는 사전에 공유된 비밀키 **K_HSS-M**을 사용하여 암호화 연산을 수행하여:
- 인증 토큰 **auth_token** 유도
- 예상 인증 응답 토큰 **xres_HSS** 유도

**auth_token**은 HSS가 **K_HSS-M**을 사용하여 암호화한 정보를 포함합니다.
이를 통해 모바일 장치는 **auth_token**을 생성한 사람이 비밀키를 알고 있음을 알 수 있습니다.

예를 들어, HSS가 **K_HSS-M(IMSI)**, 즉 **K_HSS-M**을 사용하여 장치의 IMSI를 암호화하고 그 값을 **auth_token**으로 보낸다고 가정합니다.
모바일 장치가 암호화된 값을 받고 비밀키를 사용하여 복호화할 때, 즉 **K_HSS-M(K_HSS-M(IMSI)) = IMSI**를 계산할 때, **auth_token**을 생성한 HSS가 자신의 비밀키를 알고 있음을 알 수 있습니다.

따라서 모바일 장치는 **HSS를 인증**할 수 있습니다.

예상 인증 응답 토큰 **xres_HSS**는 모바일 장치가 비밀키를 알고 있음을 증명하기 위해 MME에 반환해야 하는(자신의 비밀키인 **K_HSS-M**을 사용하여 계산할 수 있는) 값을 포함합니다.

MME는 여기서 중개자 역할만 하며, 인증 응답 메시지를 받고 **xres_HSS**를 나중에 사용하기 위해 보관하고 인증 토큰을 추출하여 모바일 장치로 전달합니다.
특히 MME는 비밀키 **K_HSS-M**을 알 필요가 없고 알지 못합니다.

#### c. 모바일 장치의 인증 응답 (Authentication response from mobile device)

모바일 장치는 **auth_token**을 받고 **K_HSS-M(K_HSS-M(IMSI)) = IMSI**를 계산하여 **HSS를 인증**합니다.

그런 다음 모바일 장치는 HSS가 **xres_HSS**를 계산하기 위해 수행한 정확히 동일한 암호화 계산을 수행하기 위해 자신의 비밀키를 사용하여 값 **res_M**을 계산하고, 이 값을 MME에 보냅니다.

#### d. 모바일 장치 인증 (Mobile device authentication)

MMS는 모바일이 계산한 **res_M** 값을 HSS가 계산한 **xres_HSS** 값과 **비교**합니다.

일치하면, 모바일과 HSS가 모두 공통 비밀키를 알고 있음을 MME에 증명했으므로 모바일 장치가 **인증**됩니다.

MMS는 상호 인증이 완료되었음을 기지국과 모바일 장치에 알리고 e단계에서 사용될 **기지국 키**를 보냅니다.

#### e. 데이터 평면 및 제어 평면 키 유도 (Data plane and control plane key derivation)

모바일 장치와 기지국은 각각 무선 채널을 통한 프레임 전송을 암호화/복호화하는 데 사용되는 키를 결정합니다.

**데이터 평면** 프레임 전송과 **제어 평면** 프레임 전송에 **별도의 키**가 유도됩니다.
802.11 네트워크에서 사용 중인 것으로 본 **AES 암호화 알고리즘**이 4G/5G 네트워크에서도 사용됩니다.

### 5G에서의 변경 사항

위의 논의는 4G 네트워크에서의 인증 및 키 합의에 초점을 맞추었습니다.
4G 보안의 많은 부분이 5G로 이월되고 있지만, 몇 가지 **중요한 변경 사항**이 있습니다:

1. **인증 결정 주체의 변경**: 위의 논의에서 방문 네트워크의 MME가 인증 결정을 내린다는 점에 주목하세요. 5G 네트워크 보안의 중요한 변경 사항은 인증 서비스가 **홈 네트워크**에서 제공되도록 하는 것입니다. 방문 네트워크는 더 작은 중개자 역할을 합니다. 방문 네트워크가 여전히 모바일 장치의 인증을 거부할 수 있지만, 이 새로운 5G 시나리오에서 인증 요청을 수락하는 것은 **홈 네트워크의 역할**입니다.

2. **새로운 프로토콜**: 5G 네트워크는 위에서 설명한 AKA 프로토콜뿐만 아니라 인증 및 키 합의를 위한 **두 가지 새로운 추가 프로토콜**도 지원합니다. 이 중 하나인 **AKA'**는 4G AKA 프로토콜과 밀접하게 관련되어 있습니다. 이것도 사전에 공유된 비밀키 **K_HSS-M**을 사용합니다. 그러나 802.11 인증의 맥락에서 그림 8.33에서 이전에 만난 **EAP 프로토콜**을 사용하므로, 5G AKA'는 4G AKA와 다른 메시지 흐름을 가집니다. 두 번째 새로운 5G 프로토콜은 **IoT 환경**을 위한 것으로, 사전에 공유된 비밀키를 **필요로 하지 않습니다**.

3. **IMSI 암호화**: 5G의 추가적인 변경 사항은 장치의 영구 신원(즉, IMSI)이 **평문으로 전송되지 않도록** 공개키 암호화 기술을 사용하여 암호화하는 것입니다.

이 절에서는 4G/5G 네트워크에서의 상호 인증 및 키 합의만 간략하게 개요했습니다.
본 것처럼, 이 장 앞부분에서 연구한 보안 기술을 **광범위하게 사용**합니다.
4G/5G 보안에 대한 자세한 내용은 [3GPP SAE 2019; Cable Labs 2019; Cichonski 2017]을 참조하세요.
